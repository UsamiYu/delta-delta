!function(){"use strict"}();var tm=tm||{};tm.global=window||global||this,null!=tm.global.Meteor&&(tm.global.tm=tm),"undefined"!=typeof module&&module.exports&&(module.exports=tm),function(){tm.VERSION="0.5.0",tm.LIB_ROOT=function(){if(window.document)for(var t=document.getElementsByTagName("script"),e=0,i=t.length;i>e;++e);}(),tm.BROWSER=function(){return window.navigator?/chrome/i.test(navigator.userAgent)?"Chrome":/safari/i.test(navigator.userAgent)?"Safari":/firefox/i.test(navigator.userAgent)?"Firefox":/opera/i.test(navigator.userAgent)?"Opera":/getcko/i.test(navigator.userAgent)?"Getcko":/msie/i.test(navigator.userAgent)?"IE":null:void 0}(),tm.VENDER_PREFIX=function(){if(window){var t={Chrome:"webkit",Safari:"webkit",Firefox:"moz",Opera:"o",IE:"ms"};return t[tm.BROWSER]||""}}(),tm.isMobile=function(){if(window.navigator){var t=navigator.userAgent;return t.indexOf("iPhone")>0||t.indexOf("iPad")>0||t.indexOf("Android")>0}}(),tm.isLocal=function(){var t="file:"==location.protocol;return function(){return t}}(),tm.createClass=function(t){t.init=t.init||function(){},t.superClass=t.superClass||null;var e=function(){var t=new e.prototype.creator;return e.prototype.init.apply(t,arguments),t};t.superClass&&(t.init.owner=e,e.prototype=Object.create(t.superClass.prototype),e.prototype.superInit=function(){var t=this.superInit.caller,e=t.owner,i=e.prototype.superClass,n=i.prototype.init;n.apply(this,arguments)},e.prototype.constructor=e),e.prototype.selfClass=e;for(var i in t)e.prototype[i]=t[i];return e.prototype.creator=function(){return this},e.prototype.creator.prototype=e.prototype,e._class=!0,e},tm.classes={};var _calssDefinedCallback={};tm.define=function(t,e){{var i=t.lastIndexOf("."),n=t.substring(0,i),s=n?tm.using(n):tm.global,o=n?t.substring(i+1):t;Function.prototype.bind,Array.prototype.unshift}e._path=t,e._className=o;var a=null,r=e.superClass;if(r&&"string"==typeof r){var h=r;if(r=tm.using(r),!r._class)return _calssDefinedCallback[h]||(_calssDefinedCallback[h]=[]),void _calssDefinedCallback[h].push(function(){tm.define(t,e)});e.superClass=r,a=tm.createClass(e)}else a=tm.createClass(e);if(s[o]=tm.classes[t]=a,_calssDefinedCallback[t]){for(var l=_calssDefinedCallback[t],c=0,u=l.length;u>c;++c)l[c]();delete _calssDefinedCallback[t]}return a},tm.namespace=function(t,e){var t=tm.using(t);e.call(t,t)},tm.using=function(t){if(tm.classes[t])return tm.classes[t];for(var e=t.split(/[,.\/ ]|::/),i=tm.global,n=0,s=e.length;s>n;++n){var o=e[n];i=i[o]||(i[o]={})}return tm.classes[t]=i,i},tm.globalize=function(t){return tm.global.$strict(t),this},tm["import"]=function(t){var e=tm[t];return tm.global.$strict(e),this},tm.setLoop=function(t,e){var i=function(){var i=(new Date).getTime();t();var n=(new Date).getTime()-i,s=e-n;s=s>0?s:0,setTimeout(arguments.callee,s)};setTimeout(i,e)},tm.inform=function(parent){parent=parent||document.body;var eInfo=document.createElement("div");with(eInfo.setAttribute("class","tm-info"),eInfo.addEventListener("mouseover",function(){this.style.opacity=.9},!1),eInfo.addEventListener("mouseout",function(){this.style.opacity=.25},!1),eInfo.style)position="absolute",width="100%",bottom="0px",left="0px",right="0px",margin="0px",padding="10px 0px",zIndex="0",textAlign="center",fontFamily='"Meiryo", "メイリオ", "ヒラギノ角ゴ Pro W3", sans-serif',fontSize="13px",opacity="0.25",backgroundColor="rgb(230,230,255)",background="-webkit-linear-gradient(top, hsla(0, 100%, 100%, 0.8) 0%, hsla(0, 100%, 100%, 0.3) 50%, hsla(0, 100%, 100%, 0.1) 51%, hsla(0, 100%, 100%, 0.2) 100%), rgb(190,190,210)",background="-moz-linear-gradient(top, hsla(0, 100%, 100%, 0.8) 0%, hsla(0, 100%, 100%, 0.3) 50%, hsla(0, 100%, 100%, 0.1) 51%, hsla(0, 100%, 100%, 0.2) 100%), rgb(190,190,210)",WebkitTransition="1s",MozTransition="1s";eInfo.innerHTML="このプログラムで利用している JavaScript ライブラリ 『tmlib.js』 については<a href='{projectLink}'>こちら</a>.".format({projectLink:"https://github.com/phi1618/tmlib.js"}),parent.appendChild(eInfo)}}(),function(){window&&(window.requestAnimationFrame||(window.requestAnimationFrame=window[tm.VENDER_PREFIX+"RequestAnimationFrame"]||function(t){window.setTimeout(t,1e3/60)}),window.cancelRequestAnimationFrame||(window.cancelRequestAnimationFrame=window[tm.VENDER_PREFIX+"CancelRequestAnimationFrame"]||window.clearTimeout))}(),function(){if(window.document){_loadCheckList=[],tm.addLoadCheckList=function(t){console.assert(void 0!==t.isLoaded,"isLoaded が定義されていません!!"),_loadCheckList.push(t)},_preloadListners=[],_mainListners=[],tm.preload=function(t){_preloadListners.push(t)},tm.main=function(t){_mainListners.push(t)};var t=function(){for(var t=0,e=_preloadListners.length;e>t;++t)_preloadListners[t]();_preloadListners=[]},e=function(){for(var t=0,e=_loadCheckList.length;e>t;++t){var i=_loadCheckList[t];if(0==i.isLoaded())return void setTimeout(arguments.callee,0)}for(var t=0,e=_mainListners.length;e>t;++t)_mainListners[t]();_mainListners=[]};window.addEventListener("load",function(){t(),e()},!1)}}(),function(){Object.defineProperty(Object.prototype,"defineVariable",{value:function(t,e){Object.defineProperty(this,t,{value:e,enumerable:!0,writable:!0})}}),Object.defineProperty(Object.prototype,"defineFunction",{value:function(t,e){Object.defineProperty(this,t,{value:e,enumerable:!1,writable:!0})}}),Object.prototype.defineFunction("defineInstanceVariable",function(t,e){Object.defineProperty(this.prototype,t,{value:e,enumerable:!0,writable:!0})}),Object.prototype.defineFunction("defineInstanceMethod",function(t,e){Object.defineProperty(this.prototype,t,{value:e,enumerable:!1,writable:!0})}),Object.defineInstanceMethod("setter",function(t,e){Object.defineProperty(this,t,{set:e,enumerable:!1,configurable:!0})}),Object.defineInstanceMethod("getter",function(t,e){Object.defineProperty(this,t,{get:e,enumerable:!1,configurable:!0})}),Object.defineInstanceMethod("accessor",function(t,e){Object.defineProperty(this,t,{set:e.set,get:e.get,enumerable:!1,configurable:!0})}),Object.defineInstanceMethod("$forIn",function(t,e){return e=e||this,Object.keys(this).forEach(function(i,n){var s=this[i];t.call(e,i,s,n)},this),this}),Object.defineInstanceMethod("$has",function(t){return this.hasOwnProperty(t)}),Object.defineInstanceMethod("$extend",function(){return Array.prototype.forEach.call(arguments,function(t){for(var e in t)this[e]=t[e]},this),this}),Object.defineInstanceMethod("$safe",function(){return Array.prototype.forEach.call(arguments,function(t){for(var e in t)void 0===this[e]&&(this[e]=t[e])},this),this}),Object.defineInstanceMethod("$strict",function(){return Array.prototype.forEach.call(arguments,function(t){for(var e in t)console.assert(!this[e],"tm error: {0} is Already".format(e)),this[e]=t[e]},this),this}),Object.defineInstanceMethod("$pick",function(){var t={};return Array.prototype.forEach.call(arguments,function(e){e in this&&(t[e]=this[e])},this),t}),Object.defineInstanceMethod("$omit",function(){var t={};for(var e in this)-1==Array.prototype.indexOf.call(arguments,e)&&(t[e]=this[e]);return t})}(),function(){Array.prototype.accessor("first",{get:function(){return this[0]},set:function(t){this[0]=t}}),Array.prototype.accessor("last",{get:function(){return this[this.length-1]},set:function(t){this[this.length-1]=t}}),Array.defineInstanceMethod("equals",function(t){if(this.length!==t.length)return!1;for(var e=0,i=this.length;i>e;++e)if(this[e]!==t[e])return!1;return!0}),Array.defineInstanceMethod("deepEquals",function(t){if(this.length!==t.length)return!1;for(var e=0,i=this.length;i>e;++e){var n=this[e].deepEquals?this[e].deepEquals(t[e]):this[e]===t[e];if(n===!1)return!1}return!0}),Array.defineInstanceMethod("contains",function(t,e){return-1!=this.indexOf(t,e)}),Array.defineInstanceMethod("at",function(t){return t%=this.length,t+=this.length,t%=this.length,this[t]}),Array.defineInstanceMethod("swap",function(t,e){var i=this[t];return this[t]=this[e],this[e]=i,this}),Array.defineInstanceMethod("erase",function(t){var e=this.indexOf(t);return e>=0&&this.splice(e,1),this}),Array.defineInstanceMethod("eraseAll",function(t){for(var e=0,i=this.length;i>e;++e)this[e]==t&&this.splice(e--,1);return this}),Array.defineInstanceMethod("eraseIf",function(t){for(var e=0,i=this.length;i>e;++e)if(t(this[e],e,this)){this.splice(e,1);break}return this}),Array.defineInstanceMethod("eraseIfAll",function(t){for(var e=0,i=this.length;i>e;++e)t(this[e],e,this)&&this.splice(e,1);return this}),Array.defineInstanceMethod("random",function(t,e){return t=t||0,e=e||this.length-1,this[Math.rand(t,e)]}),Array.defineInstanceMethod("pickup",function(t,e){return t=t||0,e=e||this.length-1,this[Math.rand(t,e)]}),Array.defineInstanceMethod("uniq",function(){return this.filter(function(t,e,i){return i.indexOf(t)===e})}),Array.defineInstanceMethod("flatten",function(t){var e=null;if(t){e=this;for(var i=0;t>i;++i)e=Array.prototype.concat.apply([],e)}else e=this.reduce(function(t,e){return t.concat(Array.isArray(e)?e.flatten():e)},[]);return e}),Array.defineInstanceMethod("clone",function(t){if(1==t){for(var e=Array(this.length),i=0,n=this.length;n>i;++i)e[i]=this[i].clone?this[i].clone(t):this[i];return e}return Array.prototype.slice.apply(this)}),Array.defineInstanceMethod("clear",function(){return this.length=0,this}),Array.defineInstanceMethod("fill",function(t,e,i){e=e||0,i=i||this.length;for(var n=e;i>n;++n)this[n]=t;return this}),Array.defineInstanceMethod("range",function(t,e,i){if(1==arguments.length){this.clear();for(var n=0;t>n;++n)this[n]=n}else if(e>t){i=i||1,this.clear();for(var n=t,s=0;e>n;n+=i,++s)this[s]=n}else{i=i||-1,this.clear();for(var n=t,s=0;n>e;n+=i,++s)this[s]=n}return this}),Array.defineInstanceMethod("shuffle",function(){for(var t=0,e=this.length;e>t;++t){var i=Math.rand(0,e-1);t!=i&&this.swap(t,i)}return this}),Array.defineInstanceMethod("sum",function(){for(var t=0,e=0,i=this.length;i>e;++e)t+=this[e];return t}),Array.defineInstanceMethod("average",function(){for(var t=0,e=this.length,i=0;e>i;++i)t+=this[i];return t/e}),Array.defineInstanceMethod("each",function(){return this.forEach.apply(this,arguments),this}),Array.defineInstanceMethod("toULElement",function(){}),Array.defineInstanceMethod("toOLElement",function(){}),Array.defineFunction("range",function(){return Array.prototype.range.apply([],arguments)})}(),function(){var t=["January","February","March","April","May","June","July","August","September","October","November","December"],e=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];Date.defineInstanceMethod("format",function(i){for(var n=this.getFullYear(),s=this.getMonth(),o=this.getDate(),a=this.getDay(),r=this.getHours(),h=this.getMinutes(),l=this.getSeconds(),c=this.getMilliseconds(),u="",m=0,p=i.length;p>m;++m){var d=i.charAt(m),f="";switch(d){case"d":f=o.padding(2,"0");break;case"D":f=e[a].substr(0,3);break;case"j":f=o;break;case"l":f=e[a];break;case"F":f=t[s];break;case"m":f=(s+1).padding(2,"0");break;case"M":f=t[s].substr(0,3);break;case"n":f=s+1;break;case"Y":f=n;break;case"y":f=n.toString().substr(2,2);break;case"G":f=r;break;case"H":f=r.padding(2,"0");break;case"i":f=h.padding(2,"0");break;case"s":f=l.padding(2,"0");break;case"S":f=c.padding(3,"0");break;default:f=d}u+=f}return u})}(),function(){Function.prototype.bind||Function.defineInstanceMethod("bind",function(t){var e=this;return function(){e.apply(t,arguments)}}),Function.prototype.$has("name")||Function.prototype.getter("name",function(){return(""+this).replace(/^\s*function\s*([^\(]*)[\S\s]+$/im,"$1")}),Function.defineInstanceMethod("toArrayFunction",function(){var t=this;return function(){for(var e=[],i=0,n=this.length;n>i;++i)e.push(t.apply(this[i],arguments));return e}})}(),function(){Math.DEG_TO_RAD=Math.PI/180,Math.RAD_TO_DEG=180/Math.PI,Math.degToRad=function(t){return t*Math.DEG_TO_RAD},Math.radToDeg=function(t){return t*Math.RAD_TO_DEG},Math.defineFunction("clamp",function(t,e,i){return e>t?e:t>i?i:t}),Math.defineFunction("inside",function(t,e,i){return t>=e&&i>=t}),Math.defineFunction("rand",function(t,e){return window.Math.floor(Math.random()*(e-t+1))+t}),Math.defineFunction("randf",function(t,e){return window.Math.random()*(e-t)+t})}(),function(){Number.defineInstanceMethod("round",function(t){t=t||0;var e=Math.pow(10,t),i=this*e;return i=Math.round(i),i/e}),Number.defineInstanceMethod("ceil",function(t){t=t||0;var e=Math.pow(10,t),i=this*e;return i=Math.ceil(i),i/e}),Number.defineInstanceMethod("floor",function(t){t=t||0;var e=Math.pow(10,t),i=this*e;return i=Math.floor(i),i/e}),Number.defineInstanceMethod("toInt",function(){return 0|this}),Number.defineInstanceMethod("toHex",function(){return this.toString(16)}),Number.defineInstanceMethod("toBin",function(){return this.toString(2)}),Number.defineInstanceMethod("toUnsigned",function(){return this>>>0}),Number.defineInstanceMethod("padding",function(t,e){var i=this+"";for(t-=i.length,e=e||"0";t-->0;)i=e+i;return i}),Number.defineInstanceMethod("times",function(t,e){e=e||this;for(var i=0;this>i;++i)t.call(e,i);return this}),Number.defineInstanceMethod("upto",function(t,e,i){i=i||this;for(var n=+this;t>=n;++n)e.call(i,n);return this}),Number.defineInstanceMethod("downto",function(t,e,i){i=i||this;for(var n=+this;n>=t;--n)e.call(i,n);return this}),Number.defineInstanceMethod("step",function(t,e,i,n){n=n||this;for(var s=+this;t>=s;s+=e)i.call(n,s);return this})}(),function(){String.defineInstanceMethod("format",function(t){var e=void 0;if("object"==typeof t)e=function(e,i){return void 0===t[i]?"":t[i]};else{var i=arguments;e=function(t,e){return i[parseInt(e)]}}return this.replace(/\{(\w+)\}/g,e)}),String.defineInstanceMethod("trim",function(){return this.replace(/^\s+|\s+$/g,"")}),String.defineInstanceMethod("capitalize",function(){return this.replace(/\w+/g,function(t){return t.capitalizeFirstLetter()})}),String.defineInstanceMethod("capitalizeFirstLetter",function(){return this.charAt(0).toUpperCase()+this.substr(1).toLowerCase()}),String.defineInstanceMethod("toDash",function(){return this.replace(/([A-Z])/g,function(t){return"-"+t.toLowerCase()})}),String.defineInstanceMethod("toHash",function(){return this.toCRC32()}),String.defineInstanceMethod("padding",function(t,e){var i=this.toString();for(t-=i.length,e=e||" ";t-->0;)i=e+i;return i}),String.defineInstanceMethod("paddingLeft",function(t,e){var i=this.toString();for(t-=i.length,e=e||" ";t-->0;)i=e+i;return i}),String.defineInstanceMethod("paddingRight",function(t,e){var i=this.toString();for(t-=i.length,e=e||" ";t-->0;)i+=e;return i}),String.defineInstanceMethod("quotemeta",function(){return this.replace(/([^0-9A-Za-z_])/g,"\\$1")}),String.defineInstanceMethod("repeat",function(t){for(var e=Array(t),i=0;t>i;++i)e[i]=this;return e.join("")}),String.defineInstanceMethod("count",function(t){var e=new RegExp(t,"gm");return this.match(e).length}),String.defineInstanceMethod("toArray",function(){for(var t=[],e=0,i=this.length;i>e;++e)t.push(this[e]);return t});var t="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D".split(" ");String.defineInstanceMethod("toCRC32",function(){var e=0,i=0,n=0;e=-1^e;for(var s=0,o=this.length;o>s;++s)n=255&(e^this.charCodeAt(s)),i="0x"+t[n],e=e>>>8^i;return(-1^e)>>>0})}(),tm.event=tm.event||{},function(){tm.event.Event=tm.createClass({type:null,init:function(t){this.type=t}})}(),function(){tm.event.TweenEvent=tm.createClass({superClass:tm.event.Event,time:null,now:null,init:function(t,e,i){this.superInit(t),this.time=e,this.now=i}}),tm.event.TweenEvent.CHANGE="change",tm.event.TweenEvent.FINISH="finish",tm.event.TweenEvent.LOOP="loop",tm.event.TweenEvent.RESUME="resume",tm.event.TweenEvent.START="start",tm.event.TweenEvent.STOP="stop"}(),function(){tm.event.MouseEvent=tm.createClass({superClass:tm.event.Event,app:null,pointing:null,init:function(t,e,i){this.superInit(t),this.app=e,this.pointing=i}})}(),function(){tm.event.TouchEvent=tm.createClass({superClass:tm.event.Event,app:null,pointing:null,init:function(t,e,i){this.superInit(t),this.app=e,this.pointing=i}})}(),function(){tm.event.PointingEvent=tm.createClass({superClass:tm.event.Event,app:null,pointing:null,init:function(t,e,i){this.superInit(t),this.app=e,this.pointing=i}})}(),tm.event=tm.event||{},function(){tm.define("tm.event.EventDispatcher",{init:function(){this._listeners={}},on:function(t,e){return void 0===this._listeners[t]&&(this._listeners[t]=[]),this._listeners[t].push(e),this},off:function(t,e){var i=this._listeners[t],n=i.indexOf(e);return-1!=n&&i.splice(n,1),this},fire:function(t){t.target=this;var e="on"+t.type;this[e]&&this[e](t);var i=this._listeners[t.type];if(i)for(var n=i.clone(),s=0,o=n.length;o>s;++s)n[s].call(this,t);return this},flare:function(t,e){var i=tm.event.Event(t);return e&&i.$extend(e),this.fire(i),this},one:function(t,e){var i=this,n=function(){var s=e.apply(i,arguments);return i.off(t,n),s};return this.on(t,n),this},hasEventListener:function(t){return void 0!==this._listeners[t]||this["on"+t]?!0:!1},clearEventListener:function(t){var e="on"+t;return this[e]&&delete this[e],this._listeners[t]=[],this}});var t=tm.event.EventDispatcher.prototype;t.addEventListener=t.on,t.removeEventListener=t.off,t.dispatchEvent=t.fire}(),tm.util=tm.util||{},function(){tm.util.Random={randint:function(t,e){return window.Math.floor(Math.random()*(e-t+1))+t},randfloat:function(t,e){return window.Math.random()*(e-t)+t},randbool:function(){return 1===this.randint(0,1)}}}(),tm.util=tm.util||{},function(){var AJAX_DEFAULT_SETTINGS={type:"GET",async:!0,data:null,contentType:"application/x-www-form-urlencoded",dataType:"text",responseType:"",username:null,password:null,success:function(t){alert("success!!\n"+t)},error:function(){alert("error!!")},beforeSend:null};tm.util.Ajax={load:function(t){for(var e in AJAX_DEFAULT_SETTINGS)t[e]=t[e]||AJAX_DEFAULT_SETTINGS[e];{var i=new XMLHttpRequest,n=tm.util.Ajax.DATA_CONVERTE_TABLE[t.dataType];t.url}if(t.data){var s="";s="string"==typeof t.data?t.data:tm.util.QueryString.stringify(t.data),"GET"==t.type?(t.url+="?"+s,t.data=null):"POST"==t.type&&(t.data=s)}i.onreadystatechange=function(){if(4==i.readyState)if(200===i.status||201===i.status||0===i.status)if("arraybuffer"!==t.responseType){var e=n(i.responseText);t.success(e)}else t.success(this.response);else t.error(i.responseText)},i.open(t.type,t.url,t.async,t.username,t.password),"POST"===t.type&&i.setRequestHeader("Content-Type",t.contentType),t.responseType&&(i.responseType=t.responseType),t.beforeSend&&t.beforeSend(i),t.password&&(i.withCredentials=!0),i.send(t.data)},loadJSONP:function(t,e){var i=tm.global;i.tmlib_js_dummy_func_count=tm.global.tmlib_js_dummy_func||0;var n="tmlib_js_dummy_func"+i.tmlib_js_dummy_func_count++;i[n]=e;var s=document.createElement("script");s.type="text/javascript",s.charset="UTF-8",s.src=t+(t.indexOf("?")<0?"?":"&")+"callback="+n,s.setAttribute("defer",!0),document.getElementsByTagName("head")[0].appendChild(s)}},tm.util.Ajax.DATA_CONVERTE_TABLE={undefined:function(t){return t},text:function(t){return t},xml:function(t){var e=new DOMParser,i=e.parseFromString(t,"text/xml");return i},dom:function(t){var e=document.createElement("div");return e.innerHTML=t,tm.dom.Element(e)},json:function(t){try{return JSON.parse(t)}catch(e){console.dir(e),console.dir(t)}},script:function(data){return eval(data),data},bin:function(t){for(var e=[],i=0,n=t.length;n>i;++i)e[i]=255&t.charCodeAt(i);return e}},tm.util.Ajax.DEFAULT_SETTINGS=AJAX_DEFAULT_SETTINGS}(),tm.util=tm.util||{},function(){tm.define("tm.util.File",{superClass:"tm.event.EventDispatcher",data:null,loaded:!1,init:function(t){this.superInit(),this.loaded=!1,1==arguments.length&&this.load(t)},load:function(t){if("string"==typeof t){var e=t;t={url:e}}var i=this;t.success=function(t){i.setData(t);var e=tm.event.Event("load");i.dispatchEvent(e)},tm.util.Ajax.load(t)},setData:function(t){this.data=t,this.loaded=!0},loadLocalStorage:function(){}})}(),tm.util=tm.util||{},function(){tm.util.Timeline=tm.createClass({target:null,tasks:null,fps:30,init:function(){this.tasks=[],this.time=0},at:function(t,e){return this.tasks.push({time:t,action:e}),this},after:function(t,e){return this.at(this.time+t,e),this},clear:function(){return this.tasks=[],this},removeTime:function(){},removeAction:function(){},start:function(){this.isPlaying=!0,this._startTime(),this._updateTime()},resume:function(){this.isPlaying=!0,this._resumeTime(),this._updateTime()},stop:function(){this.isPlaying=!1},rewind:function(){this.time=0},update:function(){if(this.tasks.length>0)for(var t=0,e=this.tasks.length;e>t;++t){var i=this.tasks[t];this.prev<=i.time&&i.time<this.time&&i.action()}},_startTime:function(){this.startTime=(new Date).getTime()},_resumeTime:function(){this.startTime=(new Date).getTime()-this.time},_updateTime:function(){this.isPlaying&&(this._nextTime(),setTimeout(arguments.callee.bind(this),1e3/this.fps))},_nextTime:function(){this.prev=this.time,this.time=(new Date).getTime()-this.startTime,this.update()}})}(),tm.util=tm.util||{},function(){tm.util.DataManager={data:{}},tm.util.DataManager.save=function(){for(var t in this.data){var e=this.data[t];localStorage[t]=JSON.stringify(e)}},tm.util.DataManager.load=function(t){for(var t in localStorage)this.data[t]=JSON.parse(localStorage[t])},tm.util.DataManager.set=function(t,e){return this.data[t]=e,this},tm.util.DataManager.get=function(t){return this.data[t]}}(),tm.util=tm.util||{},function(){tm.define("tm.util.Script",{superClass:"tm.event.EventDispatcher",element:null,loaded:!1,init:function(t){this.superInit(),this.loaded=!1,this.element=document.createElement("script"),this.element.type="text/javascript",this.element.src=t,this.element.charset="UTF-8",this.element.setAttribute("defer",!0),document.head.appendChild(this.element);var e=this;this.element.onload=function(){e.loaded=!0,e.fire(tm.event.Event("load"))}},getElement:function(){return this.element}}),tm.util.Script.load=function(t){var e=tm.util.Script(t);return e},tm.util.Script.loadStats=function(t){t=t||"r11";var e=null;return e=-1!=["r6","r7","r8","r9","10"].indexOf(t)?"http://rawgithub.com/mrdoob/stats.js/"+t+"/build/Stats.js":"http://rawgithub.com/mrdoob/stats.js/"+t+"/build/stats.min.js",this.load(e)},tm.util.Script.loadDatGUI=function(t){t=t||"0.5";var e="http://dat-gui.googlecode.com/git/build/dat.gui.js";return this.load(e)},tm.util.Script.loadThree=function(t){var e="http://rawgithub.com/mrdoob/three.js/{version}/build/three.js";t=t||"r55";var i=e.format({version:t});return this.load(i)},tm.util.Script.loadBulletML=function(t){var e="http://rawgithub.com/daishihmr/bulletml.js/{version}/target/bulletml.for.tmlib.js";t=t||"v0.4.2";var i=e.format({version:t});return this.load(i)}}(),tm.util=tm.util||{},function(){tm.util.QueryString={parse:function(t,e,i){e=e||"&",i=i||"=";for(var n={},s=t.split(e),o=0,a=s.length;a>o;++o){var r=s[o],h=r.indexOf(i);if(h>0){var l=r.substring(0,h),c=r.substring(h+1);n[l]=c}}return n},stringify:function(t,e,i){e=e||"&",i=i||"=";var n=[];for(var s in t){var o=encodeURIComponent(t[s]);n.push(s+i+o)}return n.join(e)}}}(),tm.namespace("tm.util.Type",function(){var t=this,e=Object.prototype.toString;this.defineFunction("isObject",function(t){return t===Object(t)}),this.defineFunction("isArray",function(t){return"[object Array]"==e.call(t)}),this.defineFunction("isArguments",function(t){return"[object Arguments]"==e.call(t)}),this.defineFunction("isFunction",function(t){return"[object Function]"==e.call(t)}),this.defineFunction("isString",function(t){return"[object String]"==e.call(t)}),this.defineFunction("isNumber",function(t){return"[object Number]"==e.call(t)}),this.defineFunction("isDate",function(t){return"[object Date]"==e.call(t)}),this.defineFunction("isRegExp",function(t){return"[object RegExp]"==e.call(t)}),this.defineFunction("isEmpty",function(e){if(!e)return!0;if(t.isArray(e)||t.isString(e)||t.isArguments(e))return 0===e.length;for(var i in e)if(i)return!1;return!0})}),tm.define("tm.util.Flow",{superClass:"tm.event.EventDispatcher",waits:0,counter:0,args:null,init:function(t,e){this.superInit(),t=t||0,e=e||null,this.setup(t,e)},setup:function(t,e){return this.waits=t,this.callback=e,this.counter=0,this.args={},this._check(),this},pass:function(t,e){++this.counter,arguments.length>=2&&(this.args[t]=e),this._check()},isFinish:function(){return this.counter===this.waits},_check:function(){if(this.isFinish()){var t=this.args;this.callback&&(this.callback(t),this.args=null,this.callback=null);var e=tm.event.Event("flowfinish");e.args=t,this.fire(e)}}}),tm.geom=tm.geom||{},function(){tm.geom.Vector2=tm.createClass({x:0,y:0,init:function(t,e){this.set(t,e)},clone:function(){return tm.geom.Vector2(this.x,this.y)},equals:function(t){return this.x===t.x&&this.y===t.y?!0:!1},equalsNumber:function(t,e){return this.x===t&&this.y===e?!0:!1},equalsArray:function(t){return this.x===t[0]&&this.y===t[1]?!0:!1},set:function(t,e){this.x=t,this.y=e},setNumber:function(t,e){return this.x=t,this.y=e,this},setArray:function(t){return this.x=t[0],this.y=t[1],this},setObject:function(t){return this.x=t.x,this.y=t.y,this},setString:function(t){var e=t.match(/(-?\d+(\.{1}\d+)?),\s*(-?\d+(\.{1}\d+)?)/);return this.x=parseFloat(e[1]),this.y=parseFloat(e[3]),this},setSmart:function(t,e){var i=arguments[0];if(2===arguments.length)this.x=t,this.y=e;else if(i instanceof Array)this.x=i[0],this.y=i[1];else if(i instanceof Object)this.x=i.x,this.y=i.y;else if("string"==typeof i){var n=i.match(/(-?\d+(\.{1}\d+)?),\s*(-?\d+(\.{1}\d+)?)/);this.x=parseFloat(n[1]),this.y=parseFloat(n[3])}return this},setAngle:function(t,e){var i=t*Math.DEG_TO_RAD;return e=e||1,this.x=Math.cos(i)*e,this.y=Math.sin(i)*e,this},setRadian:function(t,e){return e=e||1,this.x=Math.cos(t)*e,this.y=Math.sin(t)*e,this},setDegree:function(t,e){var i=t*Math.DEG_TO_RAD;return e=e||1,this.x=Math.cos(i)*e,this.y=Math.sin(i)*e,this},setRandom:function(t,e,i){return t=t||0,e=e||360,i=i||1,this.setDegree(Math.randf(t,e),i),this},add:function(t){return this.x+=t.x,this.y+=t.y,this},sub:function(t){return this.x-=t.x,this.y-=t.y,this},mul:function(t){return this.x*=t,this.y*=t,this},div:function(t){return t=t||.01,this.x/=t,this.y/=t,this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthSquared:function(){return this.x*this.x+this.y*this.y},distance:function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},distanceSquared:function(t){return Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)},normalize:function(){var t=this.length();return this.div(t),this},toAngle:function(){return Math.atan2(this.y,this.x)},toStyleString:function(){return"{x:{x}, y:{y}}".format(this)},toString:function(){return"{x:{x}, y:{y}}".format(this)},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this}}),tm.geom.Vector2.min=function(t,e){return tm.geom.Vector2(t.x<e.x?t.x:e.x,t.y<e.y?t.y:e.y)},tm.geom.Vector2.max=function(t,e){return tm.geom.Vector2(t.x>e.x?t.x:e.x,t.y>e.y?t.y:e.y)},tm.geom.Vector2.add=function(t,e){return tm.geom.Vector2(t.x+e.x,t.y+e.y)},tm.geom.Vector2.sub=function(t,e){return tm.geom.Vector2(t.x-e.x,t.y-e.y)},tm.geom.Vector2.mul=function(t,e){return tm.geom.Vector2(t.x*e,t.y*e)},tm.geom.Vector2.div=function(t,e){return tm.geom.Vector2(t.x/e,t.y/e)},tm.geom.Vector2.negate=function(t){return tm.geom.Vector2(-t.x,-t.y)},tm.geom.Vector2.dot=function(t,e){return t.x*e.x+t.y*e.y},tm.geom.Vector2.cross=function(t,e){return t.x*e.y-t.y*e.x},tm.geom.Vector2.distance=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},tm.geom.Vector2.distanceSquared=function(t,e){return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)},tm.geom.Vector2.manhattanDistance=function(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)},tm.geom.Vector2.reflect=function(t,e){var i=Vector2.dot(t,e),n=Vector2.mul(e,2*i);return tm.geom.Vector2.sub(t,n)},tm.geom.Vector2.lerp=function(t,e,i){return tm.geom.Vector2(t.x+(e.x-t.x)*i,t.y+(e.y-t.y)*i)},tm.geom.Vector2.slerp=function(){},tm.geom.Vector2.random=function(t,e,i){return t=t||0,e=e||360,i=i||1,tm.geom.Vector2().setDegree(Math.randf(t,e),i)},tm.geom.Vector2.ZERO=tm.geom.Vector2(0,0),tm.geom.Vector2.LEFT=tm.geom.Vector2(-1,0),tm.geom.Vector2.RIGHT=tm.geom.Vector2(1,0),tm.geom.Vector2.UP=tm.geom.Vector2(0,1),tm.geom.Vector2.DOWN=tm.geom.Vector2(0,-1)}(),tm.geom=tm.geom||{},function(){tm.geom.Vector3=tm.createClass({x:0,y:0,z:0,init:function(t,e,i){this.set(t,e,i)},set:function(t,e,i){return this.x=t,this.y=e,this.z=i,this},setNumber:function(t,e,i){return this.x=t,this.y=e,this.z=i,this},setArray:function(t){return this.x=t[0],this.y=t[1],this.z=t[2],this},setObject:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},setString:function(t){var e=t.match(/(-?\d+(\.{1}\d+)?),\s*(-?\d+(\.{1}\d+)?),\s*(-?\d+(\.{1}\d+)?)/);return this.x=parseFloat(e[1]),this.y=parseFloat(e[3]),this.z=parseFloat(e[5]),this},setAngle:function(t,e,i){return i=i||1,this.x=i*Math.cos(t)*Math.sin(e),this.y=i*Math.sin(t),this.z=i*Math.cos(t)*Math.cos(e),this},setRadian:function(t,e,i){return this.setAngle(t,e,i)},setDegree:function(t,e,i){return this.setAngle(t*Math.DEG_TO_RAD,e*Math.DEG_TO_RAD,i)},setSmart:function(t,e,i){var n=arguments[0];if(3===arguments.length)this.x=t,this.y=e,this.z=i;else if(n instanceof Array)this.x=n[0],this.y=n[1],this.z=n[2];else if(n instanceof Object)this.x=n.x,this.y=n.y,this.z=n.z;else if("string"==typeof n){var s=n.match(/(-?\d+(\.{1}\d+)?),\s*(-?\d+(\.{1}\d+)?),\s*(-?\d+(\.{1}\d+)?)/);this.x=parseFloat(s[1]),this.y=parseFloat(s[3]),this.z=parseFloat(s[5])}return this},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},sub:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this
},mul:function(t){return this.x*=t,this.y*=t,this.z*=t,this},div:function(t){return console.assert(0!=t,"0 division!!"),this.x/=t,this.y/=t,this.z/=t,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},cross:function(t){var e=this.y*t.z-this.z*t.y,i=this.z*t.x-this.x*t.z,n=this.x*t.y-this.y*t.x;return this.set(e,i,n),this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSquared:function(){return this.x*this.x+this.y*this.y+this.z*this.z},normalize:function(){var t=this.length();return this.div(t),this},toVector2:function(){},toAngleXY:function(){return Math.atan2(this.y,this.x)},to3D:function(){},equals:function(t,e,i){return this.x===t&&this.y===e&&this.z===i},equalsArray:function(t){return this.equals(t[0],t[1],t[2])},equalsObject:function(t){return this.equals(t.x,t.y,t.z)},equalsSmart:function(){},toStyleString:function(){return"{x:{x}, y:{y}, z:{z}}".format(this)},toString:function(){return"{x:{x}, y:{y}, z:{z}}".format(this)},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this}}),tm.geom.Vector3.min=function(t,e){return Vector3(t.x<e.x?t.x:e.x,t.y<e.y?t.y:e.y,t.z<e.z?t.z:e.z)},tm.geom.Vector3.max=function(t,e){return Vector3(t.x>e.x?t.x:e.x,t.y>e.y?t.y:e.y,t.z>e.z?t.z:e.z)},tm.geom.Vector3.add=function(t,e){return tm.geom.Vector3(t.x+e.x,t.y+e.y,t.z+e.z)},tm.geom.Vector3.sub=function(t,e){return tm.geom.Vector3(t.x-e.x,t.y-e.y,t.z-e.z)},tm.geom.Vector3.mul=function(t,e){return tm.geom.Vector3(t.x*e,t.y*e,t.z*e)},tm.geom.Vector3.div=function(t,e){return tm.geom.Vector3(t.x/e,t.y/e,t.z/e)},tm.geom.Vector3.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},tm.geom.Vector3.cross=function(t,e){return tm.geom.Vector3(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)},tm.geom.Vector3.negate=function(t){return tm.geom.Vector3(-t.x,-t.y,-t.z)},tm.geom.Vector3.distance=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)+Math.pow(t.z-e.z,2))},tm.geom.Vector3.distanceSquared=function(t,e){return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)+Math.pow(t.z-e.z,2)},tm.geom.Vector3.manhattanDistance=function(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)+Math.abs(t.z-e.z)},tm.geom.Vector3.reflect=function(t,e){var i=Vector3.dot(t,e),n=Vector3.mul(e,2*i);return Vector3.sub(t,n)},tm.geom.Vector3.lerp=function(t,e,i){return tm.geom.Vector3(t.x+(e.x-t.x)*i,t.y+(e.y-t.y)*i,t.z+(e.z-t.z)*i)},tm.geom.Vector3.slerp=function(){},tm.geom.Vector3.random=function(t,e,i,n,s){return t=t||0,e=e||360,i=i||0,n=n||360,s=s||1,TM.Geom.Vector3().setFromDegree(TM.randomf(t,e),TM.randomf(i,n),s)},tm.geom.Vector3.ZERO=tm.geom.Vector3(0,0,0),tm.geom.Vector3.LEFT=tm.geom.Vector3(-1,0,0),tm.geom.Vector3.RIGHT=tm.geom.Vector3(1,0,0),tm.geom.Vector3.UP=tm.geom.Vector3(0,1,0),tm.geom.Vector3.DOWN=tm.geom.Vector3(0,-1,0),tm.geom.Vector3.FORWARD=tm.geom.Vector3(0,0,-1),tm.geom.Vector3.BACKWARD=tm.geom.Vector3(0,0,1)}(),tm.geom=tm.geom||{},function(){tm.define("tm.geom.Matrix33",{m:null,init:function(){this.m=[],arguments.length>=9?this.set.apply(this,arguments):this.identity()},clone:function(){var t=this.m;return tm.geom.Matrix33(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8])},set:function(t,e,i,n,s,o,a,r,h){return console.assert(arguments.length>=9,""),this.m00=t,this.m01=e,this.m02=i,this.m10=n,this.m11=s,this.m12=o,this.m20=a,this.m21=r,this.m22=h,this},setArray:function(t){return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},setObject:function(t){return this.set(t.m00,t.m01,t.m02,t.m10,t.m11,t.m12,t.m20,t.m21,t.m22),this},identity:function(){var t=this.m;return t[0]=1,t[3]=0,t[6]=0,t[1]=0,t[4]=1,t[7]=0,t[2]=0,t[5]=0,t[8]=1,this},transpose:function(){return this.m.swap(1,3),this.m.swap(2,6),this.m.swap(5,7),this},invert:function(){var t=this.m,e=t[0],i=t[3],n=t[6],s=t[1],o=t[4],a=t[7],r=t[2],h=t[5],l=t[8],c=this.determinant();return this.m00=(o*l-a*h)/c,this.m01=(s*l-a*r)/c*-1,this.m02=(s*h-o*r)/c,this.m10=(i*l-n*h)/c*-1,this.m11=(e*l-n*r)/c,this.m12=(e*h-i*r)/c*-1,this.m20=(i*a-n*o)/c,this.m21=(e*a-n*s)/c*-1,this.m22=(e*o-i*s)/c,this.transpose(),this},determinant:function(){var t=this.m,e=t[0],i=t[3],n=t[6],s=t[1],o=t[4],a=t[7],r=t[2],h=t[5],l=t[8];return e*o*l+s*h*n+i*a*r-n*o*r-i*s*l-a*h*e},zero:function(){return this.set(0,0,0,0,0,0,0,0,0),this},translate:function(t,e){var i=this.m;return i[6]=i[0]*t+i[3]*e+i[6],i[7]=i[1]*t+i[4]*e+i[7],i[8]=i[2]*t+i[5]*e+i[8],this},rotateX:function(t){return this.multiply(tm.geom.Matrix33.rotateX(t))},rotateY:function(t){return this.multiply(tm.geom.Matrix33.rotateY(t))},rotateZ:function(t){{var e=(Math.sin(t),Math.cos(t),this.m);e[0],e[1],e[2],e[3],e[4],e[5]}return this.multiply(tm.geom.Matrix33.rotateZ(t))},scale:function(t,e){var i=this.m;return i[0]*=t,i[3]*=e,i[1]*=t,i[4]*=e,i[2]*=t,i[5]*=e,this},multiply:function(t){var e=this.m,i=t.m,n=e[0],s=e[3],o=e[6],a=e[1],r=e[4],h=e[7],l=e[2],c=e[5],u=e[8],m=i[0],p=i[3],d=i[6],f=i[1],g=i[4],y=i[7],v=i[2],b=i[5],x=i[8];return e[0]=n*m+s*f+o*v,e[3]=n*p+s*g+o*b,e[6]=n*d+s*y+o*x,e[1]=a*m+r*f+h*v,e[4]=a*p+r*g+h*b,e[7]=a*d+r*y+h*x,e[2]=l*m+c*f+u*v,e[5]=l*p+c*g+u*b,e[8]=l*d+c*y+u*x,this},multiplyVector2:function(t){var e=this.m00*t.x+this.m01*t.y+this.m02,i=this.m10*t.x+this.m11*t.y+this.m12;return tm.geom.Vector2(e,i)},multiplyVector3:function(t){var e=this.m00*t.x+this.m01*t.y+this.m02*t.z,i=this.m10*t.x+this.m11*t.y+this.m12*t.z,n=this.m20*t.x+this.m21*t.y+this.m22*t.z;return tm.geom.Vector3(e,i,n)},toArray:function(){return this.m.slice()},toString:function(){return"|{m00}, {m01}, {m02}|\n|{m10}, {m11}, {m12}|\n|{m20}, {m21}, {m22}|".format(this)}}),tm.geom.Matrix33.prototype.accessor("m00",{get:function(){return this.m[0]},set:function(t){this.m[0]=t}}),tm.geom.Matrix33.prototype.accessor("m10",{get:function(){return this.m[1]},set:function(t){this.m[1]=t}}),tm.geom.Matrix33.prototype.accessor("m20",{get:function(){return this.m[2]},set:function(t){this.m[2]=t}}),tm.geom.Matrix33.prototype.accessor("m01",{get:function(){return this.m[3]},set:function(t){this.m[3]=t}}),tm.geom.Matrix33.prototype.accessor("m11",{get:function(){return this.m[4]},set:function(t){this.m[4]=t}}),tm.geom.Matrix33.prototype.accessor("m21",{get:function(){return this.m[5]},set:function(t){this.m[5]=t}}),tm.geom.Matrix33.prototype.accessor("m02",{get:function(){return this.m[6]},set:function(t){this.m[6]=t}}),tm.geom.Matrix33.prototype.accessor("m12",{get:function(){return this.m[7]},set:function(t){this.m[7]=t}}),tm.geom.Matrix33.prototype.accessor("m22",{get:function(){return this.m[8]},set:function(t){this.m[8]=t}}),tm.geom.Matrix33.prototype.accessor("a",{get:function(){return this.m[0]},set:function(t){this.m[0]=t}}),tm.geom.Matrix33.prototype.accessor("b",{get:function(){return this.m[3]},set:function(t){this.m[3]=t}}),tm.geom.Matrix33.prototype.accessor("c",{get:function(){return this.m[1]},set:function(t){this.m[1]=t}}),tm.geom.Matrix33.prototype.accessor("d",{get:function(){return this.m[4]},set:function(t){this.m[4]=t}}),tm.geom.Matrix33.prototype.accessor("tx",{get:function(){return this.m[6]},set:function(t){this.m[6]=t}}),tm.geom.Matrix33.prototype.accessor("ty",{get:function(){return this.m[7]},set:function(t){this.m[7]=t}}),tm.geom.Matrix33.translate=function(t,e){return tm.geom.Matrix33(1,0,t,0,1,e,0,0,1)},tm.geom.Matrix33.rotateX=function(t){var e=Math.cos(t),i=Math.sin(t);return tm.geom.Matrix33(1,0,0,0,e,-i,0,i,e)},tm.geom.Matrix33.rotateY=function(t){var e=Math.cos(t),i=Math.sin(t);return tm.geom.Matrix33(e,0,i,0,1,0,-i,0,e)},tm.geom.Matrix33.rotateZ=function(t){var e=Math.cos(t),i=Math.sin(t);return tm.geom.Matrix33(e,-i,0,i,e,0,0,0,1)},tm.geom.Matrix33.scale=function(t,e){var i=tm.geom.Matrix33();return void 0==e&&(e=t),i.set(t,0,0,0,e,0,0,0,1),i}}(),tm.geom=tm.geom||{},function(){tm.geom.Matrix44=tm.createClass({m:null,init:function(){this.m=[],arguments.length>=16?this.set.apply(this,arguments):this.identity()},set:function(t,e,i,n,s,o,a,r,h,l,c,u,m,p,d,f){return console.assert(arguments.length>=16,""),this.m00=t,this.m01=e,this.m02=i,this.m03=n,this.m10=s,this.m11=o,this.m12=a,this.m13=r,this.m20=h,this.m21=l,this.m22=c,this.m23=u,this.m30=m,this.m31=p,this.m32=d,this.m33=f,this},setArray:function(t){return this.set(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]),this},setObject:function(t){return this.set(t.m00,t.m01,t.m02,t.m03,t.m10,t.m11,t.m12,t.m13,t.m20,t.m21,t.m22,t.m23,t.m30,t.m31,t.m32,t.m33),this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},transpose:function(){return this.m.swap(1,4),this.m.swap(2,8),this.m.swap(3,12),this.m.swap(6,9),this.m.swap(7,13),this.m.swap(11,14),this},translate:function(t,e,i){return this.multiply(tm.geom.Matrix44.translate(t,e,i))},rotate:function(){console.error("Unimplemented")},rotateX:function(t){return this.multiply(tm.geom.Matrix44.rotateX(t))},rotateY:function(t){return this.multiply(tm.geom.Matrix44.rotateY(t))},rotateZ:function(t){return this.multiply(tm.geom.Matrix44.rotateZ(t))},scale:function(t,e,i){return this.multiply(tm.geom.Matrix44.scale(t,e,i))},zero:function(){return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this},multiply:function(t){var e=this.m00*t.m00+this.m01*t.m10+this.m02*t.m20+this.m03*t.m30,i=this.m00*t.m01+this.m01*t.m11+this.m02*t.m21+this.m03*t.m31,n=this.m00*t.m02+this.m01*t.m12+this.m02*t.m22+this.m03*t.m32,s=this.m00*t.m03+this.m01*t.m13+this.m02*t.m23+this.m03*t.m33,o=this.m10*t.m00+this.m11*t.m10+this.m12*t.m20+this.m13*t.m30,a=this.m10*t.m01+this.m11*t.m11+this.m12*t.m21+this.m13*t.m31,r=this.m10*t.m02+this.m11*t.m12+this.m12*t.m22+this.m13*t.m32,h=this.m10*t.m03+this.m11*t.m13+this.m12*t.m23+this.m13*t.m33,l=this.m20*t.m00+this.m21*t.m10+this.m22*t.m20+this.m23*t.m30,c=this.m20*t.m01+this.m21*t.m11+this.m22*t.m21+this.m23*t.m31,u=this.m20*t.m02+this.m21*t.m12+this.m22*t.m22+this.m23*t.m32,m=this.m20*t.m03+this.m21*t.m13+this.m22*t.m23+this.m23*t.m33,p=this.m30*t.m00+this.m31*t.m10+this.m32*t.m20+this.m33*t.m30,d=this.m30*t.m01+this.m31*t.m11+this.m32*t.m21+this.m33*t.m31,f=this.m30*t.m02+this.m31*t.m12+this.m32*t.m22+this.m33*t.m32,g=this.m30*t.m03+this.m31*t.m13+this.m32*t.m23+this.m33*t.m33;return this.set(e,i,n,s,o,a,r,h,l,c,u,m,p,d,f,g)},getAxisX:function(){return TM.Geom.Vector3(this.m00,this.m01,this.m02)},getAxisY:function(){return TM.Geom.Vector3(this.m10,this.m11,this.m12)},getAxisZ:function(){return TM.Geom.Vector3(this.m20,this.m21,this.m22)},setAxisX:function(t){this.m00=t.x,this.m01=t.y,this.m02=t.z},setAxisY:function(t){this.m10=t.x,this.m11=t.y,this.m12=t.z},setAxisZ:function(t){this.m20=t.x,this.m21=t.y,this.m22=t.z},toMatrix33:function(){},toArray:function(){return this.m.slice()},toString:function(){return"|{m00}, {m01}, {m02}, {m03}|\n|{m10}, {m11}, {m12}, {m13}|\n|{m20}, {m21}, {m22}, {m23}|\n|{m30}, {m31}, {m32}, {m33}|".format(this)}}),tm.geom.Matrix44.prototype.accessor("m00",{get:function(){return this.m[0]},set:function(t){this.m[0]=t}}),tm.geom.Matrix44.prototype.accessor("m10",{get:function(){return this.m[1]},set:function(t){this.m[1]=t}}),tm.geom.Matrix44.prototype.accessor("m20",{get:function(){return this.m[2]},set:function(t){this.m[2]=t}}),tm.geom.Matrix44.prototype.accessor("m30",{get:function(){return this.m[3]},set:function(t){this.m[3]=t}}),tm.geom.Matrix44.prototype.accessor("m01",{get:function(){return this.m[4]},set:function(t){this.m[4]=t}}),tm.geom.Matrix44.prototype.accessor("m11",{get:function(){return this.m[5]},set:function(t){this.m[5]=t}}),tm.geom.Matrix44.prototype.accessor("m21",{get:function(){return this.m[6]},set:function(t){this.m[6]=t}}),tm.geom.Matrix44.prototype.accessor("m31",{get:function(){return this.m[7]},set:function(t){this.m[7]=t}}),tm.geom.Matrix44.prototype.accessor("m02",{get:function(){return this.m[8]},set:function(t){this.m[8]=t}}),tm.geom.Matrix44.prototype.accessor("m12",{get:function(){return this.m[9]},set:function(t){this.m[9]=t}}),tm.geom.Matrix44.prototype.accessor("m22",{get:function(){return this.m[10]},set:function(t){this.m[10]=t}}),tm.geom.Matrix44.prototype.accessor("m32",{get:function(){return this.m[11]},set:function(t){this.m[11]=t}}),tm.geom.Matrix44.prototype.accessor("m03",{get:function(){return this.m[12]},set:function(t){this.m[12]=t}}),tm.geom.Matrix44.prototype.accessor("m13",{get:function(){return this.m[13]},set:function(t){this.m[13]=t}}),tm.geom.Matrix44.prototype.accessor("m23",{get:function(){return this.m[14]},set:function(t){this.m[14]=t}}),tm.geom.Matrix44.prototype.accessor("m33",{get:function(){return this.m[15]},set:function(t){this.m[15]=t}}),tm.geom.Matrix44.translate=function(t,e,i){return tm.geom.Matrix44(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1)},tm.geom.Matrix44.rotateX=function(t){var e=Math.cos(t),i=Math.sin(t);return tm.geom.Matrix44(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1)},tm.geom.Matrix44.rotateY=function(t){var e=Math.cos(t),i=Math.sin(t);return tm.geom.Matrix44(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1)},tm.geom.Matrix44.rotateZ=function(t){var e=Math.cos(t),i=Math.sin(t);return tm.geom.Matrix44(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1)},tm.geom.Matrix44.scale=function(t,e,i){var n=tm.geom.Matrix44();return void 0==e&&(e=t),void 0==i&&(i=t),n.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),n},tm.geom.Matrix44.perspective=function(t,e,i,n){var s=1/Math.tan(.5*t*Math.PI/180),o=s/e;return tm.geom.Matrix44(o,0,0,0,0,s,0,0,0,0,n/(n-i),i*n/(i-n),0,0,1,0)},tm.geom.Matrix44.ortho=function(t,e,i,n,s,o){var a=e-t,r=n-i,h=o-s;return tm.geom.Matrix44(2/a,0,0,0,0,2/r,0,0,0,0,-2/h,0,-(t+e)/a,-(n+i)/r,-(o+s)/h,1).transpose()},tm.geom.Matrix44.lookAt=function(t,e,i){var n=tm.geom.Vector3.sub(t,e).normalize(),s=tm.geom.Vector3.cross(i,n).normalize(),o=tm.geom.Vector3.cross(n,s).normalize(),a=tm.geom.Matrix44(s.x,o.x,n.x,0,s.y,o.y,n.y,0,s.z,o.z,n.z,0,0,0,0,1),r=tm.geom.Matrix44(1,0,0,0,0,1,0,0,0,0,1,0,-t.x,-t.y,-t.z,1);return r.multiply(a)}}(),tm.geom=tm.geom||{},function(){tm.geom.Rect=tm.createClass({x:0,y:0,width:0,height:0,init:function(t,e,i,n){this.set(t,e,i,n)},set:function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},move:function(t,e){return this.x=t,this.y=e,this},moveBy:function(t,e){return this.x+=t,this.y+=e,this},resize:function(t,e){return this.width=t,this.height=e,this},resizeBy:function(t,e){return this.width+=t,this.height+=e,this},padding:function(t,e,i,n){switch(arguments.length){case 1:t=e=i=n=arguments[0];break;case 2:t=i=arguments[0],e=n=arguments[1];break;case 3:t=arguments[0],e=n=arguments[1],i=arguments[2]}return this.x+=n,this.y+=t,this.width-=n+e,this.height-=t+i,this},contains:function(t,e){return this.left<=t&&t<=this.right&&this.top<=e&&e<=this.bottom},clone:function(){return tm.geom.Rect(this.x,this.y,this.width,this.height)},toCircle:function(){return tm.geom.Circle(this.centerX,this.centerY,(this.width<this.height?this.width:this.height)/2)},toArray:function(){return[this.x,this.y,this.width,this.height]}}),tm.geom.Rect.prototype.accessor("left",{get:function(){return this.x},set:function(t){this.width-=t-this.x,this.x=t}}),tm.geom.Rect.prototype.accessor("top",{get:function(){return this.y},set:function(t){this.height-=t-this.y,this.y=t}}),tm.geom.Rect.prototype.accessor("right",{get:function(){return this.x+this.width},set:function(t){this.width+=t-this.right}}),tm.geom.Rect.prototype.accessor("bottom",{get:function(){return this.y+this.height},set:function(t){this.height+=t-this.bottom}}),tm.geom.Rect.prototype.accessor("centerX",{get:function(){return this.x+this.width/2},set:function(){}}),tm.geom.Rect.prototype.accessor("centerY",{get:function(){return this.y+this.height/2},set:function(){}})}(),tm.geom=tm.geom||{},function(){tm.define("tm.geom.Circle",{x:0,y:0,radius:0,init:function(t,e,i){this.set(t,e,i)},set:function(t,e,i){return this.x=t,this.y=e,this.radius=i,this},move:function(t,e){return this.x=t,this.y=e,this},moveBy:function(t,e){return this.x+=t,this.y+=e,this},resize:function(t){return this.radius=t,this},resizeBy:function(t){return this.radius+=t,this},contains:function(t,e){var i=this.x-t,n=this.y-e,s=i*i+n*n;return s<=this.radius*this.radius},clone:function(){return tm.geom.Circle(this.x,this.y,this.radius)},toRect:function(){return tm.geom.Rect(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},toArray:function(){return[this.x,this.y,this.radius]}}),tm.geom.Circle.prototype.getter("left",function(){return this.x-this.radius}),tm.geom.Circle.prototype.getter("top",function(){return this.y-this.radius}),tm.geom.Circle.prototype.getter("right",function(){return this.x+this.radius}),tm.geom.Circle.prototype.getter("bottom",function(){return this.y+this.radius})}(),tm.collision=tm.collision||{},function(){tm.collision,tm.collision.testCircleCircle=function(t,e){var i=tm.geom.Vector2.distanceSquared(t,e);return i<=Math.pow(t.radius+e.radius,2)},tm.collision.testRectRect=function(t,e){return t.left<e.right&&t.right>e.left&&t.top<e.bottom&&t.bottom>e.top},tm.collision.testCircleRect=function(t,e){var i=tm.geom.Rect(e.left-t.radius,e.top-t.radius,e.width+2*t.radius,e.height+2*t.radius);if(0==i.contains(t.x,t.y))return!1;var n=tm.geom.Rect(e.left-t.radius,e.top,e.width+2*t.radius,e.height);if(n.contains(t.x,t.y))return!0;if(n.set(e.left,e.top-t.radius,e.width,e.height+2*t.radius),n.contains(t.x,t.y))return!0;var s=tm.geom.Circle(t.x,t.y,t.radius);return s.contains(e.left,e.top)?!0:s.contains(e.right,e.top)?!0:s.contains(e.right,e.bottom)?!0:s.contains(e.left,e.bottom)?!0:!1},tm.collision.testRectCircle=function(t,e){return this.testCircleRect(e,t)}}(),tm.dom=tm.dom||{},function(){tm.dom.Element=tm.createClass({element:null,init:function(){this.set.apply(this,arguments)},set:function(t){this.element="string"==typeof t?document.querySelector(t):void 0!=t?t:document},append:function(t){return this.element.appendChild(t.element),this},prepend:function(t){return this.element.insertBefore(t.element,this.element.firstChild),this},after:function(t){return this.element.parentNode.insertBefore(t.element,this.element.nextSibling),this},before:function(t){return this.element.parentNode.insertBefore(t.element,this.element),this},appendTo:function(t){return t.append(this),this},prependTo:function(t){return t.prepend(this),this},clone:function(){return tm.dom.Element(this.element.cloneNode(!0))},remove:function(){return this.element.parentNode.removeChild(this.element),this},create:function(t,e){var i=tm.dom.Element(document.createElement(t));return e||(e="append"),this[e](i),i},query:function(t,e){var i=e?this.element.querySelectorAll(t)[e]:this.element.querySelector(t);return tm.dom.Element(i)},queryAll:function(t){var e=this.element.querySelectorAll(t);return tm.dom.ElementList(e)},fixed:function(t,e,i,n){return this.style.set("position","fixed"),t&&(this.x=t),e&&(this.y=e),i&&(this.width=i),n&&(this.height=n),this},absolute:function(t,e,i,n){return this.style.set("position","absolute"),t&&(this.x=t),e&&(this.y=e),i&&(this.width=i),n&&(this.height=n),this},fullScreen:function(){this.element.webkitRequestFullScreen()},show:function(){this.visible=!0},hide:function(){this.visible=!1},toString:function(){return"tm.dom.element"},getElement:function(){return this.element}}),tm.dom.Element.prototype.accessor("html",{get:function(){return this.element.innerHTML},set:function(t){this.element.innerHTML=t}}),tm.dom.Element.prototype.accessor("value",{get:function(){return this.element.value},set:function(t){this.element.value=t}}),tm.dom.Element.prototype.accessor("x",{get:function(){return Number(this.element.style.left.replace("px",""))},set:function(t){this.element.style.left=t+"px"}}),tm.dom.Element.prototype.accessor("y",{get:function(){return Number(this.element.style.top.replace("px",""))},set:function(t){this.element.style.top=t+"px"}}),tm.dom.Element.prototype.accessor("width",{get:function(){return Number(this.element.style.width.replace("px",""))},set:function(t){this.element.style.width=t+"px"}}),tm.dom.Element.prototype.accessor("height",{get:function(){return Number(this.element.style.height.replace("px",""))},set:function(t){this.element.style.height=t+"px"}}),tm.dom.Element.prototype.accessor("color",{get:function(){return this.element.style.color},set:function(t){this.element.style.color=t}}),tm.dom.Element.prototype.accessor("backgroundColor",{get:function(){return this.element.style.backgroundColor},set:function(t){this.element.style.backgroundColor=t}}),tm.dom.Element.prototype.accessor("visible",{get:function(){return"hidden"!=this.element.style.visibility},set:function(t){this.element.style.visibility=1==t?"visible":"hidden"}}),tm.dom.Element.prototype.accessor("text",{get:function(){return this.element.innerText||this.element.textContent},set:function(t){this.element.innerText?this.element.innerText=t:this.element.textContent=t}}),tm.dom.Element.prototype.getter("classList",function(){return this.element.classList}),tm.dom.Element.prototype.getter("parent",function(){return void 0!=this.element.parentNode?tm.dom.Element(this.element.parentNode):null}),tm.dom.Element.prototype.getter("prev",function(){return void 0!=this.element.previousSibling?tm.dom.Element(this.element.previousSibling):null}),tm.dom.Element.prototype.getter("next",function(){return void 0!=this.element.nextSibling?tm.dom.Element(this.element.nextSibling):null}),tm.dom.Element.prototype.getter("children",function(){return tm.dom.ElementList(this.element.children)})}(),function(){tm.dom.ElementList=tm.createClass({superClass:Array,init:function(t){if("string"==typeof arguments[0]){var e=arguments[0];t=document.querySelectorAll(e)}else if(void 0==t)return;for(var i=0,n=t.length;n>i;++i)this.push(tm.dom.Element(t[i]))},toString:function(){return""}})}(),tm.dom=tm.dom||{},function(){Event.prototype.stopPropagation||(Event.prototype.stopPropagation=function(){this.cancelBubble=!0}),Event.prototype.preventDefault||(Event.prototype.preventDefault=function(){this.returnValue=!1}),Event.prototype.stop=function(){this.preventDefault(),this.stopPropagation()}}(),function(){KeyboardEvent.prototype.getter("character",function(){return String.fromCharCode(this.keyCode)})}(),function(){MouseEvent.prototype.getter("pointX",function(){return this.clientX-this.target.getBoundingClientRect().left}),MouseEvent.prototype.getter("pointY",function(){return this.clientY-this.target.getBoundingClientRect().top})}(),function(){void 0!==window.TouchEvent&&(TouchEvent.prototype.getter("pointX",function(){return this.touches[0].clientX-this.target.getBoundingClientRect().left}),TouchEvent.prototype.getter("pointY",function(){return this.touches[0].clientY-this.target.getBoundingClientRect().top}))}(),function(){tm.dom.Event=tm.createClass({element:null,funcList:null,funcIndex:0,init:function(t){this.element=t,this.domElement=t.element,this.funcList={}},add:function(t,e,i){var n=this.element,s=function(t){var i=e.apply(n,arguments);return i===!1&&(t.preventDefault(),t.returnValue=!1,t.stopPropagation()),i};return this._funcIndex=this._funcIndex||0,i=i||this._funcIndex++,this.funcList[t]=this.funcList[t]||{},this.funcList[t][i]=s,e._id=i,this.domElement.addEventListener(t,s,!1),this},remove:function(t,e){var i="function"==typeof e?e._id:e,n=this.getFunc(t,i);this.domElement.removeEventListener(t,n,!1),delete this.funcList[t][i]},click:function(t,e){return this.add("click",t,e),this},mdlclick:function(t,e){var i=function(e){1==e.button&&t(e)};this.add("click",i,e)},pointstart:function(t,e){this.add(tm.dom.Event.POINT_START,t,e)},pointmove:function(t,e){this.add(tm.dom.Event.POINT_MOVE,t,e)},pointend:function(t,e){this.add(tm.dom.Event.POINT_END,t,e)},hover:function(t,e){return this.add("mouseover",t,e),this},one:function(t,e,i){var n=this,s=this.element,o=function(){var i=e.apply(s,arguments);return n.remove(t,o),i};return this.add(t,o,i),this},toggle:function(t,e){for(var i=this,n=this.element,s=[],o=0;o<e.length;++o){var a=function(o){return function(){var a=e[o].apply(n,arguments);if(a!==!1){var r=(o+1)%e.length;i.one(t,s[r])}}}(o);s.push(a)}return this.one(t,s[0]),this},getFunc:function(t,e){return this.funcList[t][e]}}),tm.dom.Event.POINT_START=tm.isMobile?"touchstart":"mousedown",tm.dom.Event.POINT_MOVE=tm.isMobile?"touchmove":"mousemove",tm.dom.Event.POINT_END=tm.isMobile?"touchend":"mouseup",tm.dom.Element.prototype.getter("event",function(){return this._event||(this._event=tm.dom.Event(this))})}(),tm.dom=tm.dom||{},function(){tm.dom.Attr=tm.createClass({element:null,init:function(t){this.element=t},set:function(t,e){return this.element.setAttribute(t,e),this},add:function(t,e){var i=this.get(t);return e=i?i+" "+e:e,this.element.setAttribute(t,e),this},remove:function(t,e){if(e){var i=this.get(t),n=i?i.replace(e,"").replace("  "," "):"";this.element.setAttribute(t,n.trim())}else this.element.removeAttribute(t);return this},get:function(t){return this.element.getAttribute(t)},contains:function(t,e){var i=this.get(t);return 1==arguments.length?null!=i:2==arguments.length?(" "+i+" ").indexOf(" "+e+" ")>-1:!1},toggle:function(t,e){return this.contains(t,e)?this.remove(t,e):this.add(t,e),this}}),tm.dom.Element.prototype.getter("attr",function(){return this._attr||(this._attr=tm.dom.Attr(this.element))})}(),tm.dom=tm.dom||{},function(){tm.dom.Style=tm.createClass({element:null,init:function(t){this.element=t},set:function(t,e){return this.element.style[t]=e,this},remove:function(t){return this.element.style.removeProperty(t),this},clear:function(){return this},get:function(t){return this.element.style[t]},getPropValue:function(t){return document.defaultView.getComputedStyle(this.element,"").getPropertyValue(t)}}),tm.dom.Element.prototype.getter("style",function(){return this._style||(this._style=tm.dom.Style(this.element))})}(),tm.dom=tm.dom||{},function(){var t=tm.VENDER_PREFIX,e=t+"Animation",i=t+"AnimationEnd",n=t+"AnimationPlayState",s=t+"AnimationName",o=t+"AnimationDuration",a=t+"AnimationTimingFunction",r=t+"AnimationDelay",h=t+"AnimationIterationCount";tm.dom.Anim=tm.createClass({init:function(t){this.element=t;var e=this;this.element.addEventListener(i,function(){e.stop()},!1)},start:function(){return this.element.style[n]="running",this},stop:function(){return this.element.style[n]="paused",this},setProperty:function(t){if("string"==typeof t)this.element.style[e]=t;else for(var i in t){var n=l[i],s=t[i];n.call(this,s)}return this},setName:function(t){return this.element.style[s]=t,this},setDuration:function(t){return this.element.style[o]=t,this},setTimingFunction:function(t){return this.element.style[a]=t,this},setIterationCount:function(t){return this.element.style[h]=t,this},setDelay:function(t){return this.element.style[r]=t,this},setDirection:function(t){return this.element.style[o]=t,this}});var l={name:tm.dom.Anim.prototype.setName,duration:tm.dom.Anim.prototype.setDuration,timingFunction:tm.dom.Anim.prototype.setTimingFunction,iterationCount:tm.dom.Anim.prototype.setIterationCount,delay:tm.dom.Anim.prototype.setDelay,Name:tm.dom.Anim.prototype.setName,Duration:tm.dom.Anim.prototype.setDuration,TimingFunction:tm.dom.Anim.prototype.setTimingFunction,IterationCount:tm.dom.Anim.prototype.setIterationCount,Delay:tm.dom.Anim.prototype.setDelay};tm.dom.Element.prototype.getter("anim",function(){return this._anim||(this._anim=tm.dom.Anim(this.element))})}(),function(){tm.dom.Trans=tm.createClass({element:null,init:function(t){this.element=t},to:function(t,e){return this.set(t).duration(e||1e3),this},set:function(t){var i=this.element.style,n=[];for(var s in t){var o=e(s);n.push(o.toDash()),i[o]=t[s]+""}return i[tm.dom.Trans.PROPERTY]=n.join(", "),this},duration:function(t){var e=this.element.style;return"number"==typeof t&&(t+="ms"),e[tm.dom.Trans.DURATION]=t,this},easing:function(){var t=this.element.style;return t[tm.dom.Trans.TIMING_FUNCTION]=func,this},end:function(t){var e=tm.dom.Element(this.element);return e.event.add(tm.dom.Trans.END_EVENT,t),this},reset:function(){var t=this.element.style;return t[tm.dom.Trans.PROPERTY]="none",this},translate:function(t,e,i){return this.to({transform:"translate({0}px,{1}px)".format(t,e)},i),this},translate3d:function(t,e,i,n){return this.to({transform:"translate3d({0}px,{1}px,{2}px)".format(t,e,i)},n),this},rotate:function(t,e){return this.to({transform:"rotate({0}deg)".format(t)},e),this},rotate3d:function(t,e,i,n,s){return this.to({transform:"rotate3d({0},{1},{2},{3}deg)".format(t,e,i,n)},s),this},scale:function(t,e,i){return this.to({transform:"scale({0},{1})".format(t,e)},i),this},transform:function(){},setProp:function(t){var i=this.element.style,n=[];for(var s in t){var o=e(s);n.push(o.toDash()),i[o]=t[s]}return i[tm.dom.Trans.PROPERTY]=n.join(", "),this},setDuration:function(t){var e=this.element.style;return e[tm.dom.Trans.DURATION]=t,this},setTimingFunction:function(t){var e=this.element.style;return e[tm.dom.Trans.TIMING_FUNCTION]=t,this},resetProp:function(){var t=this.element.style;return t[tm.dom.Trans.PROPERTY]="none",this},setEndFunction:function(t){var e=tm.dom.Element(this.element);return e.event.add(tm.dom.Trans.END_EVENT,t),this}}),tm.dom.Trans.PROPERTY=tm.VENDER_PREFIX+"TransitionProperty",tm.dom.Trans.DURATION=tm.VENDER_PREFIX+"TransitionDuration",tm.dom.Trans.TIMING_FUNCTION=tm.VENDER_PREFIX+"TransitionTimingFunction",tm.dom.Trans.DELAY=tm.VENDER_PREFIX+"TransitionDelay",tm.dom.Trans.END_EVENT=function(){return{webkit:"webkitTransitionEnd",moz:"transitionend",o:"oTransitionEnd"}[tm.VENDER_PREFIX]}(),tm.dom.Element.prototype.getter("trans",function(){return this._trans||(this._trans=tm.dom.Trans(this.element))});var t={transform:!0},e=function(e){return t[e]===!0?"-"+tm.VENDER_PREFIX+e.capitalizeFirstLetter():e}}(),function(){tm.define("tm.dom.Data",{element:null,init:function(t){this.element=t},set:function(t,e){var i="data-"+t.toDash();return this.element.setAttribute(i,e),this},get:function(t){var e="data-"+t.toDash();return this.element.attributes[e].value}}),tm.dom.Element.prototype.getter("data",function(){return this._data||(this._data=tm.dom.Data(this.element))})}(),function(){tm.asset=tm.asset||{},tm.asset.Manager={assets:{},get:function(t){return this.assets[t]},set:function(t,e){return this.assets[t]=e,this},contains:function(t){return this.assets[t]?!0:!1}}}(),function(){tm.define("tm.asset.Loader",{superClass:"tm.event.EventDispatcher",init:function(){this.superInit(),this.assets={}},contains:function(t){return this.assets[t]?!0:!1},load:function(t){return tm.util.Type.isObject(t)?this._loadByObject(t):this._loadString(arguments[0],arguments[1],arguments[2]),this},get:function(t){return this.assets[t]},set:function(t,e){return this.assets[t]=e,tm.asset.Manager.set(t,e),this},_load:function(t,e,i){e=e||t,i=i||e.split("?")[0].split("#")[0].split(".").last;var n=tm.asset.Loader._funcs[i](e,t);return this.set(t,n),n},_loadString:function(t,e,i){var n={};n[t]={url:e,type:i},this._loadByObject(n)},_loadByObject:function(t){var e=tm.util.Flow(Object.keys(t).length,function(){var t=tm.event.Event("load");this.dispatchEvent(t)}.bind(this)),i=function(t,i){var n=tm.event.Event("progress");n.key=i,n.asset=t,n.progress=(e.counter+1)/e.waits,this.dispatchEvent(n),e.pass()}.bind(this);Object.keys(t).each(function(e){var n=t[e],s=null;s="string"==typeof n?this._load(e,n):this._load(e,n.url||n.src||n.path,n.type),s.loaded?i(s,e):s.on("load",function(){i(s,e)})}.bind(this))}}),tm.asset.Loader._funcs=[],tm.asset.Loader.defineFunction("register",function(t,e){this._funcs[t]=e});var t=function(t){var e=tm.asset.Texture(t);return e},e=function(t){var e=tm.sound.WebAudio(t);return e},i=function(t){var e=tm.asset.MapSheet(t);return e},n=function(t){var e=tm.asset.SpriteSheet(t);return e},s=function(t){var e=tm.util.File();if("string"==typeof t)e.load({url:t,dataType:"json"});else{e.setData(t),e.loaded=!0}return e};tm.asset.Loader.register("png",t),tm.asset.Loader.register("gif",t),tm.asset.Loader.register("jpg",t),tm.asset.Loader.register("jpeg",t),tm.asset.Loader.register("wav",e),tm.asset.Loader.register("mp3",e),tm.asset.Loader.register("ogg",e),tm.asset.Loader.register("m4a",e),tm.asset.Loader.register("json",s),tm.asset.Loader.register("tmx",i),tm.asset.Loader.register("tmss",n)
}(),function(){tm.define("tm.asset.Texture",{superClass:"tm.event.EventDispatcher",element:null,loaded:!1,init:function(t){this.superInit(),this.element=new Image,!tm.isLocal()&&!/^data:/.test(t),this.element.src=t;var e=this;this.element.onload=function(){e.loaded=!0;var t=tm.event.Event("load");e.dispatchEvent(t)},this.element.onerror=function(e){console.error("[tmlib] {0}の読み込みに失敗!".format(t));var i=t.split("/").last.replace(".png","").split("?").first.split("#").first,n=e.target;n.src="http://dummyimage.com/128x128/444444/eeeeee&text="+i,n.onerror=null}},getElement:function(){return this.element}}),tm.asset.Texture.prototype.getter("width",function(){return this.element.width}),tm.asset.Texture.prototype.getter("height",function(){return this.element.height})}(),function(){tm.define("tm.asset.SpriteSheet",{superClass:"tm.event.EventDispatcher",loaded:!1,init:function(t){this.superInit(),this.loaded=!1,"string"==typeof t?this.load(t):(this.parse(t),this.loaded=!0,this.dispatchEvent(tm.event.Event("load")))},load:function(t){tm.util.Ajax.load({url:t,dataType:"json",success:function(t){this.parse(t),this.loaded=!0}.bind(this)})},parse:function(t){if(this.frame=t.frame,"string"==typeof t.image){if(!tm.asset.Manager.contains(t.image)){var e=tm.asset.Loader();e.load(t.image)}this.image=tm.asset.Manager.get(t.image)}else this.image=t.image;if(this.image.loaded===!1)this.image.addEventListener("load",function(){this._calcFrames(t.frame);var e=tm.event.Event("load");this.dispatchEvent(e)}.bind(this),!1);else{this._calcFrames(t.frame);var i=tm.event.Event("load");this.dispatchEvent(i)}this._calcAnim(t.animations)},getFrame:function(t){return this.frames[t]},getAnimation:function(t){return this.animations[t]},_calcFrames:function(t){var e=this.frames=[],i=t.width,n=t.height,s=~~(this.image.width/i),o=~~(this.image.height/n);t.count||(t.count=s*o);for(var a=0,r=t.count;r>a;++a){var h=a%s,l=a/s|0,c={x:h*i,y:l*n,width:i,height:n};e.push(c)}},_calcAnim:function(t){this.animations={};for(var e in t){var i=t[e];this.animations[e]=i instanceof Array?{frames:[].range(i[0],i[1]),next:i[2],frequency:i[3]||1}:"number"==typeof i?{frames:[i],next:null,frequency:1}:{frames:i.frames,next:i.next,frequency:i.frequency||1}}this.animations["default"]={frames:[].range(0,this.frame.count),next:"default",frequency:1}}})}(),function(){tm.define("tm.asset.MapSheet",{superClass:"tm.event.EventDispatcher",init:function(t){this.superInit(),this.loaded=!1,"string"==typeof t?tm.util.Ajax.load({url:t,success:function(t){var e=this._parse(t);this.$extend(e),this._checkImage()}.bind(this)}):(this.$extend(arguments[0]),this._checkImage())},_parse:function(t){var e=(Array.prototype.forEach,{}),i=new DOMParser,n=i.parseFromString(t,"text/xml"),s=this._attrToJSON(n.getElementsByTagName("map")[0]);return this.$extend(s),e.tilesets=this._parseTilesets(n),e.layers=this._parseLayers(n),e},_parseTilesets:function(t){var e=Array.prototype.forEach,i=this,n=[],s=t.getElementsByTagName("tileset");return e.call(s,function(t){var e={},s=i._propertiesToJson(t);e.image=s.src?s.src:t.getElementsByTagName("image")[0].getAttribute("source"),n.push(e)}),n},_parseLayers:function(t){var e=Array.prototype.forEach,i=[],n=t.getElementsByTagName("map")[0],s=[];return e.call(n.childNodes,function(t){("layer"==t.tagName||"objectgroup"==t.tagName)&&s.push(t)}),s.each(function(t){if("layer"==t.tagName){var n=t.getElementsByTagName("data")[0],s=n.getAttribute("encoding"),o={type:"layer",name:t.getAttribute("name")};"csv"==s?o.data=this._parseCSV(n.textContent):"base64"==s&&(o.data=this._parseBase64(n.textContent));var a=this._attrToJSON(t);o.$extend(a),i.push(o)}else if("objectgroup"==t.tagName){var o={type:"objectgroup",objects:[],name:t.getAttribute("name")};e.call(t.childNodes,function(t){if(3!=t.nodeType){var e=this._attrToJSON(t);e.properties=this._propertiesToJson(t),o.objects.push(e)}}.bind(this)),i.push(o)}}.bind(this)),i},_parseCSV:function(t){var e=t.split(","),i=[];return e.each(function(t){var e=parseInt(t,10)-1;i.push(e)}),i},_parseBase64:function(t){var e=atob(t.trim()),i=[];e=e.split("").map(function(t){return t.charCodeAt(0)});for(var n=0,s=e.length/4;s>n;++n){var o=e[4*n];i[n]=parseInt(o,10)-1}return i},_propertiesToJson:function(t){var e=t.getElementsByTagName("properties")[0],i={};if(void 0===e)return i;for(var n=0;n<e.childNodes.length;n++){var s=e.childNodes[n];"property"===s.tagName&&(i[s.getAttribute("name")]=s.getAttribute("value"))}return i},_attrToJSON:function(t){for(var e={},i=0;i<t.attributes.length;i++){var n=t.attributes[i].value;n=isNaN(parseFloat(n))?n:parseFloat(n),e[t.attributes[i].name]=n}return e},_checkImage:function(){var t=this;if(this.tilesets.length){var e=0,i=this.tilesets.length,n=function(){if(e++,e==i){this.loaded=!0;var t=tm.event.Event("load");this.dispatchEvent(t)}}.bind(this);this.tilesets.each(function(s){var o=tm.asset.Manager.get(s.image);if(o)if(o.loaded){if(++e,e==i){this.loaded=!0;var a=tm.event.Event("load");t.dispatchEvent(a)}}else o.addEventListener("load",n);else{var r=tm.asset.Loader();r.load(s.image);var h=tm.asset.Manager.get(s.image);h.addEventListener("load",n)}})}else{this.loaded=!0;var s=tm.event.Event("load");this.dispatchEvent(s)}}})}(),tm.asset=tm.asset||{},function(){tm.define("tm.asset.Font",{superClass:"tm.event.EventDispatcher",init:function(t,e,i){this.superInit();var n=tm.dom.Element("head").create("style");n.text="@font-face { font-family: '{0}'; src: url({1}) format('{2}'); }".format(e,t,i),tm.asset.Font.checkLoaded(e,function(){this.flare("load")}.bind(this))}}),tm.asset.Font.checkLoaded=function(t,e){var i=tm.dom.Element("body").create("span");i.style.set("color","rgba(0, 0, 0, 0)").set("fontSize","40px"),i.text="QW@HhsXJ=/()あいうえお＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝";var n=i.element.offsetWidth;i.style.set("fontFamily","'{0}', 'monospace'".format(t));var s=function(){i.element.offsetWidth!==n?(i.remove(),e&&e()):setTimeout(s,100)};setTimeout(s,100)},tm.asset.Loader.register("ttf",function(t,e){return tm.asset.Font(t,e,"truetype")}),tm.asset.Loader.register("otf",function(t,e){return tm.asset.Font(t,e,"opentype")}),tm.asset.Loader.register("woff",function(t,e){return tm.asset.Font(t,e,"woff")}),tm.asset.Loader.register("woff2",function(t,e){return tm.asset.Font(t,e,"woff2")})}(),tm.input=tm.input||{},function(){tm.input.Keyboard=tm.createClass({element:null,key:null,press:null,down:null,up:null,last:null,init:function(t){this.element=t||document,this.key={},this.press={},this.down={},this.up={},this.last={};var e=this;this.element.addEventListener("keydown",function(t){e.key[t.keyCode]=!0}),this.element.addEventListener("keyup",function(t){e.key[t.keyCode]=!1}),this.element.addEventListener("keypress",function(){})},run:function(t){var e=this;t=t||30,tm.setLoop(function(){e._update(),e.update&&e.update()},1e3/t)},_update:function(){for(var t in this.key)this.last[t]=this.press[t],this.press[t]=this.key[t],this.down[t]=(this.press[t]^this.last[t])&this.press[t],this.up[t]=(this.press[t]^this.last[t])&this.last[t];return this},getKey:function(t){return"string"==typeof t&&(t=e[t]),1==this.press[t]},getKeyDown:function(t){return"string"==typeof t&&(t=e[t]),1==this.down[t]},getKeyUp:function(t){return"string"==typeof t&&(t=e[t]),1==this.up[t]},getKeyAngle:function(){var e=null,i=this.getKey("left")<<3|this.getKey("up")<<2|this.getKey("right")<<1|this.getKey("down");return 0!=i&&t.hasOwnProperty(i)&&(e=t[i]),e},getKeyDirection:function(){var t=tm.geom.Vector2(0,0);return this.getKey("left")?t.x=-1:this.getKey("right")&&(t.x=1),this.getKey("up")?t.y=-1:this.getKey("down")&&(t.y=1),t.x&&t.y&&t.div(Math.SQRT2),t},setKey:function(t,i){return"string"==typeof t&&(t=e[t]),this.key[t]=i,this},clearKey:function(){return this.key={},this}});var t={1:270,2:0,4:90,8:180,6:45,3:315,12:135,9:225,14:90,13:180,11:270,7:0},e={backspace:8,tab:9,enter:13,"return":13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,A:65,b:66,B:66,c:67,C:67,d:68,D:68,e:69,E:69,f:70,F:70,g:71,G:71,h:72,H:72,i:73,I:73,j:74,J:74,k:75,K:75,l:76,L:76,m:77,M:77,n:78,N:78,o:79,O:79,p:80,P:80,q:81,Q:81,r:82,R:82,s:83,S:83,t:84,T:84,u:85,U:85,v:86,V:86,w:87,W:87,x:88,X:88,y:89,Y:89,z:90,Z:90,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,subtract:109,decimalpoint:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,semicolon:186,equalsign:187,comma:188,dash:189,period:190,"forward slash":191,"/":191,"grave accent":192,"open bracket":219,"back slash":220,"close bracket":221,"single quote":222,space:32}}(),tm.input=tm.input||{},function(){tm.input.Mouse=tm.createClass({element:null,init:function(t){this.element=t||window.document,this.position=tm.geom.Vector2(0,0),this.deltaPosition=tm.geom.Vector2(0,0),this.prevPosition=tm.geom.Vector2(0,0),this._x=0,this._y=0,this.touches=[];var e=this;this.element.addEventListener("mousedown",function(t){e._mousemove(t),e.prevPosition.set(e._x,e._y),e.button|=1<<t.button}),this.element.addEventListener("mouseup",function(t){e.button&=~(1<<t.button)}),this.element.addEventListener("mousemove",function(t){e._mousemove(t)})},run:function(t){var e=this;return t=t||30,tm.setLoop(function(){e.update()},1e3/t),this},update:function(){this.last=this.press,this.press=this.button,this.down=(this.press^this.last)&this.press,this.up=(this.press^this.last)&this.last,this.deltaPosition.x=this._x-this.position.x,this.deltaPosition.y=this._y-this.position.y,this.prevPosition.setObject(this.position),this.position.set(this._x,this._y)},getButton:function(e){return"string"==typeof e&&(e=t[e]),0!=(this.press&e)},getButtonDown:function(e){return"string"==typeof e&&(e=t[e]),0!=(this.down&e)},getButtonUp:function(e){return"string"==typeof e&&(e=t[e]),0!=(this.up&e)},_mousemove:function(t){var e=t.target.getBoundingClientRect();this._x=t.clientX-e.left,this._y=t.clientY-e.top},_mousemoveNormal:function(t){var e=t.target.getBoundingClientRect();this._x=t.clientX-e.left,this._y=t.clientY-e.top},_mousemoveScale:function(t){var e=t.target.getBoundingClientRect();this._x=t.clientX-e.left,this._y=t.clientY-e.top,t.target.style.width&&(this._x*=t.target.width/parseInt(t.target.style.width)),t.target.style.height&&(this._y*=t.target.height/parseInt(t.target.style.height))}}),tm.input.Mouse.BUTTON_LEFT=1,tm.input.Mouse.BUTTON_MIDDLE=2,tm.input.Mouse.BUTTON_RIGHT=4;var t={left:tm.input.Mouse.BUTTON_LEFT,middle:tm.input.Mouse.BUTTON_MIDDLE,right:tm.input.Mouse.BUTTON_RIGHT};tm.input.Mouse.prototype.accessor("x",{get:function(){return this.position.x},set:function(t){this.position.x=t}}),tm.input.Mouse.prototype.accessor("y",{get:function(){return this.position.y},set:function(t){this.position.y=t}}),tm.input.Mouse.prototype.accessor("dx",{get:function(){return this.deltaPosition.x},set:function(t){this.deltaPosition.x=t}}),tm.input.Mouse.prototype.accessor("dy",{get:function(){return this.deltaPosition.y},set:function(t){this.deltaPosition.y=t}}),tm.input.Mouse.prototype.getPointing=function(){return this.getButton("left")},tm.input.Mouse.prototype.getPointingStart=function(){return this.getButtonDown("left")},tm.input.Mouse.prototype.getPointingEnd=function(){return this.getButtonUp("left")}}(),tm.input=tm.input||{},function(){tm.input.Touch=tm.createClass({element:null,touched:!1,init:function(t){this.element=t||window.document,this.position=tm.geom.Vector2(0,0),this.deltaPosition=tm.geom.Vector2(0,0),this.prevPosition=tm.geom.Vector2(0,0),this._x=0,this._y=0,this.touches=[];var e=this;this.element.addEventListener("touchstart",function(t){e.touched=!0,e._touchmove(t),e.position.set(e._x,e._y),e.prevPosition.set(e._x,e._y),e._setTouches(t)}),this.element.addEventListener("touchend",function(t){e.touched=!1,e._setTouches(t)}),this.element.addEventListener("touchmove",function(t){e._touchmove(t),t.stop(),e._setTouches(t)})},run:function(t){var e=this;return t=t||30,tm.setLoop(function(){e.update()},1e3/t),this},update:function(){this.last=this.now,this.now=Number(this.touched),this.start=(this.now^this.last)&this.now,this.end=(this.now^this.last)&this.last,this.deltaPosition.x=this._x-this.position.x,this.deltaPosition.y=this._y-this.position.y,this.prevPosition.setObject(this.position),this.position.set(this._x,this._y)},getTouch:function(){return 0!=this.touched},getTouchStart:function(){return 0!=this.start},getTouchEnd:function(){return 0!=this.end},_touchmove:function(t){var e=t.touches[0],i=t.target.getBoundingClientRect();this._x=e.clientX-i.left,this._y=e.clientY-i.top},_touchmoveScale:function(t){var e=t.touches[0],i=t.target.getBoundingClientRect();this._x=e.clientX-i.left,this._y=e.clientY-i.top,t.target.style.width&&(this._x*=t.target.width/parseInt(t.target.style.width)),t.target.style.height&&(this._y*=t.target.height/parseInt(t.target.style.height))},_getAdjustPoint:function(t){var e=this.element,i=e.style,n=e.getBoundingClientRect(),t={x:t.clientX-n.left,y:t.clientY-n.top};return i.width&&(t.x*=e.width/parseInt(i.width)),i.height&&(t.y*=e.height/parseInt(i.height)),t},_setTouches:function(t){var e=t.touches;this.touches.clear();for(var i=0,n=e.length;n>i;++i){var s=this._getAdjustPoint(e[i]);this.touches.push(s)}return this}}),tm.input.Touch.prototype.accessor("x",{get:function(){return this.position.x},set:function(t){this.position.x=t}}),tm.input.Touch.prototype.accessor("y",{get:function(){return this.position.y},set:function(t){this.position.y=t}}),tm.input.Touch.prototype.accessor("dx",{get:function(){return this.deltaPosition.x},set:function(t){this.deltaPosition.x=t}}),tm.input.Touch.prototype.accessor("dy",{get:function(){return this.deltaPosition.y},set:function(t){this.deltaPosition.y=t}}),tm.input.Touch.prototype.getPointing=tm.input.Touch.prototype.getTouch,tm.input.Touch.prototype.getPointingStart=tm.input.Touch.prototype.getTouchStart,tm.input.Touch.prototype.getPointingEnd=tm.input.Touch.prototype.getTouchEnd}(),tm.input=tm.input||{},function(){tm.input.Accelerometer=tm.createClass({init:function(){this.gravity=tm.geom.Vector3(0,0,0),this.acceleration=tm.geom.Vector3(0,0,0),this.rotation=tm.geom.Vector3(0,0,0),this.orientation=tm.geom.Vector3(0,0,0);var t=this;window.addEventListener("devicemotion",function(e){var i=t.acceleration,n=t.gravity,s=t.rotation;e.acceleration&&(i.x=e.acceleration.x,i.y=e.acceleration.y,i.z=e.acceleration.z),e.accelerationIncludingGravity&&(n.x=e.accelerationIncludingGravity.x,n.y=e.accelerationIncludingGravity.y,n.z=e.accelerationIncludingGravity.z),e.rotationRate&&(s.x=s.beta=e.rotationRate.beta,s.y=s.gamma=e.rotationRate.gamma,s.z=s.alpha=e.rotationRate.alpha)}),window.addEventListener("deviceorientation",function(e){var i=t.orientation;i.alpha=e.alpha,i.beta=e.beta,i.gamma=e.gamma})}})}(),tm.graphics=tm.graphics||{},function(){tm.graphics.Color=tm.createClass({r:255,g:255,b:255,a:1,init:function(){this.set.apply(this,arguments)},set:function(t,e,i,n){return this.r=t,this.g=e,this.b=i,this.a=void 0!==n?n:1,this},setFromNumber:function(t,e,i,n){return this.r=t,this.g=e,this.b=i,this.a=void 0!==n?n:1,this},setFromArray:function(t){return this.set.apply(this,t)},setFromObject:function(t){return this.set(t.r,t.g,t.b,t.a)},setFromString:function(t){var e=tm.graphics.Color.stringToNumber(t);return this.set(e[0],e[1],e[2],e[3])},setSmart:function(){var t=arguments[0];return arguments.length>=3?this.set(arguments.r,arguments.g,arguments.b,arguments.a):t instanceof Array?this.setFromArray(t):t instanceof Object?this.setFromObject(t):"string"==typeof t&&this.setFromString(t),this},toStyleAsHex:function(){return"#{0}{1}{2}".format(this.r.toString(16).padding(2,"0"),this.g.toString(16).padding(2,"0"),this.b.toString(16).padding(2,"0"))},toStyleAsRGB:function(){return"rgb({r},{g},{b})".format({r:~~this.r,g:~~this.g,b:~~this.b})},toStyleAsRGBA:function(){return"rgba({r},{g},{b},{a})".format({r:~~this.r,g:~~this.g,b:~~this.b,a:this.a})},toStyle:function(){return"rgba({r},{g},{b},{a})".format({r:~~this.r,g:~~this.g,b:~~this.b,a:this.a})}});var t={hex111:{reg:/^#(\w{1})(\w{1})(\w{1})$/,exec:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},hex222:{reg:/^#(\w{2})(\w{2})(\w{2})$/,exec:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},rgb:{reg:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,exec:function(t){return[parseInt(t[1]),parseInt(t[2]),parseInt(t[3])]}},rgba:{reg:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*(\d{1}(\.{1}\d+)?)\)$/,exec:function(t){return[parseInt(t[1]),parseInt(t[2]),parseInt(t[3]),parseFloat(t[4])]}},hsl:{reg:/^hsl\((\d{1,3}),\s*(\d{1,3})%,\s*(\d{1,3})%\)$/,exec:function(t){return tm.graphics.Color.HSLtoRGB(t[1],t[2],t[3])}},hsla:{reg:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*(\d{1}(\.{1}\d+)?)\)$/,exec:function(t){return Color.HSLAtoRGBA(t[1],t[2],t[3],t[4])}}};tm.graphics.Color.COLOR_LIST={black:[0,0,0],silver:[192,192,192],gray:[128,128,128],white:[255,255,255],maroon:[128,0,0],red:[255,0,0],purple:[128,0,128],fuchsia:[255,0,255],green:[0,128,0],lime:[0,255,0],olive:[128,128,0],yellow:[255,255,0],navy:[0,0,128],blue:[0,0,255],teal:[0,128,128],aqua:[0,255,255]},tm.graphics.Color.strToNum=tm.graphics.Color.stringToNumber=function(e){var i=null;if("#"===e[0]?i=4==e.length?"hex111":"hex222":"r"===e[0]&&"g"===e[1]&&"b"===e[2]?i="a"==e[3]?"rgba":"rgb":"h"===e[0]&&"s"===e[1]&&"l"===e[2]&&(i="a"==e[3]?"hsla":"hsl"),i){var n=t[i],s=e.match(n.reg);value=n.exec(s)}else Color.COLOR_LIST[e]&&(value=Color.COLOR_LIST[e]);return value},tm.graphics.Color.HSLtoRGB=function(t,e,i){var n,s,o;if(t%=360,t+=360,t%=360,e*=.01,i*=.01,0==e){var i=Math.round(255*i);return[i,i,i]}var a=.5>i?i*(1+e):i+e-i*e,r=2*i-a,h=(t+120)%360;return n=60>h?r+(a-r)*h/60:180>h?a:r,h=t,s=60>h?r+(a-r)*h/60:180>h?a:240>h?r+(a-r)*(240-h)/60:r,h=(t-120+360)%360,o=60>h?r+(a-r)*h/60:180>h?a:240>h?r+(a-r)*(240-h)/60:r,[parseInt(255*n),parseInt(255*s),parseInt(255*o)]},tm.graphics.Color.HSLAtoRGBA=function(t,e,i,n){var s=Color.HSLtoRGB(t,e,i);return s[3]=n,rgb},tm.graphics.Color.createStyleRGB=function(t,e,i){return"rgba("+t+","+e+","+i+")"},tm.graphics.Color.createStyleRGBA=function(t,e,i,n){return"rgba("+t+","+e+","+i+","+n+")"},tm.graphics.Color.createStyleHSL=function(t,e,i){return"hsl("+t+","+e+"%,"+i+"%)"},tm.graphics.Color.createStyleHSLA=function(t,e,i,n){return"hsla("+t+","+e+"%,"+i+"%,"+n+")"}}(),tm.graphics=tm.graphics||{},function(){tm.graphics.Canvas=tm.createClass({element:null,canvas:null,context:null,init:function(t){this.canvas=null,this.canvas="string"==typeof t?document.querySelector(t):t||document.createElement("canvas"),this.element=this.canvas,this.context=this.canvas.getContext("2d"),this.context.lineCap="round",this.context.lineJoin="round"},resize:function(t,e){return this.canvas.width=t,this.canvas.height=e,this},resizeWindow:function(){return this.canvas.style.position="fixed",this.canvas.style.margin="0px",this.canvas.style.padding="0px",this.canvas.style.left="0px",this.canvas.style.top="0px",this.resize(window.innerWidth,window.innerHeight)},resizeToFitScreen:function(){return this.canvas.style.position="fixed",this.canvas.style.margin="0px",this.canvas.style.padding="0px",this.canvas.style.left="0px",this.canvas.style.top="0px",this.resize(window.innerWidth,window.innerHeight)},fitWindow:function(t){var e=function(){t=void 0===t?!0:t;var e=this.element,i=e.style;i.position="absolute",i.margin="auto",i.left="0px",i.top="0px",i.bottom="0px",i.right="0px";var n=e.width/window.innerWidth,s=e.height/window.innerHeight,o=e.height/e.width;n>s?(i.width=innerWidth+"px",i.height=innerWidth*o+"px"):(i.width=innerHeight/o+"px",i.height=innerHeight+"px")}.bind(this);e(),t&&window.addEventListener("resize",e,!1)},clear:function(t,e,i,n){return t=t||0,e=e||0,i=i||this.width,n=n||this.height,this.context.clearRect(t,e,i,n),this},clearColor:function(t,e,i,n,s){return e=e||0,i=i||0,n=n||this.width,s=s||this.height,this.save(),this.resetTransform(),this.fillStyle=t,this.context.fillRect(e,i,n,s),this.restore(),this},beginPath:function(){return this.context.beginPath(),this},closePath:function(){return this.context.closePath(),this},moveTo:function(t,e){return this.context.moveTo(t,e),this},lineTo:function(t,e){return this.context.lineTo(t,e),this},fill:function(){return this.context.fill(),this},stroke:function(){return this.context.stroke(),this},clip:function(){return this.context.clip(),this},drawPoint:function(t,e){return this.strokeRect(t,e,1,1)},line:function(t,e,i,n){return this.moveTo(t,e).lineTo(i,n)},drawLine:function(t,e,i,n){return this.beginPath().line(t,e,i,n).stroke()},drawDashLine:function(t,e,i,n,s){var o=null;"string"==typeof s?o=s:(s=s||61680,o=s.toString(2)),o=o.padding(16,"1");var a=i-t,r=n-e,h=Math.sqrt(a*a+r*r);a/=h,r/=h;for(var l=t,c=e,u=0;h>u;++u)"1"==o[u%16]&&this.drawPoint(l,c),l+=a,c+=r;return this},drawArrow:function(t,e,i,n,s){var o=i-t,a=n-e,r=180*Math.atan2(a,o)/Math.PI;return this.drawLine(t,e,i,n),this.fillPolygon(i,n,s||5,3,r),this},lines:function(){this.moveTo(arguments[0],arguments[1]);for(var t=1,e=arguments.length/2;e>t;++t)this.lineTo(arguments[2*t],arguments[2*t+1]);return this},strokeLines:function(){return this.beginPath(),this.lines.apply(this,arguments),this.stroke(),this},fillLines:function(){return this.beginPath(),this.lines.apply(this,arguments),this.fill(),this},rect:function(){return this.context.rect.apply(this.context,arguments),this},fillRect:function(){return this.context.fillRect.apply(this.context,arguments),this},strokeRect:function(){return this.context.strokeRect.apply(this.context,arguments),this},roundRect:function(t,e,i,n,s){var o=t+s,a=t+i-s,r=e+s,h=e+n-s;return this.context.arc(o,r,s,-Math.PI,.5*-Math.PI,!1),this.context.arc(a,r,s,.5*-Math.PI,0,!1),this.context.arc(a,h,s,0,.5*Math.PI,!1),this.context.arc(o,h,s,.5*Math.PI,Math.PI,!1),this.closePath(),this},fillRoundRect:function(t,e,i,n,s){return this.beginPath().roundRect(t,e,i,n,s).fill()},strokeRoundRect:function(t,e,i,n,s){return this.beginPath().roundRect(t,e,i,n,s).stroke()},polygon:function(t,e,i,n,s){var o=2*Math.PI/n,a=void 0!=s?s*Math.PI/180:-Math.PI/2;this.moveTo(t+Math.cos(a)*i,e+Math.sin(a)*i);for(var r=1;n>r;++r){var h=o*r+a;this.lineTo(t+Math.cos(h)*i,e+Math.sin(h)*i)}return this.closePath(),this},fillPolygon:function(t,e,i,n,s){return this.beginPath().polygon(t,e,i,n,s).fill()},strokePolygon:function(t,e,i,n,s){return this.beginPath().polygon(t,e,i,n,s).stroke()},star:function(t,e,i,n,s,o){var a=i*(s||.38),r=o?o*Math.PI/180:-Math.PI/2,h=2*Math.PI/n/2;this.moveTo(t+Math.cos(r)*i,e+Math.sin(r)*i);for(var l=1;2*n>l;++l){var c=h*l+r,u=l%2?a:i;this.lineTo(t+Math.cos(c)*u,e+Math.sin(c)*u)}return this.closePath(),this},fillStar:function(t,e,i,n,s,o){return this.beginPath().star(t,e,i,n,s,o).fill()},strokeStar:function(t,e,i,n,s,o){return this.beginPath().star(t,e,i,n,s,o).stroke()},heart:function(t,e,i,n){var s=.5*i,o=void 0===n?Math.PI/4:Math.degToRad(n),a=Math.cos(o)*s,r=Math.sin(o)*s,h=-s,l=(s*s-a*h)/r,c=l+s,u=s-c/2;return this.moveTo(0+t,l+e+u),this.arc(-s+t,0+e+u,s,Math.PI-o,2*Math.PI),this.arc(s+t,0+e+u,s,Math.PI,o),this.closePath(),this},fillHeart:function(t,e,i,n){return this.beginPath().heart(t,e,i,n).fill()},strokeHeart:function(t,e,i,n){return this.beginPath().heart(t,e,i,n).stroke()},circle:function(t,e,i){return this.context.arc(t,e,i,0,2*Math.PI,!1),this},fillCircle:function(t,e,i){var n=this.context;return n.beginPath(),n.arc(t,e,i,0,2*Math.PI,!1),n.closePath(),n.fill(),this},strokeCircle:function(t,e,i){return this.beginPath().circle(t,e,i).stroke()},arc:function(t,e,i,n,s,o){return this.context.arc(t,e,i,n,s,o),this},fillArc:function(t,e,i,n,s,o){return this.beginPath().arc(t,e,i,n,s,o).fill()},strokeArc:function(t,e,i,n,s,o){return this.beginPath().arc(t,e,i,n,s,o).stroke()},triangle:function(t,e,i,n,s,o){return this.moveTo(t,e).lineTo(i,n).lineTo(s,o),this.closePath(),this},fillTriangle:function(t,e,i,n,s,o){return this.beginPath().triangle(t,e,i,n,s,o).fill()},strokeTriangle:function(t,e,i,n,s,o){return this.beginPath().triangle(t,e,i,n,s,o).stroke()},fillText:function(){return this.context.fillText.apply(this.context,arguments)},strokeText:function(){return this.context.strokeText.apply(this.context,arguments)},fillVerticalText:function(t,e,i){this._drawVerticalText("fillText",t,e,i)},strokeVerticalText:function(t,e,i){this._drawVerticalText("strokeText",t,e,i)},_drawVerticalText:function(t,e,i,n){var s=this.context,o=(e.split("\n"),this.context.measureText("あ").width);s.save(),s.textAlign="right",s.textBaseline="top",Array.prototype.forEach.call(e,function(e,a){s[t](e,i,n+o*a)}),s.restore()},_drawLabelArea:function(t,e){var i=this.context,n=e.text,s=this.context.measureText("あ").width,o=n.split("\n"),a=(e.lineSpace||1)*s;if(i.save(),e.mode&&"horizon"!=e.mode){var r=Math.max(e.height/s|0,1),h=e.x+e.width,l=[];o.each(function(t){for(var e=0,i=t.length;i>e;e+=r){var n=t.substr(e,r);l.push(n)}});var c=t+"VerticalText";l.each(function(t,i){this[c](t,h-i*a,e.y+15)}.bind(this))}else{var r=Math.max(e.width/s|0,1),l=[];i.textAlign="left",i.textBaseline="top",o.each(function(t){for(var e=0,i=t.length;i>e;e+=r){var n=t.substr(e,r);l.push(n)}});var c=t+"Text";l.each(function(t,n){i[c](t,e.x,e.y+n*a+4)})}i.restore()},fillLabelArea:function(t){this._drawLabelArea("fill",t)},strokeLabelArea:function(t){this._drawLabelArea("stroke",t)},drawImage:function(t,e,i){this.context.drawImage.apply(this.context,arguments)},drawTexture:function(t){return arguments[0]=t.element,this.context.drawImage.apply(this.context,arguments),this},drawBitmap:function(t){return arguments[0]=t.imageData,this.context.putImageData.apply(this.context,arguments),this},drawScale9Image:function(t,e,i){var n=i.x,s=i.width,o=t.width-(n+s),a=e.width-(n+o),r=i.y;return this.drawImage(t,0,0,n,r,e.x,e.y,n,r),this.drawImage(t,n,0,s,r,e.x+n,e.y,a,r),this.drawImage(t,n+s,0,o,r,e.x+n+a,e.y,o,r),this},setTransform:function(t,e,i,n,s,o){return this.context.setTransform(t,e,i,n,s,o),this},resetTransform:function(){return this.setTransform(1,0,0,1,0,0),this},setTransformCenter:function(){return this.context.setTransform(1,0,0,1,this.width/2,this.height/2),this},transform:function(t,e,i,n,s,o){return this.context.transform(t,e,i,n,s,o),this},save:function(){return this.context.save(),this},restore:function(){return this.context.restore(),this},translate:function(t,e){return this.context.translate(t,e),this},rotate:function(t){return this.context.rotate(t),this},scale:function(t,e){return this.context.scale(t,e),this},saveAsImage:function(t){t=t||tm.graphics.Canvas.MIME_TYPE_PNG;var e=this.canvas.toDataURL(t);window.open(e,"save")},setCompositing:function(){},setFillStyle:function(t){return this.context.fillStyle=t,this},setStrokeStyle:function(t){return this.context.strokeStyle=t,this},setColorStyle:function(t,e){return e=e||t,this.context.strokeStyle=t,this.context.fillStyle=e,this},setText:function(t,e,i){var n=this.context;n.font=t,n.textAlign=e,n.textBaseline=i},setLineStyle:function(width,cap,join,miter){with(this.context)lineWidth=width||1,lineCap=cap||"round",lineJoin=join||"round",miterLimit=miter||10;return this},setShadow:function(t,e,i,n){var s=this.context;return s.shadowColor=t||"black",s.shadowOffsetX=e||0,s.shadowOffsetY=i||0,s.shadowBlur=n||0,this},getElement:function(){return this.element}}),tm.graphics.Canvas.MIME_TYPE_PNG="image/png",tm.graphics.Canvas.MIME_TYPE_JPG="image/jpeg",tm.graphics.Canvas.MIME_TYPE_SVG="image/svg+xml",tm.graphics.Canvas.prototype.accessor("width",{get:function(){return this.canvas.width},set:function(t){this.canvas.width=t}}),tm.graphics.Canvas.prototype.accessor("height",{get:function(){return this.canvas.height},set:function(t){this.canvas.height=t}}),tm.graphics.Canvas.prototype.accessor("fillStyle",{get:function(){return this.context.fillStyle},set:function(t){this.context.fillStyle=t}}),tm.graphics.Canvas.prototype.accessor("strokeStyle",{get:function(){return this.context.strokeStyle},set:function(t){this.context.strokeStyle=t}}),tm.graphics.Canvas.prototype.accessor("globalAlpha",{get:function(){return this.context.globalAlpha},set:function(t){this.context.globalAlpha=t}}),tm.graphics.Canvas.prototype.accessor("globalCompositeOperation",{get:function(){return this.context.globalCompositeOperation},set:function(t){this.context.globalCompositeOperation=t}}),tm.graphics.Canvas.prototype.accessor("shadowBlur",{get:function(){return this.context.shadowBlur},set:function(t){this.context.shadowBlur=t}}),tm.graphics.Canvas.prototype.accessor("shadowColor",{get:function(){return this.context.shadowColor},set:function(t){this.context.shadowColor=t}}),tm.graphics.Canvas.prototype.accessor("shadowOffsetX",{get:function(){return this.context.shadowOffsetX},set:function(t){this.context.shadowOffsetX=t}}),tm.graphics.Canvas.prototype.accessor("shadowOffsetY",{get:function(){return this.context.shadowOffsetY},set:function(t){this.context.shadowOffsetY=t}}),tm.graphics.Canvas.prototype.accessor("lineCap",{get:function(){return this.context.lineCap},set:function(t){this.context.lineCap=t}}),tm.graphics.Canvas.prototype.accessor("lineJoin",{get:function(){return this.context.lineJoin},set:function(t){this.context.lineJoin=t}}),tm.graphics.Canvas.prototype.accessor("miterLimit",{get:function(){return this.context.miterLimit},set:function(t){this.context.miterLimit=t}}),tm.graphics.Canvas.prototype.accessor("lineWidth",{get:function(){return this.context.lineWidth},set:function(t){this.context.lineWidth=t}}),tm.graphics.Canvas.prototype.accessor("font",{get:function(){return this.context.font},set:function(t){this.context.font=t}}),tm.graphics.Canvas.prototype.accessor("textAlign",{get:function(){return this.context.textAlign},set:function(t){this.context.textAlign=t}}),tm.graphics.Canvas.prototype.accessor("textBaseline",{get:function(){return this.context.textBaseline},set:function(t){this.context.textBaseline=t}}),tm.graphics.Canvas.prototype.getter("centerX",function(){return this.canvas.width/2}),tm.graphics.Canvas.prototype.getter("centerY",function(){return this.canvas.height/2}),tm.graphics.Canvas.prototype.accessor("imageSmoothingEnabled",{get:function(){return this.context.imageSmoothingEnabled},set:function(t){this.context.imageSmoothingEnabled=t,this.context.webkitImageSmoothingEnabled=t,this.context.mozImageSmoothingEnabled=t}})}(),tm.graphics=tm.graphics||{},function(){tm.graphics.Bitmap=tm.createClass({imageData:null,init:function(){t||(t=document.createElement("canvas"),e=t.getContext("2d")),this._init.apply(this,arguments),this.init=this._init},_init:function(t){if(1==arguments.length)this.imageData=t,this.data=t.data;else if(2==arguments.length){var i=arguments[0],n=arguments[1];this.imageData=e.createImageData(i,n),this.data=this.imageData.data}},getPixelIndex:function(t){var e=4*t;return[this.data[e+0],this.data[e+1],this.data[e+2],this.data[e+3]]},getPixelXY:function(t,e){return this.getPixelIndex(this.posToIndex(t,e))},getPixel:function(t,e){return this.getPixelIndex(this.posToIndex(t,e))},getPixelAsNumber:function(t){var e=4*t;return this.data[e+3]<<24|this.data[e+0]<<16|this.data[e+1]<<8|this.data[e+2]},getPixelAsObject:function(t){var e=4*t;return{r:this.data[e+0],g:this.data[e+1],b:this.data[e+2],a:this.data[e+3]}},getPixelAsArray:function(t){var e=4*t;return[this.data[e+0],this.data[e+1],this.data[e+2],this.data[e+3]]},getPixelAverage:function(t,e,i,n){var s=[0,0,0,0],o=t,a=t+i,r=e,h=e+n;0>o&&(o=0),a>this.width&&(a=this.width),0>r&&(r=0),h>this.height&&(h=this.height);for(var l=[],c=this.width,u=r;h>u;++u)for(var m=o;a>m;++m){var p=c*u+m;l.push(this.getPixelIndex(p))}for(var d=d=l.length,u=0;d>u;++u)s[0]+=l[u][0],s[1]+=l[u][1],s[2]+=l[u][2],s[3]+=l[u][3];return s[0]/=d,s[1]/=d,s[2]/=d,s[3]/=d,s
},setPixelIndex:function(t,e,i,n){var s=4*t;return this.data[s+0]=e,this.data[s+1]=i,this.data[s+2]=n,this},setPixelXY:function(t,e,i,n,s){return this.setPixelIndex(e*this.imageData.width+t,i,n,s)},setPixel:function(t,e,i,n){return this.setPixelIndex(y*this.imageData.width+x,e,i,n)},setPixel32Index:function(t,e,i,n,s){var o=4*t;return this.data[o+0]=e,this.data[o+1]=i,this.data[o+2]=n,this.data[o+3]=s,this},setPixel32:function(t,e,i,n,s,o){return this.setPixel32Index(e*this.width+t,i,n,s,o)},setPixel32XY:function(t,e,i,n,s,o){return this.setPixel32Index(e*this.width+t,i,n,s,o)},setPixelFromArray:function(t,e){return this.setPixel(t,e[0],e[1],e[2])},setPixel32FromArray:function(t,e){return this.setPixel32(t,e[0],e[1],e[2],e[3])},setPixelFromNumber:function(t,e){return this.setPixel(t,(16711680&e)>>>16,(65280&e)>>>8,(255&e)>>>0)},setPixel32FromNumber:function(t,e){return this.setPixel32(t,(16711680&e)>>>16,(65280&e)>>>8,(255&e)>>>0,(4278190080&e)>>>24)},setPixelFromObject:function(t,e){return this.setPixel(e.r,e.g,e.b)},setPixel32FromObject:function(t,e){return this.setPixel32(e.r,e.g,e.b,e.a)},setPixelFromString:function(){},posToIndex:function(t,e){return e*this.imageData.width+t},filter:function(t){for(var e=0;e<this.height;++e)for(var i=0;i<this.width;++i){var n=this.posToIndex(i,e),s=this.getPixel(i,e);t.calc(s,n,i,e,this)}return this},noise:function(t,e){t=t||0,e=e||255,range=e-t;for(var i=0,n=this.length;n>i;++i){var s=this.getPixelIndex(i);s[0]=Math.random()*range+t,s[1]=Math.random()*range+t,s[2]=Math.random()*range+t,s[3]=255,this.setPixel32Index(i,s[0],s[1],s[2],s[3])}},applyFilter:function(){}}),tm.graphics.Bitmap.prototype.accessor("width",{get:function(){return this.imageData.width},set:function(t){this.imageData.width=t}}),tm.graphics.Bitmap.prototype.accessor("height",{get:function(){return this.imageData.height},set:function(t){this.imageData.height=t}}),tm.graphics.Bitmap.prototype.getter("length",function(){return this.imageData.width*this.imageData.height}),tm.graphics.Canvas.prototype.getBitmap=function(t,e,i,n){return tm.graphics.Bitmap(this.context.getImageData(t||0,e||0,i||this.width,n||this.height))},tm.graphics.Canvas.prototype.createBitmap=function(t,e){return tm.graphics.Bitmap(this.context.createImageData(t||this.width,e||this.height))},tm.asset.Texture.prototype.getBitmap=function(t,e,i,n){var s=tm.graphics.Canvas();return s.resize(this.width,this.height),s.drawTexture(this,0,0,this.width,this.height),s.getBitmap(t,e,i,n)};var t=null,e=null}(),tm.graphics=tm.graphics||{},function(){tm.graphics.MonochromeFilter=tm.createClass({init:function(){},apply:function(t,e){for(var i=t.length,n=0;i>n;++n){var s=t.getPixelIndex(n),o=.3*s[0]+.59*s[1]+.11*s[2];e.setPixel32Index(n,o,o,o,s[3])}return e}})}(),function(){tm.graphics.ReverseFilter=tm.createClass({init:function(){},apply:function(t,e){for(var i=0,n=t.width*t.height;n>i;++i){var s=t.getPixelIndex(i);s[0]=255-s[0],s[1]=255-s[1],s[2]=255-s[2],e.setPixel32Index(i,s[0],s[1],s[2],255)}return e}})}(),function(){tm.graphics.BlurFilter=tm.createClass({init:function(t,e,i){this.blurX=t||4,this.blurY=e||4,this.quality=i||1},apply:function(t,e){for(var i=Math.floor(this.blurX/2),n=Math.floor(this.blurY/2),s=this.blurX,o=this.blurY,a=t.width,r=t.height,h=t.length,l=function(t,e){for(var r=0;h>r;++r){var l=r%a,c=Math.floor(r/a),u=t.getPixelAverage(l-i,c-n,s,o);e.setPixel32Index(r,u[0],u[1],u[2],255)}},c=t,u=0;u<this.quality;++u)t=c,c=tm.graphics.Bitmap(a,r),l(t,c);return e.imageData=c.imageData,e}})}(),function(){for(var t=[],e=0;255>e;++e){var i=0;i=100>e?60:150>e?150:180>e?180:220,t[e]=i}tm.graphics.ToonFilter=tm.createClass({toonTable:null,init:function(e){this.toonTable=e||t},apply:function(t,e){for(var i=0,n=t.width*t.height;n>i;++i){var s=t.getPixelIndex(i),o=this.toonTable[s[0]],a=this.toonTable[s[1]],r=this.toonTable[s[2]];e.setPixel32Index(i,o,a,r,255)}return e}})}(),function(){tm.graphics.ColorMatrixFilter=tm.createClass({init:function(t){this.colorMatrix=t},apply:function(t,e){for(var i=this.colorMatrix,n=0,s=t.length;s>n;++n){var o=t.getPixelIndex(n),a=o[0]*i[0]+o[1]*i[1]+o[2]*i[2]+o[3]*i[3]+i[4],r=o[0]*i[5]+o[1]*i[6]+o[2]*i[7]+o[3]*i[8]+i[9],h=o[0]*i[10]+o[1]*i[11]+o[2]*i[12]+o[3]*i[13]+i[14],l=o[0]*i[15]+o[1]*i[16]+o[2]*i[17]+o[3]*i[18]+i[19];e.setPixel32Index(n,a,r,h,l)}return e}})}(),tm.graphics=tm.graphics||{},function(){tm.graphics.Canvas.prototype.setGradient=function(t){this.context.fillStyle=t.gradient}}(),function(){tm.graphics.LinearGradient=tm.createClass({init:function(i,n,s,o){t||(t=document.createElement("canvas"),e=t.getContext("2d")),this._init(i,n,s,o),this.init=this._init},_init:function(t,i,n,s){this.gradient=e.createLinearGradient(t,i,n,s)},addColorStop:function(t,e){return this.gradient.addColorStop(t,e),this},addColorStopList:function(t){for(var e=0,i=t.length;i>e;++e){var n=t[e].offset,s=t[e].color;this.addColorStop(n,s)}return this},toStyle:function(){return this.gradient}}),tm.graphics.RadialGradient=tm.createClass({init:function(i,n,s,o,a,r){t||(t=document.createElement("canvas"),e=t.getContext("2d")),this._init(i,n,s,o,a,r),this.init=this._init},_init:function(t,i,n,s,o,a){this.gradient=e.createRadialGradient(t,i,n,s,o,a)},addColorStop:function(t,e){return this.gradient.addColorStop(t,e),this},addColorStopList:function(t){for(var e=0,i=t.length;i>e;++e){var n=t[e].offset,s=t[e].color;this.addColorStop(n,s)}return this},toStyle:function(){return this.gradient}});var t=null,e=null}(),tm.anim=tm.anim||{},function(){tm.anim.Tween=tm.createClass({superClass:tm.event.EventDispatcher,target:null,time:null,prop:null,nowProps:null,now:null,begin:null,finish:null,duration:null,isLooping:null,isPlaying:null,func:Math.linear,fps:30,init:function(){this.superInit(),this.time=0,this.nowProps={},this.isPlaying=!1,arguments.length>0&&this.to.apply(this,arguments)},to:function(t,e,i,n){var s={};for(var o in e)s[o]=t[o];return this.fromTo(t,s,e,i,n),this},by:function(t,e,i,n){var s={},o={};for(var a in e)s[a]=t[a],o[a]=t[a]+e[a];return this.fromTo(t,s,o,i,n),this},fromTo:function(t,e,i,n,s){this.target=t,this.beginProps=e,this.finishProps=i,this.duration=n,this.changeProps={};for(var o in e)this.changeProps[o]=i[o]-e[o];return this.setTransition(s),this},from:function(t,e,i,n){var s={};for(var o in e)s[o]=t[o];return this.fromTo(t,e,s,i,n),this},setTransition:function(t){return this.func="function"==typeof t?t:"string"==typeof t?tm.anim.easing[t]:tm.anim.easing["default"],this},resume:function(){this.isPlaying=!0,this._resumeTime(),this._updateTime(),this.dispatchEvent(tm.event.TweenEvent("resume",this.time,this.nowProps))},start:function(){this.isPlaying=!0,this._startTime(),this._updateTime(),this.dispatchEvent(tm.event.TweenEvent("start",this.time,this.nowProps))},stop:function(){this.isPlaying=!1,this.dispatchEvent(tm.event.TweenEvent("stop",this.time,this.nowProps))},rewind:function(){this.time=0,this.update()},fforward:function(){this.time=this.duration,this.update()},yoyo:function(){var t=this.finishProps;this.finishProps=this.beginProps,this.beginProps=t;for(var e in this.beginProps)this.changeProps[e]=this.finishProps[e]-this.beginProps[e];this.start()},update:function(){for(var t in this.changeProps)this.nowProps[t]=this.func(this.time,this.beginProps[t],this.changeProps[t],this.duration),this.target[t]=this.nowProps[t];this.dispatchEvent(tm.event.TweenEvent("change",this.time,this.nowProps))},_resumeTime:function(){this.startTime=(new Date).getTime()-this.time},_startTime:function(){this.startTime=(new Date).getTime()},_updateTime:function(){this.isPlaying&&(this._setTime((new Date).getTime()-this.startTime),setTimeout(arguments.callee.bind(this),1e3/this.fps))},_setTime:function(t){var e=t;e>this.duration?this.isLooping?(this.rewind(),this.update(),this.dispatchEvent(tm.event.TweenEvent("loop",this.time,this.nowProps))):(this.time=this.duration,this.update(),this.stop(),this.dispatchEvent(tm.event.TweenEvent("finish",this.time,this.nowProps))):(this.time=e,this.update())}})}(),function(){tm.anim.easing={"default":function(t,e,i,n){return i*t/n+e},linear:function(t,e,i,n){return i*t/n+e},swing:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},easeInQuad:function(t,e,i,n){return i*(t/=n)*t+e},easeOutQuad:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},easeInOutQuad:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},easeInCubic:function(t,e,i,n){return i*(t/=n)*t*t+e},easeOutCubic:function(t,e,i,n){return i*((t=t/n-1)*t*t+1)+e},easeInOutCubic:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},easeOutInCubic:function(t,e,i,n){return n/2>t?tm.anim.easing.easeOutCubic(2*t,e,i/2,n):tm.anim.easing.easeInCubic(2*t-n,e+i/2,i/2,n)},easeInQuart:function(t,e,i,n){return i*(t/=n)*t*t*t+e},easeOutQuart:function(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e},easeInOutQuart:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},easeOutInQuart:function(t,e,i,n){return n/2>t?tm.anim.easing.easeOutQuart(2*t,e,i/2,n):tm.anim.easing.easeInQuart(2*t-n,e+i/2,i/2,n)},easeInQuint:function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},easeOutQuint:function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},easeInOutQuint:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},easeOutInQuint:function(t,e,i,n){return n/2>t?tm.anim.easing.easeOutQuint(2*t,e,i/2,n):tm.anim.easing.easeInQuint(2*t-n,e+i/2,i/2,n)},easeInSine:function(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e},easeOutSine:function(t,e,i,n){return i*Math.sin(t/n*(Math.PI/2))+e},easeInOutSine:function(t,e,i,n){return-i/2*(Math.cos(Math.PI*t/n)-1)+e},easeOutInSine:function(t,e,i,n){return n/2>t?tm.anim.easing.easeOutSine(2*t,e,i/2,n):tm.anim.easing.easeInSine(2*t-n,e+i/2,i/2,n)},easeInExpo:function(t,e,i,n){return 0==t?e:i*Math.pow(2,10*(t/n-1))+e-.001*i},easeOutExpo:function(t,e,i,n){return t==n?e+i:1.001*i*(-Math.pow(2,-10*t/n)+1)+e},easeInOutExpo:function(t,e,i,n){return 0==t?e:t==n?e+i:(t/=n/2)<1?i/2*Math.pow(2,10*(t-1))+e-5e-4*i:i/2*1.0005*(-Math.pow(2,-10*--t)+2)+e},easeOutInExpo:function(t,e,i,n){return n/2>t?tm.anim.easing.easeOutExpo(2*t,e,i/2,n):tm.anim.easing.easeInExpo(2*t-n,e+i/2,i/2,n)},easeInCirc:function(t,e,i,n){return-i*(Math.sqrt(1-(t/=n)*t)-1)+e},easeOutCirc:function(t,e,i,n){return i*Math.sqrt(1-(t=t/n-1)*t)+e},easeInOutCirc:function(t,e,i,n){return(t/=n/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e},easeOutInCirc:function(t,e,i,n){return n/2>t?tm.anim.easing.easeOutCirc(2*t,e,i/2,n):tm.anim.easing.easeInCirc(2*t-n,e+i/2,i/2,n)},easeInElastic:function(t,e,i,n,s,o){var a;return 0==t?e:1==(t/=n)?e+i:(o||(o=.3*n),!s||s<Math.abs(i)?(s=i,a=o/4):a=o/(2*Math.PI)*Math.asin(i/s),-(s*Math.pow(2,10*(t-=1))*Math.sin(2*(t*n-a)*Math.PI/o))+e)},easeOutElastic:function(t,e,i,n,s,o){var a;return 0==t?e:1==(t/=n)?e+i:(o||(o=.3*n),!s||s<Math.abs(i)?(s=i,a=o/4):a=o/(2*Math.PI)*Math.asin(i/s),s*Math.pow(2,-10*t)*Math.sin(2*(t*n-a)*Math.PI/o)+i+e)},easeInOutElastic:function(t,e,i,n,s,o){var a;return 0==t?e:2==(t/=n/2)?e+i:(o||(o=.3*n*1.5),!s||s<Math.abs(i)?(s=i,a=o/4):a=o/(2*Math.PI)*Math.asin(i/s),1>t?-.5*s*Math.pow(2,10*(t-=1))*Math.sin(2*(t*n-a)*Math.PI/o)+e:s*Math.pow(2,-10*(t-=1))*Math.sin(2*(t*n-a)*Math.PI/o)*.5+i+e)},easeOutInElastic:function(t,e,i,n,s,o){return n/2>t?tm.anim.easing.easeOutElastic(2*t,e,i/2,n,s,o):tm.anim.easing.easeInElastic(2*t-n,e+i/2,i/2,n,s,o)},easeInBack:function(t,e,i,n,s){return void 0==s&&(s=1.70158),i*(t/=n)*t*((s+1)*t-s)+e},easeOutBack:function(t,e,i,n,s){return void 0==s&&(s=1.70158),i*((t=t/n-1)*t*((s+1)*t+s)+1)+e},easeInOutBack:function(t,e,i,n,s){return void 0==s&&(s=1.70158),(t/=n/2)<1?i/2*t*t*(((s*=1.525)+1)*t-s)+e:i/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+e},easeOutInBack:function(t,e,i,n,s){return n/2>t?tm.anim.easing.easeOutBack(2*t,e,i/2,n,s):tm.anim.easing.easeInBack(2*t-n,e+i/2,i/2,n,s)},easeInBounce:function(t,e,i,n){return i-tm.anim.easing.easeOutBounce(n-t,0,i,n)+e},easeOutBounce:function(t,e,i,n){return(t/=n)<1/2.75?7.5625*i*t*t+e:2/2.75>t?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:2.5/2.75>t?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},easeInOutBounce:function(t,e,i,n){return n/2>t?.5*tm.anim.easing.easeInBounce(2*t,0,i,n)+e:.5*tm.anim.easing.easeOutBounce(2*t-n,0,i,n)+.5*i+e},easeOutInBounce:function(t,e,i,n){return n/2>t?tm.anim.easing.easeOutBounce(2*t,e,i/2,n):tm.anim.easing.easeInBounce(2*t-n,e+i/2,i/2,n)}}}(),function(){tm.define("tm.app.Timer",{frame:0,fps:30,frameTime:1e3/30,init:function(){this.frame=0,this.fps=tm.app.Timer["default"].fps},reset:function(){return this.frame=0,this},update:function(){return this.frame=this.frame+1,this},getFrame:function(){return this.frame},getSeconds:function(){return this._seconds},getMilliseconds:function(){return this._milliseconds},checkIntervalEnd:function(t){var e=t/this.fps|0;return this.frame%e==0?!0:!1},checkBetween:function(t,e){1==arguments.length&&(e=Math.max(t,0),t=e-this.frameTime);var i=this.frame/this.fps*1e3;return e>(i>=t)},_update:function(){var t=this.frame/this.fps;this._seconds=0|t,this._milliseconds=1e3*t|0}}),tm.app.Timer.prototype.accessor("frame",{get:function(){return this._frame},set:function(t){this._frame=t,this._update()}}),tm.app.Timer.prototype.accessor("fps",{get:function(){return this._fps},set:function(t){t!==this._fps&&(this.frameTime=1e3/t),this._fps=t,this._update()}}),tm.app.Timer["default"]={fps:30}}(),function(){tm.define("tm.app.Updater",{app:null,init:function(t){this.app=t},update:function(t){this._updateElement(t)},_updateElement:function(t){var e=this.app;if(0!=t.awake){if(t.update&&t.update(e),t.hasEventListener("enterframe")){var i=tm.event.Event("enterframe");i.app=e,t.fire(i)}t.interactive&&t._checkPointing(e);var n=t.children.length;if(n>0)for(var s=t.children.slice(),o=0;n>o;++o)this._updateElement(s[o])}}})}(),tm.app=tm.app||{},function(){tm.app.BaseApp=tm.createClass({superClass:tm.event.EventDispatcher,element:null,mouse:null,touch:null,pointing:null,keyboard:null,accelerometer:null,updater:null,stats:null,timer:null,awake:null,_scenes:null,_sceneIndex:0,init:function(t){this.superInit(),this.element=t,this.timer=tm.app.Timer(),this.mouse=tm.input.Mouse(this.element),this.touch=tm.input.Touch(this.element,0),this.keyboard=tm.input.Keyboard(),this.pointing=tm.isMobile?this.touch:this.mouse,this.element.addEventListener("touchstart",function(){this.pointing=this.touch}.bind(this)),this.element.addEventListener("mousedown",function(){this.pointing=this.mouse}.bind(this)),this.accelerometer=tm.input.Accelerometer(),this.updater=tm.app.Updater(this),this.awake=!0,this._scenes=[tm.app.Scene()],this._sceneIndex=0,this.element.addEventListener("touchstart",function(t){t.stop()}),this.element.addEventListener("touchmove",function(t){t.stop()}),window.addEventListener("focus",function(){this.fire(tm.event.Event("focus")),this.currentScene.dispatchEvent(tm.event.Event("focus"))}.bind(this)),window.addEventListener("blur",function(){this.fire(tm.event.Event("blur")),this.currentScene.dispatchEvent(tm.event.Event("blur"))}.bind(this)),this.element.addEventListener(tm.isMobile?"touchend":"mouseup",this._onclick.bind(this))},run:function(){var t=this;this.startedTime=new Date,this.prevTime=new Date,this.deltaTime=0;var e=function(){var i=(new Date).getTime();t._loop();var n=(new Date).getTime()-i,s=t.timer.frameTime-n;setTimeout(e,s)};return e(),this},_loop:function(){this.update&&this.update(),this._update(),this.draw&&this.draw(),this._draw();var t=new Date;this.deltaTime=t-this.prevTime,this.prevTime=t,this.stats&&this.stats.update()},replaceScene:function(t){var e=null;return this.currentScene&&(e=tm.event.Event("exit"),e.app=this,this.currentScene.dispatchEvent(e),this.currentScene.app=null),e=tm.event.Event("enter"),e.app=this,this.currentScene=t,this.currentScene.app=this,this.currentScene.dispatchEvent(e),this},pushScene:function(t){this.fire(tm.event.Event("push"));var e=tm.event.Event("pause");e.app=this,this.currentScene.dispatchEvent(e),this._scenes.push(t),++this._sceneIndex,this.fire(tm.event.Event("pushed"));var e=tm.event.Event("enter");return e.app=this,t.app=this,t.dispatchEvent(e),this},popScene:function(){this.fire(tm.event.Event("pop"));var t=this._scenes.pop();--this._sceneIndex;var e=tm.event.Event("exit");e.app=this,t.dispatchEvent(e),t.app=null,this.fire(tm.event.Event("poped"));var e=tm.event.Event("resume");return e.app=this,e.prevScene=t,this.currentScene.dispatchEvent(e),t},enableStats:function(){return window.Stats?(this.stats=new Stats,this.stats.domElement.style.position="fixed",this.stats.domElement.style.left="5px",this.stats.domElement.style.top="20px",document.body.appendChild(this.stats.domElement)):console.warn("not defined stats."),this},enableDatGUI:function(){if(window.dat){var t=new dat.GUI;return t}},start:function(){return this.awake=!0,this},stop:function(){return this.awake=!1,this},_update:function(){this.mouse.update(),this.keyboard._update(),this.touch.update(),this.awake&&(this.updater.update(this.currentScene),this.timer.update())},_draw:function(){},getElement:function(){return this.element},_onclick:function(){var t=function(e){e.children.length>0&&e.children.each(function(e){t(e)}),e._clickFlag&&e.hasEventListener("click")&&e.dispatchEvent(tm.event.Event("click")),e._clickFlag=!1};t(this.currentScene)}}),tm.app.BaseApp.prototype.accessor("currentScene",{get:function(){return this._scenes[this._sceneIndex]},set:function(t){this._scenes[this._sceneIndex]=t}}),tm.app.BaseApp.prototype.accessor("frame",{get:function(){return this.timer.frame},set:function(t){this.timer.frame=t}}),tm.app.BaseApp.prototype.accessor("fps",{get:function(){return this.timer.fps},set:function(t){this.timer.fps=t}})}(),tm.app=tm.app||{},function(){tm.app.Element=tm.createClass({superClass:tm.event.EventDispatcher,parent:null,children:null,init:function(){this.superInit(),this.children=[]},remove:function(){return console.assert(this.parent),this.parent.removeChild(this),this.parent=null,this},addChild:function(t){t.parent&&t.remove(),t.parent=this,this.children.push(t);var e=tm.event.Event("added");return t.dispatchEvent(e),t},addChildTo:function(t){return t.addChild(this),this},addChildren:function(t){for(var e=t.slice(),i=beginIndex,n=e.length;n>i;++i)this.addChild(e[i])},addChildAt:function(t,e){t.parent&&t.remove(),t.parent=this,this.children.splice(e,0,t);var i=tm.event.Event("added");return t.dispatchEvent(i),t},getChildAt:function(t){return this.children.indexOf(t)},removeChild:function(t){var e=this.children.indexOf(t);if(-1!=e){this.children.splice(e,1);var i=tm.event.Event("removed");t.dispatchEvent(i)}},removeChildren:function(t){t=t||0;for(var e=this.children.slice(),i=t,n=e.length;n>i;++i)e[i].remove();this.children=[]},getChildByName:function(t){for(var e=0,i=this.children.length;i>e;++e)if(this.children[e].name==t)return this.children[e];return null},execChildren:function(t,e){e=e&&e.length?e:[e];for(var i=this.children.slice(),n=0,s=i.length;s>n;++n)t.apply(i[n],e)},getParent:function(){return this.parent},getRoot:function(){if(!this.parent)return null;var t=null;for(t=this.parent;null!=t.parent;t=t.parent);return t},fromJSON:function(e){var i=function(e,i){var n=i.init,s=n instanceof Array?n:[n],o=t[i.type]?t[i.type]:i.type,a=tm.using(o);console.assert(0!==Object.keys(a).length,a+" is not defined.");var r=a.apply(null,s).addChildTo(this);r.fromJSON(i),this[e]=r}.bind(this);for(var n in e){var s=e[n];if("children"==n)if(s instanceof Array)for(var o=0,a=s.length;a>o;++o){var r=s[o];i(r.name,r)}else for(var n in s){var r=s[n];i(n,r)}else"type"==n&&(n="__key"),this[n]=s}return this},toJSON:function(){}});var t={Sprite:"tm.display.Sprite",Label:"tm.display.Label",Shape:"tm.display.Shape",CircleShape:"tm.display.CircleShape",TriangleShape:"tm.display.TriangleShape",RectangleShape:"tm.display.RectangleShape",RoundRectangleShape:"tm.display.RoundRectangleShape",TextShape:"tm.display.TextShape",StarShape:"tm.display.StarShape",PolygonShape:"tm.display.PolygonShape",HeartShape:"tm.display.HeartShape",AnimationSprite:"tm.display.AnimationSprite",LabelButton:"tm.ui.LabelButton",IconButton:"tm.ui.IconButton",GlossyButton:"tm.ui.GlossyButton",FlatButton:"tm.ui.FlatButton"}}(),function(){tm.define("tm.app.Object2D",{superClass:"tm.app.Element",position:null,scale:null,rotation:0,awake:!0,_width:64,_height:64,init:function(){this.superInit(),this.position=tm.geom.Vector2(0,0),this.scale=tm.geom.Vector2(1,1),this.pointing=tm.geom.Vector2(0,0),this.origin=tm.geom.Vector2(.5,.5),this._matrix=tm.geom.Matrix33(),this._matrix.identity(),this.boundingType="circle",this.checkHierarchy=!0,this.interactive=!1,this.hitFlags=[],this.downFlags=[],this._clickFlag=!1,this._worldMatrix=tm.geom.Matrix33().identity(),this._worldAlpha=1},getFinalMatrix:function(){var t=tm.geom.Matrix33();return this.parent&&t.multiply(this.parent.getFinalMatrix()),t.translate(this.centerX,this.centerY),t.rotateZ(this.rotation*Math.DEG_TO_RAD),t.scale(this.scaleX,this.scaleY),t},isHitPoint:function(t,e){var i=this.globalToLocal(tm.geom.Vector2(t,e));return this.pointing.x=i.x,this.pointing.y=i.y,i.x*i.x+i.y*i.y<this.radius*this.radius?!0:!1},isHitPointCircle:function(t,e){var i=this.x-t,n=this.y-e;return i*i+n*n<this.radius*this.radius?!0:!1},isHitPointRect:function(t,e){var i=this.x-this.width*this.originX,n=this.x+this.width*(1-this.originX),s=this.y-this.height*this.originY,o=this.y+this.height*(1-this.originY);return t>i&&n>t&&e>s&&o>e?!0:!1},isHitPointCircleHierarchy:function(t,e){var i=this.globalToLocal(tm.geom.Vector2(t,e));return this.pointing.x=i.x,this.pointing.y=i.y,i.x*i.x+i.y*i.y<this.radius*this.radius?!0:!1},isHitPointRectHierarchy:function(t,e){var i=this.globalToLocal(tm.geom.Vector2(t,e));this.pointing.x=i.x,this.pointing.y=i.y;var n=-this.width*this.originX,s=+this.width*(1-this.originX),o=-this.height*this.originY,a=+this.height*(1-this.originY);return n<i.x&&i.x<s&&o<i.y&&i.y<a?!0:!1},isHitElement:function(t){this.parent.localToGlobal(this);return(this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y)<(this.radius+t.radius)*(this.radius+t.radius)?!0:!1},isHitElementCircle:function(t){return tm.collision.testCircleCircle(this.getBoundingCircle(),t.getBoundingCircle())},isHitElementRect:function(t){return tm.collision.testRectRect(this.getBoundingRect(),t.getBoundingRect())},getBoundingCircle:function(){return tm.geom.Circle(this.centerX,this.centerY,this.radius)},getBoundingRect:function(){return tm.geom.Rect(this.left,this.top,this.width,this.height)},localToGlobal:function(t){return this.getFinalMatrix().multiplyVector2(t)},globalToLocal:function(t){var e=this._worldMatrix.clone();return e.invert(),e.transpose(),e.multiplyVector2(t)},setX:function(t){return this.position.x=t,this},setY:function(t){return this.position.y=t,this},setPosition:function(t,e){return this.position.x=t,this.position.y=e,this},setRotation:function(t){return this.rotation=t,this},setScale:function(t,e){return this.scale.x=t,this.scale.y=arguments.length<=1?t:e,this},setOrigin:function(t,e){return this.origin.x=t,this.origin.y=e,this},setWidth:function(t){return this.width=t,this},setHeight:function(t){return this.height=t,this},setSize:function(t,e){return this.width=t,this.height=e,this},wakeUp:function(){return this.awake=!0,this},sleep:function(){return this.awake=!1,this},setInteractive:function(t,e){return this.interactive=t,e&&(this.boundingType=e),this},setBoundingType:function(t){return this.boundingType=t,this},_checkPointing:function(){console.assert(!1)},_checkMouse:function(t){this.__checkPointing(t,t.pointing,0)},_checkTouch:function(t){this.__checkPointing(t,t.pointing,0)},__checkPointing:function(t,e,i){var n=(this.element,this.hitFlags[i]);this.hitFlags[i]=this.isHitPoint(e.x,e.y),!n&&this.hitFlags[i]&&this._dispatchPointingEvent("mouseover","touchover","pointingover",t,e),n&&!this.hitFlags[i]&&this._dispatchPointingEvent("mouseout","touchout","pointingout",t,e),this.hitFlags[i]&&e.getPointingStart()&&(this._dispatchPointingEvent("mousedown","touchstart","pointingstart",t,e),this.downFlags[i]=!0,this._clickFlag=!0),this.downFlags[i]&&this._dispatchPointingEvent("mousemove","touchmove","pointingmove",t,e),1==this.downFlags[i]&&e.getPointingEnd()&&(this._dispatchPointingEvent("mouseup","touchend","pointingend",t,e),this.downFlags[i]=!1)},_dispatchPointingEvent:function(t,e,i,n,s){this.dispatchEvent(tm.event.MouseEvent(t,n,s)),this.dispatchEvent(tm.event.TouchEvent(e,n,s)),this.dispatchEvent(tm.event.PointingEvent(i,n,s))},_calcWorldMatrix:function(){if(this.parent){if(this.rotation!=this.rotationCache){this.rotationCache=this.rotation;var t=this.rotation*Math.DEG_TO_RAD;this._sr=Math.sin(t),this._cr=Math.cos(t)}var e=this._matrix.m,i=this.parent._worldMatrix.m,n=this._worldMatrix.m;e[0]=this._cr*this.scale.x,e[1]=-this._sr*this.scale.y,e[3]=this._sr*this.scale.x,e[4]=this._cr*this.scale.y,e[2]=this.position.x,e[5]=this.position.y;var s=e[0],o=e[1],a=e[2],r=e[3],h=e[4],l=e[5],c=i[0],u=i[1],m=i[2],p=i[3],d=i[4],f=i[5];n[0]=c*s+u*r,n[1]=c*o+u*h,n[2]=c*a+u*l+m,n[3]=p*s+d*r,n[4]=p*o+d*h,n[5]=p*a+d*l+f}},_dirtyCalc:function(){this._calcWorldMatrix()}}),tm.app.Object2D.prototype.accessor("x",{get:function(){return this.position.x},set:function(t){this.position.x=t}}),tm.app.Object2D.prototype.accessor("y",{get:function(){return this.position.y},set:function(t){this.position.y=t}}),tm.app.Object2D.prototype.accessor("originX",{get:function(){return this.origin.x},set:function(t){this.origin.x=t}}),tm.app.Object2D.prototype.accessor("originY",{get:function(){return this.origin.y},set:function(t){this.origin.y=t}}),tm.app.Object2D.prototype.accessor("scaleX",{get:function(){return this.scale.x},set:function(t){this.scale.x=t}}),tm.app.Object2D.prototype.accessor("scaleY",{get:function(){return this.scale.y},set:function(t){this.scale.y=t}}),tm.app.Object2D.prototype.accessor("width",{get:function(){return this._width},set:function(t){this._width=t}}),tm.app.Object2D.prototype.accessor("height",{get:function(){return this._height},set:function(t){this._height=t}}),tm.app.Object2D.prototype.accessor("radius",{get:function(){return void 0!==this._radius?this._radius:(this.width+this.height)/4},set:function(t){this._radius=t}}),tm.app.Object2D.prototype.getter("top",function(){return this.y-this.height*this.originY}),tm.app.Object2D.prototype.getter("right",function(){return this.x+this.width*(1-this.originX)}),tm.app.Object2D.prototype.getter("bottom",function(){return this.y+this.height*(1-this.originY)}),tm.app.Object2D.prototype.getter("left",function(){return this.x-this.width*this.originX}),tm.app.Object2D.prototype.accessor("centerX",{get:function(){return this.x+this.width/2-this.width*this.originX},set:function(){}}),tm.app.Object2D.prototype.accessor("centerY",{get:function(){return this.y+this.height/2-this.height*this.originY},set:function(){}}),tm.app.Object2D.prototype.accessor("boundingType",{get:function(){return this._boundingType},set:function(t){this._boundingType=t,this._setIsHitFunc()}}),tm.app.Object2D.prototype.accessor("checkHierarchy",{get:function(){return this._checkHierarchy},set:function(t){this._checkHierarchy=t,this._setIsHitFunc()}});var t={rect:tm.app.Object2D.prototype.isHitPointRect,circle:tm.app.Object2D.prototype.isHitPointCircle,"true":function(){return!0},"false":function(){return!1}},e={rect:tm.app.Object2D.prototype.isHitPointRectHierarchy,circle:tm.app.Object2D.prototype.isHitPointCircleHierarchy,"true":function(){return!0},"false":function(){return!1}},i={rect:tm.app.Object2D.prototype.isHitElementRect,circle:tm.app.Object2D.prototype.isHitElementCircle,"true":function(){return!0},"false":function(){return!1}};tm.app.Object2D.prototype._setIsHitFunc=function(){{var n=this.checkHierarchy?e:t,s=this.boundingType;n[s]?n[s]:n["true"]}this.isHitPoint=n[s]?n[s]:n["true"],this.isHitElement=i[s]?i[s]:i["true"]},tm.app.Object2D.prototype._checkPointing=tm.isMobile?tm.app.Object2D.prototype._checkTouch:tm.app.Object2D.prototype._checkMouse}(),tm.app=tm.app||{},function(){tm.app.Scene=tm.createClass({superClass:tm.app.Object2D,nextLabel:"",nextArguments:null,init:function(){this.superInit(),this.boundingType="none",this.setInteractive(!0)}})}(),tm.app=tm.app||{},function(){tm.app.Collision=tm.createClass({element:null,collideList:null,init:function(t){this.element=t,this.collideList=[]},update:function(){for(var t=this.collideList.clone(),e=this.element,i=0,n=t.length;n>i;++i){var s=t[i];if(e.isHitElement(s.element)){if(s.collide===!1){var o=tm.event.Event("collisionenter");o.other=s.element,e.dispatchEvent(o)}var o=tm.event.Event("collisionstay");o.other=s.element,e.dispatchEvent(o),s.collide=!0}else{if(1==s.collide){var o=tm.event.Event("collisionexit");o.other=s.element,e.dispatchEvent(o)}s.collide=!1}}},add:function(t){this.collideList.push({element:t,collide:!1})},remove:function(t){this.collideList.eraseIf(function(e){return e.element==t})}}),tm.app.Element.prototype.getter("collision",function(){return this._collision||(this._collision=tm.app.Collision(this),this.addEventListener("enterframe",function(t){this._collision.update(t.app)})),this._collision})}(),function(){tm.define("tm.app.Tweener",{superClass:"tm.app.Element",init:function(t){this.superInit(),this.setTarget(t||{}),this.loop=!1,this._init()},_init:function(){this._index=0,this._tasks=[],this._func=this._updateTask,this.isPlaying=!0},setTarget:function(t){return this.element=t,this},update:function(t){return void this._func(t)},_updateTask:function(t){if(this.isPlaying){var e=this._tasks[this._index];if(!e)return void(this.loop===!0?this._index=0:this.isPlaying=!1);if(this._index++,"tween"==e.type){var i=(e.data,e.data.type),n=e.data.args;this._tween=tm.anim.Tween(),this._tween[i].apply(this._tween,n),this._func=this._updateTween,this._func(t)}else"wait"==e.type?(this._wait=e.data,this._wait.time=0,this._func=this._updateWait,this._func(t)):"call"==e.type?(e.data.func.apply(e.data.self,e.data.args),this._updateTask(t)):"set"==e.type&&(this.element.$extend(e.data.values),this._updateTask(t))}},_updateTween:function(t){var e=this._tween,i=e.time+1e3/t.fps;e._setTime(i),e.time>=e.duration?(delete this._tween,this._tween=null,this._func=this._updateTask):e.update()},_updateWait:function(t){var e=this._wait;e.time+=1e3/t.fps,e.time>=e.limit&&(delete this._wait,this._wait=null,this._func=this._updateTask)},add:function(t){if(t.target||(t.target=this.element),this._tasks.push({type:"tween",data:t}),0==this.isAnimation){this.isAnimation=!0;var e=tm.event.Event("animationstart");this.element.dispatchEvent(e)}return this},by:function(t,e,i){return this._addTweenTask({props:t,duration:e,fn:i,type:"by"}),this},to:function(t,e,i){return this._addTweenTask({props:t,duration:e,fn:i,type:"to"}),this},from:function(t,e,i){return this._addTweenTask({props:t,duration:e,fn:i,type:"from"}),this},move:function(t,e,i,n){return this.to({x:t,y:e},i,n)},moveBy:function(t,e,i,n){return this.by({x:t,y:e},i,n)},rotate:function(t,e,i){return this.to({rotation:t},e,i)},scale:function(t,e,i){return this.to({scaleX:t,scaleY:t},e,i)},fade:function(t,e){return this.to({alpha:t},e),this},fadeIn:function(t){return this.fade(1,t),this},fadeOut:function(t){return this.fade(0,t),this},_addTweenTask:function(t){if(t.target=void 0!==t.target?t.target:this.element,t.duration=void 0!==t.duration?t.duration:1e3,this._tasks.push({type:"tween",data:{args:[t.target,t.props,t.duration,t.fn],type:t.type}}),0==this.isAnimation){this.isAnimation=!0;var e=tm.event.Event("animationstart");this.element.dispatchEvent(e)}return this},wait:function(t){return this._tasks.push({type:"wait",data:{limit:t}}),this},call:function(t,e,i){return this._tasks.push({type:"call",data:{func:t,self:e||this,args:i}}),this},set:function(t,e){var i=null;return 2==arguments.length?(i={},i[t]=e):i=t,this._tasks.push({type:"set",data:{values:i}}),this},play:function(){return this.isPlaying=!0,this},pause:function(){return this.isPlaying=!1,this
},rewind:function(){return this._func=this._updateTask,this._index=0,this.play(),this},setLoop:function(t){return this.loop=t,this},clear:function(){return this._init(),this}}),tm.app.Element.prototype.getter("tweener",function(){return this._tweener||(this._tweener=tm.app.Tweener(this),this.on("enterframe",function(t){this._tweener.update(t.app)})),this._tweener})}(),tm.namespace("tm.app",function(){tm.define("tm.app.Timeline",{superClass:"tm.app.Element",init:function(t){this.superInit(),this.setTarget(t||{}),this.currentFrame=0,this.currentTime=0,this.prevTime=0,this.duration=0,this.isPlay=!0,this._tweens=[],this._actions=[]},update:function(t){this.isPlay&&(this.prevTime<=this.duration&&(this._updateTween(),this._updateAction()),this.currentFrame++,this.prevTime=this.currentTime,this.currentTime=this.currentFrame/t.fps*1e3|0)},_updateTween:function(){for(var t=this._tweens,e=0,i=t.length;i>e;++e){var n=t[e];if(!(n.delay>this.currentTime)){var s=this.currentTime-n.delay;n._setTime(s),n.time>=n.duration||n.update()}}},_updateAction:function(){for(var t=this._actions,e=0,i=t.length;i>e;++e){var n=t[e];if(this.prevTime<=n.delay&&n.delay<this.currentTime)if("call"==n.type)n.func.call(n.self);else if("set"==n.type){var s=n.props;for(var o in s)this.element[o]=s[o]}}},to:function(t,e,i,n){return console.assert("number"==typeof t,"to の第一引数はdelayに変わりました"),this._addTween({props:e,duration:i,fn:n,delay:t}),this},by:function(t,e,i,n){console.assert("number"==typeof t,"by の第一引数はdelayに変わりました");for(var s in e)e[s]+=this.element[s]||0;return this._addTween({props:e,duration:i,fn:n,delay:t}),this},call:function(t,e,i){return console.assert("number"==typeof t,"call の第一引数はdelayに変わりました"),this._addAction({type:"call",func:e,self:i||this,delay:t}),this},set:function(t,e){return console.assert("number"==typeof t,"set の第一引数はdelayに変わりました"),this._addAction({type:"set",props:e,delay:t}),this},setTarget:function(t){return this.element=t,this},getTarget:function(){return this.element},gotoAndPlay:function(t){this.isPlay=!0,this.currentFrame=t,this._updateTween()},gotoAndStop:function(t){this.currentFrame=t,this.isPlay=!1,this._updateTween()},_addTween:function(t){t.duration=t.duration||1e3,t.duration=this._dirty(t.duration),t.delay=t.delay||0,t.delay=this._dirty(t.delay);var e=tm.anim.Tween();e.to(this.element,t.props,t.duration,t.fn),e.delay=t.delay,this._tweens.push(e),this._updateDuration(e)},_addAction:function(t){t.delay=t.delay||0,t.delay=this._dirty(t.delay),this._actions.push(t),this._updateDuration(t)},_updateDuration:function(t){var e=t.delay+(t.duration?t.duration:0);return this.duration<e&&(this.duration=e),this},_dirty:function(t){return t},load:function(t){for(var e in t.timeline)var i=t.timeline[e];return this},clear:function(){return this.currentFrame=0,this.prevTime=0,this.currentTime=0,this.duration=0,this.isPlay=!0,this._tweens=[],this._actions=[],this}}),tm.app.Element.prototype.getter("timeline",function(){return this._timeline||(this._timeline=tm.app.Timeline(this),this.on("enterframe",function(t){this._timeline.update(t.app)})),this._timeline})}),tm.display=tm.display||{},function(){tm.display.CanvasApp=tm.createClass({superClass:tm.app.BaseApp,init:function(t){this.element=t instanceof HTMLCanvasElement?t:"string"==typeof t?document.querySelector(t):document.createElement("canvas"),this.superInit(this.element),this.canvas=tm.graphics.Canvas(this.element),this.renderer=tm.display.CanvasRenderer(this.canvas),this.background="black",this._scenes=[tm.app.Scene()],this._canvasCache=[],this._canvasCacheCache=[],this.on("push",function(){this._draw();var t=this._canvasCacheCache.pop();if(!t){var e=this.canvas.element.cloneNode();t=tm.graphics.Canvas(e)}t.clear(),t.drawTexture(this.canvas,0,0),this._canvasCache.push(t)}),this.on("poped",function(){var t=this._canvasCache.pop();this._draw(),this._canvasCacheCache.push(t)})},resize:function(t,e){return this.width=t,this.height=e,this},resizeWindow:function(){return this.width=innerWidth,this.height=innerHeight,this},fitWindow:function(t){return this.canvas.fitWindow(t),this.mouse._mousemove=this.mouse._mousemoveScale,this.touch._touchmove=this.touch._touchmoveScale,this},_draw:function(){this.canvas.clear(),this.canvas.fillStyle="white",this.canvas.strokeStyle="white",this.canvas.context.lineJoin="round",this.canvas.context.lineCap="round",this._canvasCache.last&&this.canvas.drawTexture(this._canvasCache.last,0,0),this.canvas.save(),this.renderer.render(this.currentScene),this.canvas.restore()}}),tm.display.CanvasApp.prototype.accessor("width",{get:function(){return this.canvas.width},set:function(t){this.canvas.width=t}}),tm.display.CanvasApp.prototype.accessor("height",{get:function(){return this.canvas.height},set:function(t){this.canvas.height=t}}),tm.display.CanvasApp.prototype.accessor("background",{get:function(){return this.canvas._background},set:function(t){this._background=t,this.element.style.background=t}})}(),tm.display=tm.display||{},function(){tm.display.CanvasElement=tm.createClass({superClass:tm.app.Object2D,visible:!0,clipping:!1,fillStyle:"white",strokeStyle:"white",alpha:1,blendMode:"source-over",shadowColor:"black",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,init:function(){this.superInit()},setAlpha:function(t){return this.alpha=t,this},setShadowColor:function(t){return this.shadowColor=t,this},setShadowBlur:function(t){return this.shadowBlur=t,this},setShadowOffset:function(t,e){return this.shadowOffsetX=t,this.shadowOffsetY=e,this},drawBoundingCircle:function(t){t.save(),t.lineWidth=2,t.strokeCircle(0,0,this.radius),t.restore()},drawBoundingRect:function(t){t.save(),t.lineWidth=2,t.strokeRect(-this.width*this.originX,-this.height*this.originY,this.width,this.height),t.restore()},drawFillRect:function(t){return t.fillRect(-this.width/2,-this.height/2,this.width,this.height),this},drawStrokeRect:function(t){return t.strokeRect(-this.width/2,-this.height/2,this.width,this.height),this},drawFillArc:function(t){return t.beginPath(),t.arc(0,0,this.radius,0,2*Math.PI,!1),t.fill(),t.closePath(),this},drawStrokeArc:function(t){return t.beginPath(),t.arc(0,0,this.radius,0,2*Math.PI,!1),t.stroke(),t.closePath(),this},setVisible:function(t){return this.visible=t,this},show:function(){return this.visible=!0,this},hide:function(){return this.visible=!1,this},setFillStyle:function(t){return this.fillStyle=t,this},setStrokeStyle:function(t){return this.strokeStyle=t,this},setBlendMode:function(t){return this.blendMode=t,this},load:function(t){var e=this;t.layers.forEach(function(t){if("objectgroup"==t.type){var i=tm.display.CanvasElement().addChildTo(e);i.width=t.width,i.height=t.height,t.objects.forEach(function(t){var e=tm.using(t.type);0===Object.keys(e).length&&(e=tm.display[t.type]);var n=null;t.properties.init&&(n=JSON.parse(t.properties.init));var s=e.apply(null,n).addChildTo(i),o=t.properties;for(var a in o)if("init"!=a){var r=o[a];s[a]=r}s.x=t.x,s.y=t.y,s.width=t.width,s.height=t.height}),e[t.name]=i}})},_calcAlpha:function(){return this.parent?void(this._worldAlpha=this.parent._worldAlpha*this.alpha):void(this._worldAlpha=this.alpha)},_dirtyCalc:function(){this._calcAlpha(),this._calcWorldMatrix()}})}(),tm.display=tm.display||{},function(){tm.display.Sprite=tm.createClass({superClass:tm.display.CanvasElement,init:function(t,e,i){this.superInit(),console.assert("number"!=typeof t,"Sprite の第一引数はテクスチャもしくはテクスチャ名に変わりました"),this._frameIndex=0,this.srcRect=tm.geom.Rect(0,0,64,64),arguments.length>=1&&(this.setImage(t).fitImage(),void 0!==e&&(this.width=e),void 0!==i&&(this.height=i))},setImage:function(t,e,i){if("string"==typeof t){var n=t;t=tm.asset.Manager.get(n),console.assert(null!=t,"don't find '"+n+"' as image.")}return this._image=t,this.srcRect.x=0,this.srcRect.y=0,this.srcRect.width=t.element.width,this.srcRect.height=t.element.height,void 0!==e&&(this.width=e),void 0!==i&&(this.height=i),this},getImage:function(){return this._image},fitImage:function(){return this.width=this.image.width,this.height=this.image.height,this},setFrameIndex:function(t,e,i){var n=e||this.width,s=i||this.height,o=~~(this.image.width/n),a=~~(this.image.height/s),r=o*a;t%=r;var h=t%o,l=~~(t/o);return this.srcRect.x=h*n,this.srcRect.y=l*s,this.srcRect.width=n,this.srcRect.height=s,this._frameIndex=t,this},_refreshSize:function(){}}),tm.display.Sprite.prototype.accessor("image",{get:function(){return this._image},set:function(t){this.setImage(t)}}),tm.display.Sprite.prototype.accessor("frameIndex",{get:function(){return this._frameIndex},set:function(t){this.setFrameIndex(t)}})}(),tm.display=tm.display||{},function(){tm.display.Shape=tm.createClass({superClass:tm.display.CanvasElement,init:function(t){t=this._dirtyCheckParam.apply(this,arguments);var t={}.$safe(t,{width:64,height:64,bgColor:"transparent",fillStyle:"red",strokeStyle:"white",lineWidth:"2",shadowBlur:0,shadowColor:"red"});this.superInit(),this.canvas=tm.graphics.Canvas(),this.$extend(t),this.render(),this.autoRender=!0},_prerender:function(){var t=this.canvas;return t.resize(this.width,this.height),t.clearColor(this.bgColor),t.save(),t.fillStyle=this.fillStyle,t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.shadowBlur=this.shadowBlur,t.shadowColor=this.shadowColor,this},_postrender:function(){var t=this.canvas;return t.restore(),this},render:function(){this._prerender(),this._render(),this._postrender()},_render:function(){},renderText:function(t){var e=this.canvas;t={}.$extend(tm.display.Shape.DEFAULT_SHAPE_PARAM_TEXT,t),e.save(),e.fillStyle=t.fillStyle,e.strokeStyle=t.strokeStyle,e.lineWidth=t.lineWidth,e.font=t.font,e.textAlign=t.textAlign,e.textBaseline=t.textBaseline,e.strokeText(t.text,this.width/2,this.height/2),e.fillText(t.text,this.width/2,this.height/2),e.restore()},_dirtyCheckParam:function(t){var t=t;if(arguments.length>=2){var e=arguments[0],i=arguments[1],t=arguments[2]||{};t.width=e,t.height=i,console.warn("tmlib.js warn: arguments of shape init is only param from version 0.4")}return t}}),["width","height","bgColor","strokeStyle","fillStyle","lineWidth","shadowBlur","shadowColor"].each(function(t){var e="_"+t;tm.display.Shape.prototype.accessor(t,{get:function(){return this[e]},set:function(t){this[e]=t,this.autoRender===!0&&this.render()}})})}(),function(){tm.define("tm.display.CircleShape",{superClass:tm.display.Shape,init:function(t){t=this._dirtyCheckParam.apply(this,arguments),this.superInit(t),this.render()},_render:function(){var t=this.canvas,e=Math.min(this.width,this.height)/2;t.fillCircle(this.width/2,this.height/2,e),t.strokeCircle(this.width/2,this.height/2,e-Number(t.lineWidth)/2)}})}(),function(){tm.define("tm.display.TriangleShape",{superClass:tm.display.Shape,init:function(t){t=this._dirtyCheckParam.apply(this,arguments),t={}.$safe(t,{fillStyle:"green"}),this.superInit(t),this.render()},_render:function(){var t=this.canvas,e=this.width/2,i=this.height/2,n=Math.min(this.width,this.height)/2,s=1*Number(t.lineWidth);t.fillPolygon(e,i,n,3),t.strokePolygon(e,i,n-s,3)}})}(),function(){tm.define("tm.display.RectangleShape",{superClass:tm.display.Shape,init:function(t){t=this._dirtyCheckParam.apply(this,arguments),t={}.$safe(t,{fillStyle:"blue"}),this.superInit(t),this.render()},_render:function(){var t=this.canvas,e=this.lineWidth,i=e/2;t.fillRect(0,0,this.width,this.height),t.strokeRect(i,i,this.width-e,this.height-e)}})}(),function(){tm.define("tm.display.RoundRectangleShape",{superClass:tm.display.Shape,init:function(t){t=this._dirtyCheckParam.apply(this,arguments),t={}.$safe(t,{fillStyle:"blue",cornerRadius:8}),this.superInit(t),this.render()},_render:function(){var t=this.canvas,e=this.lineWidth,i=e/2;t.fillRoundRect(i,i,this.width-e,this.height-e,this.cornerRadius),t.strokeRoundRect(i,i,this.width-e,this.height-e,this.cornerRadius)}}),["cornerRadius"].each(function(t){var e="_"+t;tm.display.RoundRectangleShape.prototype.accessor(t,{get:function(){return this[e]},set:function(t){this[e]=t,this.autoRender===!0&&this.render()}})})}(),function(){tm.define("tm.display.StarShape",{superClass:tm.display.Shape,init:function(t){t=this._dirtyCheckParam.apply(this,arguments),t={}.$safe(t,{fillStyle:"yellow",sides:5,sideIndent:.38,offsetAngle:-90}),this.superInit(t),this.render()},_render:function(){var t=this.canvas,e=this.sides,i=this.sideIndent,n=this.offsetAngle,s=this.width/2,o=this.height/2,a=Math.min(this.width,this.height)/2,r=1.5*Number(t.lineWidth);t.fillStar(s,o,a,e,i,n),t.strokeStar(s,o,a-r,e,i,n)}}),["sides","sideIndent","offsetAngle"].each(function(t){var e="_"+t;tm.display.StarShape.prototype.accessor(t,{get:function(){return this[e]},set:function(t){this[e]=t,this.autoRender===!0&&this.render()}})})}(),function(){tm.define("tm.display.PolygonShape",{superClass:tm.display.Shape,init:function(t){t=this._dirtyCheckParam.apply(this,arguments),t={}.$safe(t,{fillStyle:"cyan",sides:5,sideIndent:.38,offsetAngle:-90}),this.superInit(t),this.render()},_render:function(){var t=this.canvas,e=this.sides,i=this.offsetAngle,n=this.width/2,s=this.height/2,o=Math.min(this.width,this.height)/2,a=.6*Number(t.lineWidth);t.fillPolygon(n,s,o,e,i),t.strokePolygon(n,s,o-a,e,i)}}),["sides","offsetAngle"].each(function(t){var e="_"+t;tm.display.PolygonShape.prototype.accessor(t,{get:function(){return this[e]},set:function(t){this[e]=t,this.autoRender===!0&&this.render()}})})}(),function(){tm.define("tm.display.HeartShape",{superClass:tm.display.Shape,init:function(t){t=this._dirtyCheckParam.apply(this,arguments),t={}.$safe(t,{fillStyle:"pink",cornerAngle:45}),this.superInit(t),this.render()},_render:function(){var t=this.canvas,e=this.width/2,i=this.height/2,n=Math.min(this.width,this.height)/2;t.fillHeart(e,i,n,this.cornerAngle),t.strokeHeart(e,i,n-Number(t.lineWidth)/2,this.cornerAngle)}}),["cornerAngle"].each(function(t){var e="_"+t;tm.display.HeartShape.prototype.accessor(t,{get:function(){return this[e]},set:function(t){this[e]=t,this.autoRender===!0&&this.render()}})})}(),function(){var t=null;tm.define("tm.display.TextShape",{superClass:"tm.display.Shape",init:function(t,e,i){i=this._dirtyCheckParam.apply(this,arguments),i={}.$safe(i,{fillStyle:"black",lineWidth:4,text:"hello, world!",fontSize:64,fontWeight:"",fontFamily:"'HiraKakuProN-W3'"}),this.superInit(i),this.fit(),this.render()},fit:function(){t||(t=tm.graphics.Canvas()),t.font="{fontWeight} {fontSize}px {fontFamily}".format(this);var e=t.context.measureText(this.text).width+10,i=1.5*t.context.measureText("あ").width;this.width=e,this.height=i},_render:function(){var t=this.canvas;t.fillStyle=this.fillStyle,t.strokeStyle=this.strokeStyle,t.font="{fontWeight} {fontSize}px {fontFamily}".format(this),t.textAlign="center",t.textBaseline="middle";var e=(t.context.measureText(this.text).width,this.width/2),i=this.height/2;t.strokeText(this.text,e,i),t.fillText(this.text,e,i)}}),["text","fontWeight","fontSize","fontFamily"].each(function(t){var e="_"+t;tm.display.TextShape.prototype.accessor(t,{get:function(){return this[e]},set:function(t){this[e]=t,this.autoRender===!0&&this.render()}})})}(),tm.display=tm.display||{},function(){var t=null,e=null;tm.display.Label=tm.createClass({superClass:tm.display.CanvasElement,fill:!0,stroke:!1,debugBox:!1,init:function(t,e){this.superInit(),this.text=t||"",this._fontSize=e||24,this._fontFamily=tm.display.Label["default"].fontFamily,this._fontWeight="",this._lineHeight=1.2,this._updateFont(),this.align=tm.display.Label["default"].align,this.baseline=tm.display.Label["default"].baseline,this.maxWidth=null},setAlign:function(t){return this.align=t,this},setBaseline:function(t){return this.baseline=t,this},setFontSize:function(t){return this.fontSize=t,this},setFontFamily:function(t){return this.fontFamily=t,this},setFontWeight:function(t){return this.fontWeight=t,this},_updateFont:function(){this.fontStyle="{fontWeight} {fontSize}px {fontFamily}".format(this),t||(t=document.createElement("canvas"),e=t.getContext("2d")),e.font=this.fontStyle,this.textSize=e.measureText("あ").width*this.lineHeight},_updateLines:function(){this._lines=(this._text+"").split("\n")}}),tm.display.Label.prototype.accessor("text",{get:function(){return this._text},set:function(t){this._text=null==t||void 0==t?"":t,this._updateLines()}}),tm.display.Label.prototype.accessor("fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize=t,this._updateFont()}}),tm.display.Label.prototype.accessor("fontFamily",{get:function(){return this._fontFamily},set:function(t){this._fontFamily=t,this._updateFont()}}),tm.display.Label.prototype.accessor("fontWeight",{get:function(){return this._fontWeight},set:function(t){this._fontWeight=t,this._updateFont()}}),tm.display.Label.prototype.accessor("lineHeight",{get:function(){return this._lineHeight},set:function(t){this._lineHeight=t,this._updateFont()}}),tm.display.Label["default"]={align:"center",baseline:"middle",fontFamily:"'HiraKakuProN-W3'"}}(),tm.display=tm.display||{},function(){tm.display.AnimationSprite=tm.createClass({superClass:tm.display.CanvasElement,init:function(t,e,i){if(this.superInit(),"string"==typeof t){var t=tm.asset.Manager.get(t);console.assert(t,"not found "+t)}console.assert("object"==typeof t,"AnimationSprite の第一引数はスプライトシートもしくはスプライトシート名に変わりました"),this.ss=t,this.width=e||t.frame.width,this.height=i||t.frame.height,this.currentFrame=0,this.currentFrameIndex=0,this.paused=!0,this.currentAnimation=null,this.addEventListener("enterframe",function(t){this.paused||t.app.frame%this.currentAnimation.frequency!==0||this._updateFrame()})},draw:function(t){var e=this.ss.getFrame(this.currentFrame),i=this.ss.image.element;t.drawImage(i,e.x,e.y,e.width,e.height,-this.width*this.originX,-this.height*this.originY,this.width,this.height)},gotoAndPlay:function(t){return t=void 0!==t?t:"default",this.paused=!1,this.currentAnimation=this.ss.animations[t],this.currentFrame=0,this.currentFrameIndex=0,this._normalizeFrame(),this},gotoAndStop:function(t){return t=void 0!==t?t:"default",this.paused=!0,this.currentAnimation=this.ss.animations[t],this.currentFrame=0,this.currentFrameIndex=0,this._normalizeFrame(),this},_updateFrame:function(){this.currentFrameIndex+=1,this._normalizeFrame()},_normalizeFrame:function(){var t=this.currentAnimation;if(t)if(this.currentFrameIndex<t.frames.length)this.currentFrame=t.frames[this.currentFrameIndex];else{t.next?this.gotoAndPlay(t.next):(this.currentFrameIndex=t.frames.length-1,this.currentFrame=t.frames[this.currentFrameIndex],this.paused=!0);var e=tm.event.Event("animationend");this.dispatchEvent(e)}}})}(),function(){tm.define("tm.display.MapSprite",{superClass:"tm.display.CanvasElement",init:function(t,e,i){this.superInit(),this.mapSheet="string"==typeof t?tm.asset.Manager.get(t):t,this.chipWidth=e||32,this.chipHeight=i||32,this.originX=this.originY=0,this.width=e*this.mapSheet.width,this.height=e*this.mapSheet.height,this.tileset=[],this.tilesetInfo={},this._build()},_build:function(){var t=this;this.mapSheet.tilesets.each(function(e,i){t._buildTileset(e,i)}),this.mapSheet.layers.each(function(e){"objectgroup"==e.type?t._buildObject(e):t._buildLayer(e)})},_buildTileset:function(t,e){var i=this,n=this.mapSheet,s=tm.asset.Manager.get(t.image),o=s.width/n.tilewidth|0,a=s.height/n.tileheight|0,r={begin:i.tileset.length,end:i.tileset.length+o*a};i.tilesetInfo[e]=r,void 0!==t.name&&(i.tilesetInfo[t.name]=r),a.times(function(e){o.times(function(s){var o=tm.geom.Rect(s*n.tilewidth,e*n.tileheight,n.tilewidth,n.tileheight);i.tileset.push({image:t.image,rect:o})})})},_buildLayer:function(t){var e=this,i=this.mapSheet,n=tm.display.Shape({width:this.width,height:this.height}).addChildTo(this),s=1===t.visible||void 0===t.visible,o=void 0===t.opacity?1:t.opacity,a=[];if(n.origin.set(0,0),void 0!==t.tilesets){var r=null;r=Array.isArray(t.tilesets)?t.tilesets:[t.tilesets],r.each(function(t){var i=e.tilesetInfo[t];a=a.concat(e.tileset.slice(i.begin,i.end))})}else a=e.tileset;s&&t.data.each(function(t,s){var r=t;if(-1!=r&&(r=Math.abs(r),void 0!==a[r])){var h=s%i.width,l=s/i.width|0,c=h*e.chipWidth,u=l*e.chipHeight,m=a[r],p=tm.asset.Manager.get(m.image),d=m.rect;n.canvas.globalAlpha=o,n.canvas.drawTexture(p,d.x,d.y,d.width,d.height,c,u,e.chipWidth,e.chipHeight)}}.bind(this))},_buildObject:function(t){var e=this,i=tm.display.CanvasElement().addChildTo(e);i.width=t.width,i.height=t.height,t.objects.forEach(function(t){var e=tm.using(t.type);0===Object.keys(e).length&&(e=tm.display[t.type]);var n=null;t.properties.init&&(n=JSON.parse(t.properties.init));var s=e.apply(null,n).addChildTo(i),o=t.properties;for(var a in o)if("init"!=a){var r=o[a];s[a]=r}s.x=t.x,s.y=t.y,s.width=t.width,s.height=t.height,i[t.name]=s}),e[t.name]=i}})}(),function(){tm.define("tm.display.CanvasRenderer",{canvas:null,init:function(t){this.canvas=t,this._context=this.canvas.context},render:function(t){this.canvas.save(),this.renderObject(t),this.canvas.restore()},renderObject:function(t){if(t.visible!==!1){var i=this._context;if(t._dirtyCalc&&t._dirtyCalc(),this._checkRenderable(t)){t.draw||this._setRenderFunction(t),t.fillStyle&&(i.fillStyle=t.fillStyle),t.strokeStyle&&(i.strokeStyle=t.strokeStyle),i.globalAlpha=t._worldAlpha,i.globalCompositeOperation=t.blendMode,t.shadowBlur?(i.shadowColor=t.shadowColor,i.shadowOffsetX=t.shadowOffsetX,i.shadowOffsetY=t.shadowOffsetY,i.shadowBlur=t.shadowBlur):(i.shadowOffsetX=0,i.shadowOffsetY=0,i.shadowColor="rgba(0, 0, 0, 0)");var n=t._worldMatrix.m;if(i.setTransform(n[0],n[3],n[1],n[4],n[2],n[5]),t.clipping){if(i.save(),t.clip?t.clip():e.call(t,this.canvas),i.clip(),t.draw(this.canvas),t.children.length>0)for(var s=t.children.slice(),o=0,a=s.length;a>o;++o)this.renderObject(s[o]);i.restore()}else if(t.draw(this.canvas),t.children.length>0)for(var s=t.children.slice(),o=0,a=s.length;a>o;++o)this.renderObject(s[o])}else if(t.children.length>0)for(var s=t.children.slice(),o=0,a=s.length;a>o;++o)this.renderObject(s[o])}},_checkRenderable:function(t){return void 0===t._renderable&&(t._renderable=t instanceof tm.display.CanvasElement),t._renderable},_setRenderFunction:function(e){e.draw=e instanceof tm.display.Sprite?t.sprite:e instanceof tm.display.MapSprite?function(){}:e instanceof tm.display.Label?t.label:e instanceof tm.display.Shape?t.shape:function(){}}});var t={sprite:function(t){var e=this.srcRect,i=this._image.element;t.context.drawImage(i,e.x,e.y,e.width,e.height,-this.width*this.origin.x,-this.height*this.origin.y,this.width,this.height)},shape:function(t){this.srcRect;t.drawImage(this.canvas.canvas,0,0,this.canvas.width,this.canvas.height,-this.width*this.origin.x,-this.height*this.origin.y,this.width,this.height)},label:function(t){t.setText(this.fontStyle,this.align,this.baseline),this.lineWidth&&(t.lineWidth=this.lineWidth),this.stroke&&this._lines.each(this.maxWidth?function(e,i){t.strokeText(e,0,this.textSize*i,this.maxWidth)}.bind(this):function(e,i){t.strokeText(e,0,this.textSize*i)}.bind(this)),this.fill&&this._lines.each(this.maxWidth?function(e,i){t.fillText(e,0,this.textSize*i,this.maxWidth)}.bind(this):function(e,i){t.fillText(e,0,this.textSize*i)}.bind(this)),this.debugBox&&t.strokeRect(0,0,this.width,-this.size)}},e=function(t){t.beginPath(),t.rect(-this.width*this.origin.x,-this.height*this.origin.y,this.width,this.height)}}(),function(){tm.define("tm.display.BoundingRectRenderer",{superClass:"tm.display.CanvasRenderer",init:function(t){this.superInit(t)},_setRenderFunction:function(e){e.draw=t}});var t=function(t){t.save(),t.lineWidth=2,t.strokeRect(-this.width*this.originX,-this.height*this.originY,this.width,this.height),t.restore()}}(),tm.ui=tm.ui||{},function(){tm.ui.Pad=tm.createClass({superClass:tm.display.Shape,isTouching:!1,circle:null,init:function(){this.superInit(120,120);var t=this.canvas;t.fillStyle="#fff",t.fillCircle(60,60,60),t.fillStyle="#eee",this._createCircle(),this.setInteractive(!0),this.alpha=.75},_createCircle:function(){var t=this.circle=tm.display.Shape(80,80);this.addChild(t);var e=t.canvas;e.fillStyle="#222",e.setShadow("black",2,2,2),e.fillCircle(40,40,35)},onpointingstart:function(){this.isTouching=!0},onpointingend:function(){this.isTouching=!1,this.circle.position.set(0,0)},onpointingmove:function(t){if(0!=this.isTouching){var e=t.pointing,i=tm.geom.Vector2(e.x-this.x,e.y-this.y),n=i.length();i.div(n),n>40&&(n=40),this.angle=Math.radToDeg(i.toAngle()),this.circle.position.set(i.x*n,i.y*n),this.distance=n/40,this.direction=i.mul(this.distance)}}})}(),tm.ui=tm.ui||{},function(){tm.ui.LabelButton=tm.createClass({superClass:tm.display.Label,init:function(t){this.superInit(t),this.alpha=tm.ui.LabelButton.DEFAULT_ALPHA,this.setAlign("center").setBaseline("middle"),this.setInteractive(!0),this.boundingType="rect",this.addEventListener("pointingover",function(){this.tweener.clear(),this.tweener.fadeIn(250)}.bind(this)),this.addEventListener("pointingout",function(){this.tweener.clear(),this.tweener.fade(tm.ui.LabelButton.DEFAULT_ALPHA,250)}.bind(this))}}),tm.ui.LabelButton.DEFAULT_ALPHA=.5}(),function(){tm.ui.IconButton=tm.createClass({superClass:tm.display.Sprite,init:function(t){t?this.superInit(t,t.width,t.height):this.superInit(),this.alpha=tm.ui.IconButton.DEFAULT_ALPHA,this.setInteractive(!0),this.boundingType="rect",this.addEventListener("pointingover",function(){this.tweener.clear(),this.tweener.fade(1,250)}),this.addEventListener("pointingout",function(){this.tweener.clear(),this.tweener.fade(tm.ui.LabelButton.DEFAULT_ALPHA,250)})}}),tm.ui.IconButton.DEFAULT_ALPHA=.5}(),function(){tm.ui.GlossyButton=tm.createClass({superClass:tm.display.Shape,init:function(t,e,i,n){this.superInit(t,e),n=n||"Button",this.backgroundColor=i||"black",this.alpha=tm.ui.GlossyButton.DEFAULT_ALPHA,this.setInteractive(!0),this.boundingType="rect",this.addEventListener("pointingover",function(){this.tweener.clear(),this.tweener.fade(1,250)}),this.addEventListener("pointingout",function(){this.tweener.clear(),this.tweener.fade(tm.ui.GlossyButton.DEFAULT_ALPHA,250)}),this.label=tm.display.Label(n||"").addChildTo(this),this.label.setAlign("center").setBaseline("middle"),this._refresh()},setBackgroundColor:function(t){return this.backgroundColor=t,this._refresh(),this},_refresh:function(){var t=this.canvas;t.resize(this.width,this.height),t.fillStyle=this.backgroundColor,t.fillRoundRect(2,2,this.width-4,this.height-4,10),t.strokeStyle="rgba(100,100,100,0.75)",t.lineWidth=2,t.strokeRoundRect(2,2,this.width-4,this.height-4,10),t.roundRect(2,2,this.width-4,this.height-4,10),t.clip();var e=tm.graphics.LinearGradient(0,0,0,this.height);e.addColorStop(0,"rgba(255,255,255,0.9)"),e.addColorStop(.5,"rgba(255,255,255,0.5)"),e.addColorStop(.51,"rgba(255,255,255,0.2)"),e.addColorStop(1,"rgba(255,255,255,0.0)"),t.setGradient(e),t.fillRect(2,2,this.width-4,this.height-4,10),this.label.setSize(this.width,this.height)}}),tm.ui.GlossyButton.DEFAULT_ALPHA=.5}(),function(){tm.define("tm.ui.FlatButton",{superClass:"tm.display.RoundRectangleShape",init:function(t){t=(t||{}).$safe(tm.ui.FlatButton.defaults),this.superInit(t),this.setInteractive(!0),this.setBoundingType("rect"),this.on("pointingend",function(){this.flare("push")}),this.label=tm.display.Label(t.text).addChildTo(this),this.label.setFontSize(t.fontSize).setFontFamily(t.fontFamily).setAlign("center").setBaseline("middle")}}),tm.ui.FlatButton.defaults={width:300,height:100,fillStyle:"hsl(180, 60%, 50%)",strokeStyle:"transparent",text:"START",fontSize:50,cornerRadius:8,fontFamily:"'ヒラギノ角ゴ Pro W3', 'Hiragino Kaku Gothic Pro', 'メイリオ', 'Meiryo', 'ＭＳ Ｐゴシック', 'MS PGothic', sans-serif"}}(),function(){tm.define("tm.ui.MenuDialog",{superClass:tm.app.Scene,titleText:null,menu:null,descriptions:null,showExit:!1,title:null,selections:[],description:null,box:null,cursor:null,_selected:0,_opened:!1,_finished:!1,_screenWidth:0,_screenHeight:0,init:function(t){this.superInit(),this._screenWidth=t.screenWidth,this._screenHeight=t.screenHeight,this.titleText=t.title,this.menu=[].concat(t.menu),this._selected=~~t.defaultSelected,this.showExit=!!t.showExit,this.descriptions=t.menuDesctiptions?t.menuDesctiptions:[].concat(t.menu),this.showExit&&(this.menu.push("exit"),this.descriptions.push("前の画面へ戻ります"));var e=Math.max(50*(1+this.menu.length),50)+40;this.box=tm.display.RectangleShape(.8*this._screenWidth,e,{strokeStyle:"rgba(0,0,0,0)",fillStyle:"rgba(43,156,255, 0.8)"}).setPosition(.5*this._screenWidth,.5*this._screenHeight),this.box.width=1,this.box.height=1,this.box.setBoundingType("rect"),this.box.tweener.to({width:.8*this._screenWidth,height:e},200,"easeOutExpo").call(this._onOpen.bind(this)),this.box.addChildTo(this),this.description=tm.display.Label("",14).setAlign("center").setBaseline("middle").setPosition(.5*this._screenWidth,this._screenHeight-10).addChildTo(this)},_onOpen:function(){var t=this,e=.5*this._screenHeight-25*this.menu.length;this.title=tm.display.Label(this.titleText,30).setAlign("center").setBaseline("middle").setPosition(.5*this._screenWidth,e).addChildTo(this),this.cursor=this._createCursor(),this.selections=this.menu.map(function(t,i){var n=this;e+=50;var s=tm.ui.LabelButton(t).setPosition(.5*this._screenWidth,e).addChildTo(this);return s.interactive=!0,s.addEventListener("click",function(){if(n._selected===i)n.closeDialog(n._selected);else{n._selected=i;var t=tm.event.Event("menuselect");t.selectValue=n.menu[n._selected],t.selectIndex=i,n.dispatchEvent(t)}}),s.width=.7*this._screenWidth,s}.bind(this)),this.cursor.y=this.selections[this._selected].y,this._opened=!0,this.addEventListener("pointingend",function(e){var i=e.app.pointing;t.box.isHitPoint(i.x,i.y)||t.closeDialog(t._selected)});var i=tm.event.Event("menuopened");this.dispatchEvent(i)},_createCursor:function(){var t=tm.display.RectangleShape(.7*this._screenWidth,30,{strokeStyle:"rgba(0,0,0,0)",fillStyle:"rgba(12,79,138,1)"}).addChildTo(this);return t.x=.5*this._screenWidth,t.target=this._selected,t.update=function(){this.target!==this.parent._selected&&(this.target=this.parent._selected,this.tweener.clear(),this.tweener.to({y:this.parent.selections[this.parent._selected].y},200,"easeOutExpo"))},t},update:function(){this.description.text=this.descriptions[this._selected]},closeDialog:function(t){this._finished=!0;var e=tm.event.Event("menuselected");e.selectIndex=t,this.dispatchEvent(e),this.tweener.clear().wait(200).call(function(){this.cursor.remove(),this.title.remove(),this.selections.each(function(t){t.remove()}),this.box.tweener.clear(),this.box.tweener.to({width:1,height:1},200,"easeInExpo").call(function(){this.app.popScene();var e=tm.event.Event("menuclosed");e.selectIndex=t,this.dispatchEvent(e)}.bind(this))}.bind(this)),this.cursor.tweener.clear().call(function(){this.visible=!this.visible}.bind(this.cursor)).setLoop(!0)},draw:function(t){t.fillStyle="rgba(0,0,0,0.8)",t.fillRect(0,0,this._screenWidth,this._screenHeight)}})}(),function(){var t={bgColor:"rgba(255, 255, 255, 1.0)",penColor:"rgba(0, 0, 0, 1.0)",lineWidth:16};tm.define("tm.ui.Sketch",{superClass:"tm.display.Shape",init:function(e){e=this._dirtyCheckParam.apply(this,arguments),e.$safe(t),this.superInit(e),this.autoRender=!1,this._setup(e)},_setup:function(t){var e=this;this.boundingType="rect",this.setInteractive(!0);var i=this.canvas.context;i.lineCap="round",i.lineJoin="round",i.miterLimit=10,this.bgColor=t.bgColor,this.penColor=t.penColor,this.lineWidth=t.lineWidth,this.on("pointingstart",function(t){var i=t.app.pointing;e._drawPoint(i.position)}),this.on("pointingmove",function(t){var i=t.app.pointing;e._drawLine(i.prevPosition,i.position),e.points.push({x:i.x-this.left,y:i.y-this.top})}),this.on("pointingend",function(){e.pointsList.push(e.points),e.points=[]}),this.pointsList=[],this.points=[]},clear:function(){return this.canvas.clear(),this.canvas.clearColor(this.bgColor),this.pointsList=[],this.points=[],this},_drawPoint:function(t){this.canvas.drawPoint(t.x-this.left,t.y-this.top)},_drawLine:function(t,e){this.canvas.drawLine(t.x-this.left,t.y-this.top,e.x-this.left,e.y-this.top)}}),tm.ui.Sketch.prototype.accessor("penColor",{get:function(){return this._penColor
},set:function(t){this._penColor=t,this.canvas.strokeStyle=t}}),tm.ui.Sketch.prototype.accessor("bgColor",{get:function(){return this._bgColor},set:function(t){this._bgColor=t,this.clear()}}),tm.ui.Sketch.prototype.accessor("lineWidth",{get:function(){return this._lineWidth},set:function(t){this._lineWidth=t,this.canvas.lineWidth=t}})}(),function(){tm.ui.Gauge=tm.createClass({superClass:tm.display.CanvasElement,animationFlag:!0,animationTime:1e4,init:function(t){this.superInit(),t=t||{},t.$safe({width:300,height:25,color:"hsl(220, 100%, 50%)",bgColor:"#444",borderColor:"white",borderWidth:4}),this.$extend(t),this._reset()},isFull:function(){return this._value===this._maxValue},isEmpty:function(){return 0==this._value},_reset:function(){this.originX=0,this._value=100,this._value=this._maxValue=100},setValue:function(t){if(t=Math.clamp(t,0,this._maxValue),this._realValue=t,this._value!==t){if(this.fire(tm.event.Event("change")),this.isAnimation()){this.tweener.clear();var e=Math.abs(this._value-t)/100*this.animationTime;this.tweener.clear().to({_value:t},e).call(function(){this.fire(tm.event.Event("changed")),this.isEmpty()?this.fire(tm.event.Event("empty")):this.isFull()&&this.fire(tm.event.Event("full"))}.bind(this))}else this._value=t,this.fire(tm.event.Event("changed")),this.isEmpty()?this.fire(tm.event.Event("empty")):this.isFull()&&this.fire(tm.event.Event("full"));return this}},getValue:function(){return this.value},setPercent:function(t){return this.setValue(this._maxValue*t*.01)},getPercent:function(){return this._value/this._maxValue*100},setRatio:function(){return this.setValue(this._maxValue*percent)},getRatio:function(){return this._value/this._maxValue},isAnimation:function(){return this.animationFlag},draw:function(t){t.save(),t.fillStyle=this.bgColor,t.fillRect(0,0,this.width,this.height),t.fillStyle=this.color,t.fillRect(0,0,this.width*this.getRatio(),this.height),t.strokeStyle=this.borderColor,t.lineWidth=this.borderWidth,t.strokeRect(0,0,this.width,this.height),t.restore()}}),tm.ui.Gauge.prototype.accessor("value",{get:function(){return this._value},set:function(t){this.setValue(t)}}),tm.ui.Gauge.prototype.accessor("percent",{get:function(){return this.getPercent()},set:function(t){this.setPercent(t)}}),tm.ui.Gauge.prototype.accessor("ratio",{get:function(){return this.getRatio()},set:function(t){this.setRatio(t)}})}(),function(){tm.define("tm.ui.FlatGauge",{superClass:"tm.ui.Gauge",init:function(t){this.superInit(t)},draw:function(t){t.save(),t.save(),t.roundRect(0,0,this.width,this.height,this.height/2),t.clip(),t.fillStyle=this.bgColor,t.fillRect(0,0,this.width,this.height),t.fillStyle=this.color,t.fillRect(0,0,this.width*this.getRatio(),this.height),t.restore(),t.strokeStyle=this.borderColor,t.lineWidth=this.borderWidth,t.strokeRoundRect(0,0,this.width,this.height,this.height/2),t.restore()}})}(),function(){tm.define("tm.ui.GlossyGauge",{superClass:"tm.ui.Gauge",init:function(t){t=t||{},t.borderWidth=t.borderWidth||2,this.superInit(t)},draw:function(t){t.save(),t.roundRect(0,0,this.width,this.height,this.height/2),t.clip(),t.fillStyle=this.bgColor,t.fillRect(0,0,this.width,this.height),t.fillStyle=this.color,t.fillRect(0,0,this.width*this.getRatio(),this.height);var e=tm.graphics.LinearGradient(0,0,0,this.height);e.addColorStop(0,"rgba(255,255,255,0.9)"),e.addColorStop(.5,"rgba(255,255,255,0.5)"),e.addColorStop(.51,"rgba(255,255,255,0.2)"),e.addColorStop(1,"rgba(255,255,255,0.0)"),t.setGradient(e),t.fillRect(0,0,this.width*this.getRatio(),this.height),t.restore(),t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.strokeRoundRect(0,0,this.width,this.height,this.height/2)}})}(),function(){tm.define("tm.ui.LabelArea",{superClass:"tm.display.Shape",init:function(t){t=t||{},this.superInit(t.width||150,t.height||60),this.canvas.clearColor("red"),this.$extend({mode:t.mode||"horizon",_fillStyle:t.fillStyle||"#aaa",_bgColor:t.bgColor||"transparent",_fontSize:t.fontSize||24,_fontFamily:t.fontFamily||"'Consolas', 'Monaco', 'ＭＳ ゴシック'",_fontWeight:t.fontWeight||"",lineSpace:t.lineSpace||1}),this._updateFont(),this.setText(t.text||"こんにちは,世界!")},setText:function(t){this._text!==t&&(this._text=t,this._renderText())},_renderText:function(){this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.clearColor(this.bgColor),this.canvas.font=this.fontStyle,this.canvas.fillStyle=this.fillStyle,this.canvas.fillLabelArea({text:this._text,x:0,y:0,width:this.width,height:this.height,mode:this.mode,lineSpace:this.lineSpace})},_updateFont:function(){this.fontStyle="{fontWeight} {fontSize}px {fontFamily}".format(this),this.text&&this._renderText()}}),tm.ui.LabelArea.prototype.accessor("text",{get:function(){return this._text},set:function(t){this.setText(t)}}),tm.ui.LabelArea.prototype.accessor("fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize=t,this._updateFont()}}),tm.ui.LabelArea.prototype.accessor("fontFamily",{get:function(){return this._fontFamily},set:function(t){this._fontFamily=t,this._updateFont()}}),tm.ui.LabelArea.prototype.accessor("fontWeight",{get:function(){return this._fontWeight},set:function(t){this._fontWeight=t,this._updateFont()}}),tm.ui.LabelArea.prototype.accessor("fillStyle",{get:function(){return this._fillStyle},set:function(t){this._fillStyle=t,this._updateFont()}}),tm.ui.LabelArea.prototype.accessor("bgColor",{get:function(){return this._bgColor},set:function(t){this._bgColor=t,this._updateFont()}}),tm.ui.LabelArea.prototype.accessor("width",{get:function(){return this._width},set:function(t){this._width=t,this.text&&this._renderText()}}),tm.ui.LabelArea.prototype.accessor("height",{get:function(){return this._height},set:function(t){this._height=t,this.text&&this._renderText()}})}(),function(){tm.define("tm.scene.TitleScene",{superClass:"tm.app.Scene",init:function(t){this.superInit(),t={}.$extend(tm.scene.TitleScene["default"],t),this.param=t,this.fromJSON({children:{bg:{type:"tm.display.RectangleShape",init:{width:t.width,height:t.height,fillStyle:t.bgColor,strokeStyle:"transparent"},originX:0,originY:0}}}),t.bgImage&&this.fromJSON({children:{bgImage:{type:"tm.display.Sprite",init:[t.bgImage],originX:0,originY:0}}}),this.fromJSON({children:{titleLabel:{type:"Label",name:"titleLabel",text:t.title,x:this._toGridX(6),y:this._toGridY(3),fillStyle:t.fontColor,fontSize:t.fontSize,fontFamily:"'Helvetica-Light' 'Meiryo' sans-serif",align:"center",baseline:"middle"},messageLabel:{type:"Label",name:"nextLabel",text:t.message||"",x:this._toGridX(6),y:this._toGridY(6),fillStyle:t.fontColor,fontSize:.36*t.fontSize,fontFamily:"'Helvetica-Light' 'Meiryo' sans-serif",align:"center",baseline:"middle"},touchLabel:{type:"Label",name:"nextLabel",text:"TOUCH START",x:this._toGridX(6),y:this._toGridY(9),fillStyle:t.fontColor,fontSize:.4*t.fontSize,fontFamily:"'Helvetica-Light' 'Meiryo' sans-serif",align:"center",baseline:"middle"}}}),this.touchLabel.tweener.fadeOut(500).fadeIn(1e3).setLoop(!0),this.autopop=t.autopop},_toGridX:function(t){return this.param.width/12*t},_toGridY:function(t){return this.param.height/12*t},onpointingstart:function(){this.flare("finish"),this.autopop&&this.app.popScene()}}),tm.scene.TitleScene["default"]={title:"Time is money",message:"",fontSize:72,fontColor:"#444",width:640,height:960,bgColor:"rgb(240,240,240)",bgImage:null,autopop:!0}}(),function(){tm.define("tm.scene.ResultScene",{superClass:"tm.app.Scene",init:function(t){this.superInit(),t={}.$extend(tm.scene.ResultScene["default"],t),this.param=t;var e=this._getUserData(),i=e.bestScore?e.bestScore:0,n=t.score>i;t.record&&n&&(e.bestScore=t.score,this._record(e)),this.fromJSON({children:{bg:{type:"tm.display.RectangleShape",init:{width:t.width,height:t.height,fillStyle:t.bgColor,strokeStyle:"transparent"},originX:0,originY:0}}}),t.bgImage&&this.fromJSON({children:{bgImage:{type:"tm.display.Sprite",init:[t.bgImage],originX:0,originY:0}}});var s={type:"Label",fillStyle:t.fontColor,fontFamily:"'Helvetica-Light' 'Meiryo' sans-serif"};this.fromJSON({children:{scoreText:s.$extend({text:"score",x:this._toGridX(4),y:this._toGridY(3),fontSize:.5*t.fontSize}),scoreLabel:{type:"Label",text:t.score,x:this._toGridX(4),y:this._toGridY(4),fillStyle:t.fontColor,fontSize:t.fontSize,fontFamily:"'Helvetica-Light' 'Meiryo' sans-serif"},bestText:{type:"Label",text:"best",x:this._toGridX(8),y:this._toGridY(3),fillStyle:t.fontColor,fontSize:.5*t.fontSize,fontFamily:"'Helvetica-Light' 'Meiryo' sans-serif"},bestLabel:{type:"Label",text:i,x:this._toGridX(8),y:this._toGridY(4),fillStyle:t.fontColor,fontSize:t.fontSize,fontFamily:"'Helvetica-Light' 'Meiryo' sans-serif"},newRecordText:{type:"Label",text:"new record!",x:this._toGridX(6),y:this._toGridY(6),fillStyle:t.fontColor,fontSize:.5*t.fontSize,fontFamily:"'Helvetica-Light' 'Meiryo' sans-serif",visible:!1},messageText:{type:"Label",text:t.message,x:this._toGridX(6),y:this._toGridY(7),fillStyle:t.fontColor,fontSize:.5*t.fontSize,fontFamily:"'Helvetica-Light' 'Meiryo' sans-serif"},shareButton:{type:"FlatButton",init:{text:"Share",width:200,fillStyle:"hsl(240, 100%, 64%)"},x:this._toGridX(4),y:this._toGridY(9)},backButton:{type:"FlatButton",init:{text:"Back",width:200,fillStyle:"hsl(240, 80%, 0%)"},x:this._toGridX(8),y:this._toGridY(9)}}});var o="SCORE: {score}, {message}".format(t),a=tm.social.Twitter.createURL({type:"tweet",text:o,hashtags:t.hashtags,url:t.url});this.shareButton.onclick=function(){window.open(a,"share window","width=400, height=300")},this.backButton.onpointingstart=this._back.bind(this),this.autopop=t.autopop,n&&(this.newRecordText.show(),this.newRecordText.tweener.set({alpha:0}).fadeIn(2e3).setLoop(!0))},_getUserData:function(){var t=location.pathname.toCRC32(),e=localStorage.getItem(t);return e?JSON.parse(e):{}},_record:function(t){var e=location.pathname.toCRC32(),i=JSON.stringify(t);return localStorage.setItem(e,i),this},_toGridX:function(t){return this.param.width/12*t},_toGridY:function(t){return this.param.height/12*t},_back:function(){this.flare("finish"),this.autopop&&this.app.popScene()}}),tm.scene.ResultScene["default"]={score:256,message:"this is tmlib.js project.",hashtags:"tmlibjs,game",related:"tmlib.js tmlife javascript",url:"http://phi-jp.github.io/tmlib.js/",width:640,height:960,fontColor:"#444",fontSize:90,bgColor:"rgba(255,255,255, 0.9)",bgImage:null,record:!0,autopop:!0}}(),function(){var t={width:465,height:465,bgColor:"transparent"};tm.define("tm.scene.LoadingScene",{superClass:"tm.app.Scene",init:function(e){this.superInit(),this.param=e={}.$extend(t,e),this.fromJSON({children:{stage:{type:"tm.display.CanvasElement"}}}),this.stage.fromJSON({children:{bg:{type:"tm.display.Shape",init:{width:e.width,height:e.height},originX:0,originY:0},piyoLayer:{type:"tm.display.CanvasElement"},label:{type:"tm.display.Label",text:"LOADING",x:e.width/2,y:e.height/2-20,align:"center",baseline:"middle",fontSize:46,shadowBlur:4,shadowColor:"hsl(190, 100%, 50%)"},bar:{type:"tm.ui.Gauge",init:[{width:e.width,height:10,color:"hsl(200, 100%, 80%)",bgColor:"transparent",borderColor:"transparent",borderWidth:0}],x:0,y:0}}});var i=this.stage.bg;i.canvas.clearColor(e.bgColor);var n=this.stage.label;n.tweener.to({alpha:1},1e3).to({alpha:.5},1e3).setLoop(!0);var s=this.stage.bar;s.animationFlag=!1,s.value=0,s.animationFlag=!0,s.animationTime=100,this._createHiyoko(e).addChildTo(this.stage.piyoLayer);var o=this.stage;o.alpha=0,o.tweener.clear().fadeIn(100).call(function(){if(e.assets){var t=tm.asset.Loader();t.onload=function(){o.tweener.clear().wait(200).fadeOut(200).call(function(){e.nextScene&&this.app.replaceScene(e.nextScene());var t=tm.event.Event("load");this.fire(t),1==e.autopop&&this.app.popScene()}.bind(this))}.bind(this),t.onprogress=function(t){s.value=100*t.progress;var e=tm.event.Event("progress");e.progress=t.progress,this.fire(e)}.bind(this),t.load(e.assets)}}.bind(this))},onpointingstart:function(t){var e=t.pointing,i=this._createHiyoko(this.param).addChildTo(this.stage.piyoLayer);i.x=e.x,i.y=e.y},_createHiyoko:function(t){var e=tm.display.Shape({width:84,height:84});e.x=tm.util.Random.randint(0,t.width),e.y=tm.util.Random.randint(0,t.height),e.canvas.setColorStyle("white","yellow").fillCircle(42,42,32),e.canvas.setColorStyle("white","black").fillCircle(27,27,2),e.canvas.setColorStyle("white","brown").fillRect(40,70,4,15).fillTriangle(0,40,11,35,11,45),e.dir=tm.geom.Vector2.random(0,360,4);var i=tm.geom.Rect(0,0,t.width,t.height);return i.padding(42),e.update=function(){this.position.add(this.dir),this.x<i.left?(this.x=i.left,this.dir.x*=-1):this.x>i.right&&(this.x=i.right,this.dir.x*=-1),this.y<i.top?(this.y=i.top,this.dir.y*=-1):this.y>i.bottom&&(this.y=i.bottom,this.dir.y*=-1),this.dir.x<0?(this.rotation-=7,this.scaleX=1):(this.rotation+=7,this.scaleX=-1)},e}})}(),function(){tm.define("tm.scene.ManagerScene",{superClass:"tm.app.Scene",init:function(t){this.superInit(),this.setScenes(t.scenes),this.on("enter",function(){this.gotoScene(t.startLabel||0)}.bind(this)),this.on("resume",this.onnext.bind(this)),this.commonArguments={}},setScenes:function(t){return this.scenes=t,this.sceneIndex=0,this},gotoScene:function(t,e){t="string"==typeof t?this.labelToIndex(t):t||0;var i=tm.event.Event("prepare");this.fire(i);var n=this.scenes[t],s=tm.using(n.className),o=n.arguments,o={}.$extend(o,e),a=s.call(null,o);a.nextLabel||(a.nextLabel=n.nextLabel),a.nextArguments||(a.nextArguments=n.nextArguments),this.app.pushScene(a),this.sceneIndex=t,this.currentScene=a;var i=tm.event.Event("goto");return i.scene=a,this.fire(i),this},gotoNext:function(t){var e=this.scenes[this.sceneIndex],i=null;return e.nextLabel?i=this.labelToIndex(e.nextLabel):this.sceneIndex+1<this.scenes.length&&(i=this.sceneIndex+1),null!==i?this.gotoScene(i,t):this.fire(tm.event.Event("finish")),this},getCurrentIndex:function(){return this.sceneIndex},getCurrentLabel:function(){return this.scenes[this.sceneIndex].label},labelToIndex:function(t){var e=this.scenes.filter(function(e){return e.label==t})[0];return this.scenes.indexOf(e)},indexToLabel:function(t){return this.scenes[t].label},onnext:function(t){var e=t.prevScene.nextLabel,i=t.prevScene.nextArguments;e?this.gotoScene(e,i):this.gotoNext(i)}})}(),function(){tm.define("tm.scene.NumericalInputScene",{superClass:"tm.app.Scene",init:function(){this.superInit(),this.fromJSON({children:{inputLabel:{type:"tm.display.Label",fillStyle:"white",text:"",fontSize:64,x:320,y:120},buttonGroup:{type:"tm.display.CanvasElement"}}}),[1,2,3,4,5,6,7,8,9,"C",0,"OK"].each(function(t,e){var i=this._createButton(t.toString()).addChildTo(this.buttonGroup),n=e%3,s=e/3|0;i.x=190*n+130,i.y=177*s+280},this);var t=this,e=this.buttonGroup.children;e.each(function(e){e.setInteractive(!0).setBoundingType("circle"),e.radius=72.5,e.onpointingstart=function(){if("OK"==this.label.text){var e=tm.event.Event("decided");e.value=Number(t.inputLabel.text),t.fire(e)}else if("C"==this.label.text){var e=tm.event.Event("push");t.inputLabel.text="",t.flare("clear")}else t.inputLabel.text+=this.label.text,t.flare("push",{select:this.label.text})}})},_createButton:function(t){var e=tm.display.CanvasElement();return e.fromJSON({children:{bg:{type:"tm.display.CircleShape",init:[145,145,{fillStyle:"transparent",strokeStyle:"white"}]},label:{type:"tm.display.Label",text:t,fontSize:64,fillStyle:"white"}}}),e}})}(),tm.three=tm.three||{},function(){tm.global.THREE&&(tm.three.ThreeApp=tm.createClass({superClass:tm.app.BaseApp,canvas:null,background:null,_scenes:null,_sceneIndex:0,init:function(t){t instanceof HTMLCanvasElement?this.element=t:"string"==typeof t?this.element=document.querySelector(t):(this.element=document.createElement("canvas"),document.body.appendChild(this.element)),this.superInit(this.element),this.renderer=new THREE.WebGLRenderer({canvas:this.element,clearColor:2236962,clearAlpha:1}),this.renderer.setSize(this.element.width,this.element.height),this._scenes=[tm.three.Scene()]},resize:function(t,e){return this.width=t,this.height=e,this.renderer.setSize(this.width,this.height),this},resizeWindow:function(){return this.width=innerWidth,this.height=innerHeight,this.renderer.setSize(this.width,this.height),this},fitWindow:function(t){var e=function(){t=void 0===t?!0:t;var e=this.element,i=e.style;i.position="absolute",i.left="0px",i.top="0px";var n=e.width/window.innerWidth,s=e.height/window.innerHeight,o=e.height/e.width;n>s?(i.width=innerWidth+"px",i.height=innerWidth*o+"px"):(i.width=innerHeight/o+"px",i.height=innerHeight+"px")}.bind(this);e(),t&&window.addEventListener("resize",e,!1),this.mouse._mousemove=this.mouse._mousemoveScale,this.touch._touchmove=this.touch._touchmoveScale},_draw:function(){for(var t=0,e=this._scenes.length;e>t;++t)this.renderer.render(this.currentScene,this.currentScene.camera)}}),tm.three.ThreeApp.prototype.accessor("width",{get:function(){return this.element.width},set:function(t){this.element.width=t}}),tm.three.ThreeApp.prototype.accessor("height",{get:function(){return this.element.height},set:function(t){this.element.height=t}}))}(),function(){tm.global.THREE&&(tm.three.Element=tm.createClass({superClass:THREE.Object3D,init:function(){THREE.Object3D.call(this),tm.event.EventDispatcher.prototype.init.call(this)},update:function(){},_update:function(t){if(0!=this.awake){this.update(t);var e=tm.event.Event("enterframe");if(e.app=t,this.dispatchEvent(e),this.children.length>0)for(var i=this.children.slice(),n=0,s=i.length;s>n;++n){var o=i[n];o._update&&o._update(t)}}}}),tm.three.Element.prototype.$safe(tm.event.EventDispatcher.prototype))}(),function(){tm.global.THREE&&(tm.three.MeshElement=tm.createClass({superClass:THREE.Mesh,init:function(t,e){e=e||new THREE.MeshNormalMaterial,THREE.Mesh.call(this,t,e),tm.three.Element.prototype.init.call(this)}}),tm.three.MeshElement.prototype.$safe(tm.three.Element.prototype),tm.three.CubeElement=tm.createClass({superClass:tm.three.MeshElement,init:function(t,e,i){t=t||100,e=e||100,i=i||100;var n=new THREE.CubeGeometry(t,e,i),s=new THREE.MeshNormalMaterial;this.superInit(n,s)}}),tm.three.SphereElement=tm.createClass({superClass:tm.three.MeshElement,init:function(t,e,i){t=t||45,e=e||16,i=i||12;var n=new THREE.SphereGeometry(t,e,i),s=new THREE.MeshNormalMaterial;this.superInit(n,s)}}),tm.three.PlaneElement=tm.createClass({superClass:tm.three.MeshElement,init:function(t,e){var i=new THREE.PlaneGeometry(t,e),n=new THREE.MeshNormalMaterial;this.superInit(i,n)}}),tm.three.FloorElement=tm.createClass({superClass:tm.three.MeshElement,init:function(t,e){t=t||1e3,e=e||1e3;var i=new THREE.PlaneGeometry(t,e),n=new THREE.MeshBasicMaterial;this.superInit(i,n),this.rotation.x=-Math.PI/2,this._render()},_render:function(){var t=tm.graphics.Canvas();t.resize(128,128),t.clearColor("#444"),t.setFillStyle("white"),t.fillRect(0,0,64,64),t.fillRect(64,64,64,64);var e=new THREE.Texture(t.element);e.wrapS=e.wrapT=THREE.RepeatWrapping,e.repeat.set(10,10),e.needsUpdate=!0,this.material.map=e}}),tm.three.TextElement=tm.createClass({superClass:tm.three.MeshElement,init:function(t,e){var i=new THREE.TextGeometry(t,e),n=new THREE.MeshNormalMaterial;this.superInit(i,n)}}),tm.three.CanvasTexture=tm.createClass({superClass:THREE.Texture,canvas:null,init:function(){this.canvas=tm.graphics.Canvas(),THREE.Texture.call(this,this.canvas.element),this.needsUpdate=!0}}))}(),function(){tm.global.THREE&&(tm.three.Scene=tm.createClass({superClass:THREE.Scene,init:function(t,e){t=t||60,e=e||640/480,THREE.Scene.call(this),tm.three.Element.prototype.init.call(this),this.camera=new THREE.PerspectiveCamera(t,e,1,1e4),this.camera.position.y=100,this.camera.position.z=500,this.projector=new THREE.Projector},intersect:function(t){t=t||this.children;var e=this.app.pointing.x,i=this.app.pointing.y;e=e/this.app.width*2-1,i=2*-(i/this.app.height)+1;var n=new THREE.Vector3(e,i,.5);this.projector.unprojectVector(n,this.camera);var s=new THREE.Raycaster(this.camera.position,n.sub(this.camera.position).normalize());return s.intersectObjects(t)}}),tm.three.Scene.prototype.$safe(tm.three.Element.prototype))}(),tm.sound=tm.sound||{},function(){tm.sound.globalVolume=1}(),function(){if(tm.sound.Sound=tm.createClass({superClass:tm.event.EventDispatcher,element:null,loaded:!1,isPlay:!1,init:function(t){this.superInit(),this.element=new Audio,this.element.src=t,this.element.load(),this.element.setAttribute("preload","auto");var e=this;this.element.addEventListener("canplaythrough",function(){e.loaded=!0,e.fire(tm.event.Event("load"))}),this.element.addEventListener("ended",function(){e.isPlay=!1}),this.element.addEventListener("error",function(){console.warn(this.src+"の読み込みに失敗しました")}),this.element.volume=1,tm.isMobile&&(this.loaded=!0)},play:function(){return this.element.play(),this.isPlay=!0,this},stop:function(){return this.element.pause(),tm.isMobile||(this.element.currentTime=0),this.isPlay=!1,this},pause:function(){return this.element.pause(),this},clone:function(){return tm.sound.Sound(this.element.src)}}),tm.sound.Sound.prototype.accessor("volume",{get:function(){return this.element.volume},set:function(t){this.element.volume=t}}),void 0!==(new Audio).loop)tm.sound.Sound.prototype.accessor("loop",{get:function(){return this.element.loop},set:function(t){this.element.loop=t}});else{var t=function(){this.play()};tm.sound.Sound.prototype.accessor("loop",{get:function(){return this.element.loop},set:function(e){1!=this.element.loop&&1==e?this.element.addEventListener("ended",t,!1):1==this.element.loop&&0==e&&this.element.removeEventListener("ended",t,!1),this.element.loop=e}})}tm.sound.Sound.SUPPORT_EXT=function(){var t="",e=new Audio;return"maybe"==e.canPlayType("audio/wav")?t="wav":"maybe"==e.canPlayType("audio/mp3")?t="mp3":"maybe"==e.canPlayType("audio/ogg")&&(t="ogg"),t}()}(),function(){var t=tm.isMobile?1:4;tm.sound.SoundManager={sounds:{}},tm.sound.SoundManager.add=function(e,i,n){n=n||t,-1==i.split("/").at(-1).indexOf(".")&&(i+="."+tm.sound.Sound.SUPPORT_EXT);for(var s=this.sounds[e]=[],o=0;n>o;++o){var a=tm.sound.Sound(i);s.push(a)}return this},tm.sound.SoundManager.get=function(t){for(var e=this.sounds[t],i=0,n=e.length;n>i;++i)if(0==e[i].isPlay)return e[i];return e[0]},tm.sound.SoundManager.getByIndex=function(t,e){return this.sounds[t][e]},tm.sound.SoundManager.remove=function(){return this},tm.sound.SoundManager.setVolume=function(){return this},tm.sound.SoundManager.isLoaded=function(){for(var t in this.sounds)for(var e=this.sounds[t],i=0,n=e.length;n>i;++i)if(0==e[i].loaded)return!1;return!0},tm.addLoadCheckList(tm.sound.SoundManager)}(),tm.sound=tm.sound||{},function(){var t=null;tm.sound.WebAudio=tm.createClass({superClass:tm.event.EventDispatcher,loaded:!1,context:null,panner:null,volume:.8,playing:!1,_pannerEnabled:!0,init:function(e){this.superInit(),this.context=t;var i=typeof e;"string"===i?(this.loaded=!1,this._load(e)):"object"===i?(this._setup(),this.buffer=e,this.loaded=!0,this.dispatchEvent(tm.event.Event("load"))):(this._setup(),this.loaded=!1)},play:function(t){if(1!=this.playing){this.playing=!0,void 0===t&&(t=0),this.source.start(this.context.currentTime+t);var e=this,t=this.source.buffer.duration/this.source.playbackRate.value*1e3;return window.setTimeout(function(){var t=tm.event.Event("ended");e.fire(t)},t),this}},stop:function(t){if(0!=this.playing&&(this.playing=!1,void 0===t&&(t=0),0!=this.source.playbackState)){this.source.stop(this.context.currentTime+t);var e=this.buffer,i=this.volume,n=this.loop;return this.source=this.context.createBufferSource(),this.source.connect(this.gainNode),this.buffer=e,this.volume=i,this.loop=n,this}},pause:function(){return this.source.disconnect(),this},resume:function(){return this.source.connect(this.gainNode),this},clone:function(){var t=tm.sound.WebAudio(this.buffer);return t.volume=this.volume,t},setPosition:function(t,e,i){return this.panner.setPosition(t,e||0,i||0),this},setVelocity:function(t,e,i){return this.panner.setVelocity(t,e||0,i||0),this},setOrientation:function(t,e,i){return this.panner.setOrientation(t,e||0,i||0),this},setBuffer:function(t){return this.buffer=t,this},setLoop:function(t){return this.loop=t,this},setVolume:function(t){return this.volume=t,this},setPlaybackRate:function(t){return this.playbackRate=t,this},_load:function(e){if(!this.context)return void console.warn("本環境はWebAudio未対応です。("+e+")");var i=this;tm.util.Ajax.load({type:"GET",url:e,responseType:"arraybuffer",success:function(n){i.context.decodeAudioData(n,function(t){i._setup(),i.buffer=t,i.loaded=!0,i.dispatchEvent(tm.event.Event("load"))},function(){console.warn("音声ファイルのデコードに失敗しました。("+e+")"),i._setup(),i.buffer=t.createBuffer(1,1,22050),i.loaded=!0,i.dispatchEvent(tm.event.Event("load"))})}})},_setup:function(){this.source=this.context.createBufferSource(),this.gainNode=this.context.createGain(),this.panner=this.context.createPanner(),this.analyser=this.context.createAnalyser(),this.source.connect(this.gainNode),this.gainNode.connect(this.panner),this.panner.connect(this.analyser),this.analyser.connect(this.context.destination),"Firefox"===tm.BROWSER&&(this.pannerEnabled=!1)},tone:function(t,e){t=void 0!==t?t:200,e=void 0!==e?e:1;for(var i=1,n=44100,s=2,o=this.context.createBuffer(i,e*n,n),a=o.getChannelData(0),r=0;r<a.length;r++){var h=r/o.sampleRate,l=t*h*Math.PI;a[r]=Math.sin(l)*s}return this.buffer=o,this}}),tm.sound.WebAudio.prototype.accessor("buffer",{get:function(){return this.source.buffer},set:function(t){this.source.buffer=t}}),tm.sound.WebAudio.prototype.accessor("loop",{get:function(){return this.source.loop},set:function(t){this.source.loop=t}}),tm.sound.WebAudio.prototype.accessor("volume",{get:function(){return this.gainNode.gain.value},set:function(t){this.gainNode.gain.value=t}}),tm.sound.WebAudio.prototype.accessor("playbackRate",{get:function(){return this.source.playbackRate.value},set:function(t){this.source.playbackRate.value=t}}),tm.sound.WebAudio.prototype.accessor("pannerEnabled",{get:function(){return this._pannerEnabled},set:function(t){this.gainNode.disconnect(),this.panner.disconnect(),t?(this.gainNode.connect(this.panner),this.panner.connect(this.analyser)):this.gainNode.connect(this.analyser),this._pannerEnabled=t}}),tm.sound.WebAudio.prototype.accessor("loopStart",{get:function(){return this.source.loopStart},set:function(t){this.source.loopStart=t}}),tm.sound.WebAudio.prototype.accessor("loopEnd",{get:function(){return this.source.loopEnd},set:function(t){this.source.loopEnd=t}}),tm.sound.WebAudio.isAvailable=tm.global.webkitAudioContext||tm.global.mozAudioContext||tm.global.AudioContext?!0:!1,tm.sound.WebAudio.createContext=function(){tm.global.webkitAudioContext?t=new webkitAudioContext:tm.global.mozAudioContext?t=new mozAudioContext:tm.global.AudioContext&&(t=new AudioContext),tm.sound.WebAudio.context=t},tm.sound.WebAudio.unlock=function(){var e=t.createBuffer(1,1,22050),i=t.createBufferSource();i.buffer=e,i.connect(t.destination),i.start(0)},tm.sound.WebAudio.createContext()}(),tm.social=tm.social||{},function(){tm.social.Twitter=tm.social.Twitter||{},tm.social.Twitter.API_URL="http://api.twitter.com/1";var t="http://twitter.com/intent";tm.social.Twitter.createURL=function(e){var i=[];for(var n in e)if("type"!=n){var s=encodeURIComponent(e[n]),o=n+"="+s;i.push(o)}var a="{baseURL}/{type}?{param}".format({baseURL:t,type:e.type,param:i.join("&")});return a}}(),function(){var t="http://api.twitter.com/1/{type}/{kind}.json";tm.social.Twitter.api=function(e,i,n,s){var o=t.format({type:e,kind:i}),a=tm.util.QueryString.stringify(n);tm.util.Ajax.loadJSONP(o+"?"+a,s)}}(),function(){var t="http://search.twitter.com/search.json";tm.social.Twitter.search=function(e,i){var n=t,s=tm.util.QueryString.stringify(e);tm.util.Ajax.loadJSONP(n+"?"+s,i)}}(),function(){tm.social.Twitter.getFollowers=function(t,e){tm.social.Twitter.api("statuses","followers",t,e)}}(),tm.social=tm.social||{},function(){tm.social.Nineleap=tm.social.Nineleap||{};var t="http://9leap.net/games/{id}/result?score={score}&result={result}";tm.social.Nineleap.DEBUG_GAME_ID="0",tm.social.Nineleap.createURL=function(e,i,n){return t.format({id:e,score:i,result:n})},tm.social.Nineleap.postRanking=function(t,e){if("r.jsgames.jp"==location.hostname){var i=location.pathname.match(/^\/games\/(\d+)/)[1];location.replace(this.createURL(i,t,e))}else console.warn("9leap に投稿されていません!")},tm.social.Nineleap.gotoLogin=function(){window.location.replace("http://9leap.net/api/login")},tm.social.Nineleap.isOn9leap=function(){return"r.jsgames.jp"===window.location.hostname},tm.social.Nineleap.getGameId=function(){return tm.social.Nineleap.isOn9leap()?window.location.pathname.match(/^\/games\/(\d+)/)[1]:tm.social.Nineleap.DEBUG_GAME_ID},tm.social.Nineleap.getMyData=function(t){tm.util.Ajax.loadJSONP(tm.social.Nineleap.createMyDataURL(),t)},tm.social.Nineleap.postMyData=function(t,e){tm.util.Ajax.load({type:"POST",url:tm.social.Nineleap.createMemoryURL("user_memory.json"),dataType:"json",data:"json="+JSON.stringify(t),contentType:"application/x-www-form-urlencoded;charset=UTF-8",async:!1,beforeSend:function(t){t.withCredentials=!0},success:e,error:function(t){console.error(t)}})},tm.social.Nineleap.createMemoryURL=function(){for(var t=["http://9leap.net/api/memory/",tm.social.Nineleap.getGameId()+"/"],e=0,i=arguments.length;i>e;e++)t.push(arguments[e]);return t.join("")},tm.social.Nineleap.createMyDataURL=function(){return tm.social.Nineleap.createMemoryURL("user_memory.json")},tm.social.Nineleap.createUserDataURL=function(t){return tm.social.Nineleap.createMemoryURL("u/",t+".json")},tm.social.Nineleap.createRecentDataURL=function(t){return t=t||30,tm.social.Nineleap.createMemoryURL("recent_memories.json","?max="+t)},tm.social.Nineleap.createFriendDataURL=function(t){return t=t||30,tm.social.Nineleap.createMemoryURL("friends_memories.json","?max="+t)},tm.social.Nineleap.createRankingDataURL=function(t){return t=t||30,tm.social.Nineleap.createMemoryURL("ranking_memories.json","?max="+t)}}(),tm.google=tm.google||{},function(){tm.google.Chart=tm.google.Chart||{};var t="https://chart.googleapis.com/chart?chst={type}&chld={data}",e="https://chart.googleapis.com/chart?chs={size}&cht={type}&chl={text}&chco={color}";tm.google.Chart.createDynamicIcons=function(e,i){return t.format({type:e,data:i})},tm.google.Chart.createQRCode=function(t,i){return i=encodeURIComponent(i),e.format({type:"qr",size:t,text:i})},tm.google.Chart.createTeX=function(){}}(),function(){tm.app.Element.prototype.getter("interaction",function(){console.assert(!1,"interaction は Object2d に統合されました. obj.setInteractive(true); とすればタッチ判定が有効になります.")});var t={display:["Sprite","Shape","CircleShape","TriangleShape","RectangleShape","RoundRectangleShape","StarShape","PolygonShape","HeartShape","TextShape","CanvasRenderer","BoundingRectRenderer","Label","MapSprite","CanvasElement","CanvasApp","AnimationSprite","SpriteSheet"],ui:["LabelButton","IconButton","GlossyButton","FlatButton","LoadingScene"]};for(var e in t){var i=t[e];i.each(function(t){tm.app[t]=tm[e][t]})}tm.asset.AssetManager=tm.asset.Manager,tm.ui.LoadingScene=tm.scene.LoadingScene}();var bulletml={};bulletml.GLOBAL=this,function(){function t(t,e){for(var i=0,n=t.length;n>i;i++)if(t[i].label==e)return t[i]}bulletml.Node=function(){},bulletml.Node.prototype.scan=function(t){t(this);for(var e in this)if(this.hasOwnProperty(e)){var i=this[e];i instanceof bulletml.Node&&i.scan(t)}},bulletml.Root=function(t){if(bulletml.Node.call(this),this.type="none",this.root=this,this.actions=[],this.bullets=[],this.fires=[],void 0!==t){for(var e in t)t.hasOwnProperty(e)&&(t[e].label=e,t[e]instanceof bulletml.Action?this.actions.push(t[e]):t[e]instanceof bulletml.Bullet?this.bullets.push(t[e]):t[e]instanceof bulletml.Fire&&this.fires.push(t[e]));for(var i=0,n=this.actions.length;n>i;i++)this.actions[i].setRoot(this);for(var i=0,n=this.bullets.length;n>i;i++)this.bullets[i].setRoot(this);for(var i=0,n=this.fires.length;n>i;i++)this.fires[i].setRoot(this)}},bulletml.Root.prototype=Object.create(bulletml.Node.prototype),bulletml.Root.prototype.findAction=function(e){return t(this.actions,e)
},bulletml.Root.prototype.getTopActionLabels=function(){for(var t=[],e=0,i=this.actions.length;i>e;e++){var n=this.actions[e];n.label&&0===n.label.indexOf("top")&&(t[t.length]=n.label)}return t},bulletml.Root.prototype.findActionOrThrow=function(t){var e;if(e=this.findAction(t))return e;throw new Error("action labeled '"+t+"' is undefined.")},bulletml.Root.prototype.findBullet=function(e){return t(this.bullets,e)},bulletml.Root.prototype.findBulletOrThrow=function(t){var e;if(e=this.findBullet(t))return e;throw new Error("bullet labeled '"+t+"' is undefined.")},bulletml.Root.prototype.findFire=function(e){return t(this.fires,e)},bulletml.Root.prototype.findFireOrThrow=function(t){var e;if(e=this.findFire(t))return e;throw new Error("fire labeled '"+t+"' is undefined.")},bulletml.Bullet=function(){bulletml.Node.call(this),this.label=null,this.root=null,this.direction=new bulletml.Direction(0),this.speed=new bulletml.Speed(1),this.actions=[],this.option={},this._localScope={}},bulletml.Bullet.prototype=Object.create(bulletml.Node.prototype),bulletml.Bullet.prototype.clone=function(t){var e=new bulletml.Bullet;return e.label=this.label,e.root=this.root,e.actions=this.actions,e.direction=new bulletml.Direction(t._evalParam(this.direction.value)),e.direction.type=this.direction.type,e.speed=new bulletml.Speed(t._evalParam(this.speed.value)),e.speed.type=this.speed.type,e.option=this.option,e._localScope=t._localScope,e},bulletml.Bullet.prototype.setRoot=function(t){this.root=t;for(var e=0,i=this.actions.length;i>e;e++)this.actions[e].setRoot(t)},bulletml.BulletRef=function(t){bulletml.Node.call(this),this.root=null,this.label=t,this.params=[]},bulletml.BulletRef.prototype=Object.create(bulletml.Node.prototype),bulletml.BulletRef.prototype.clone=function(t){var e=t._localScope;t._localScope=t._newScope(this.params);var i=this.root.findBulletOrThrow(this.label).clone(t);return t._localScope=e,i},bulletml.BulletRef.prototype.setRoot=function(t){this.root=t},bulletml.Command=function(){bulletml.Node.call(this),this.commandName=""},bulletml.Command.prototype=Object.create(bulletml.Node.prototype),bulletml.Command.prototype.setRoot=function(t){this.root=t},bulletml.Action=function(){bulletml.Command.call(this),this.commandName="action",this.label=null,this.root=null,this.commands=[],this.params=[]},bulletml.Action.prototype=Object.create(bulletml.Command.prototype),bulletml.Action.prototype.setRoot=function(t){this.root=t;for(var e=0,i=this.commands.length;i>e;e++)this.commands[e].setRoot(t)},bulletml.Action.prototype.clone=function(){var t=new bulletml.Action;return t.label=this.label,t.root=this.root,t.commands=this.commands,t},bulletml.ActionRef=function(t){bulletml.Command.call(this),this.commandName="actionRef",this.label=t,this.root=null,this.params=[]},bulletml.ActionRef.prototype=Object.create(bulletml.Command.prototype),bulletml.ActionRef.prototype.clone=function(){var t=new bulletml.Action;return t.root=this.root,t.commands.push(this),t},bulletml.Fire=function(){bulletml.Command.call(this),this.commandName="fire",this.label=null,this.root=null,this.direction=null,this.speed=null,this.bullet=null,this.option=new bulletml.FireOption},bulletml.Fire.prototype=Object.create(bulletml.Command.prototype),bulletml.Fire.prototype.setRoot=function(t){this.root=t,this.bullet&&this.bullet.setRoot(t)},bulletml.FireRef=function(t){bulletml.Command.call(this),this.commandName="fireRef",this.label=t,this.params=[]},bulletml.FireRef.prototype=Object.create(bulletml.Command.prototype),bulletml.ChangeDirection=function(){bulletml.Command.call(this),this.commandName="changeDirection",this.direction=new bulletml.Direction,this.term=0},bulletml.ChangeDirection.prototype=Object.create(bulletml.Command.prototype),bulletml.ChangeSpeed=function(){bulletml.Command.call(this),this.commandName="changeSpeed",this.speed=new bulletml.Speed,this.term=0},bulletml.ChangeSpeed.prototype=Object.create(bulletml.Command.prototype),bulletml.Accel=function(){bulletml.Command.call(this),this.commandName="accel",this.horizontal=new bulletml.Horizontal,this.vertical=new bulletml.Vertical,this.term=0},bulletml.Accel.prototype=Object.create(bulletml.Command.prototype),bulletml.Wait=function(t){bulletml.Command.call(this),this.commandName="wait",this.value=t||0},bulletml.Wait.prototype=Object.create(bulletml.Command.prototype),bulletml.Vanish=function(){bulletml.Command.call(this),this.commandName="vanish"},bulletml.Vanish.prototype=Object.create(bulletml.Command.prototype),bulletml.Repeat=function(){bulletml.Command.call(this),this.commandName="repeat",this.times=0,this.action=null,this.params=[]},bulletml.Repeat.prototype=Object.create(bulletml.Command.prototype),bulletml.Repeat.prototype.setRoot=function(t){this.root=t,this.action&&this.action.setRoot(t)},bulletml.Bind=function(t,e){bulletml.Command.call(this),this.commandName="bind",this.variable=t,this.expression=e},bulletml.Bind.prototype=Object.create(bulletml.Command.prototype),bulletml.Notify=function(t,e){bulletml.Command.call(this),this.commandName="notify",this.eventName=t,this.params=e||null},bulletml.Notify.prototype=Object.create(bulletml.Command.prototype),bulletml.DummyCommand=new bulletml.Command,bulletml.Direction=function(t){bulletml.Node.call(this),this.type="aim",this.value=t||0},bulletml.Direction.prototype=Object.create(bulletml.Node.prototype),bulletml.Speed=function(t){bulletml.Node.call(this),this.type="absolute",this.value=void 0===t?1:t},bulletml.Speed.prototype=Object.create(bulletml.Node.prototype),bulletml.Horizontal=function(t){bulletml.Node.call(this),this.type="absolute",this.value=t||0},bulletml.Horizontal.prototype=Object.create(bulletml.Node.prototype),bulletml.Vertical=function(t){bulletml.Node.call(this),this.type="absolute",this.value=t||0},bulletml.Vertical.prototype=Object.create(bulletml.Node.prototype),bulletml.FireOption=function(t){bulletml.Node.call(this),t=t||{},this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.autonomy=!0,void 0!==t.autonomy&&(this.autonomy=!!t.autonomy)},bulletml.FireOption.prototype=Object.create(bulletml.Node.prototype),bulletml.OffsetX=function(t){bulletml.Node.call(this),this.value=t||0},bulletml.OffsetX.prototype=Object.create(bulletml.Node.prototype),bulletml.OffsetY=function(t){bulletml.Node.call(this),this.value=t||0},bulletml.OffsetY.prototype=Object.create(bulletml.Node.prototype),bulletml.Autonomy=function(t){bulletml.Node.call(this),this.value=!!t},bulletml.Autonomy.prototype=Object.create(bulletml.Node.prototype)}(),function(){bulletml.Walker=function(t){this._root=t,this._stack=[],this._cursor=-1,this._action=null,this._localScope={}},bulletml.Walker.prototype.next=function(){if(this._cursor+=1,null!==this._action){var t=this._action.commands[this._cursor];if(void 0!==t){if(t instanceof bulletml.Action)return this._pushStack(),this._action=t,this._localScope=this._cloneScope(),this.next();if(t instanceof bulletml.ActionRef)return this._pushStack(),this._action=this._root.findActionOrThrow(t.label),this._localScope=this._newScope(t.params),this.next();if(t instanceof bulletml.Repeat)return this._localScope.loopCounter=0,this._localScope.loopEnd=0|this._evalParam(t.times),this._pushStack(),this._action=t.action.clone(),this._localScope=this._cloneScope(),this.next();if(t instanceof bulletml.Fire){var e=new bulletml.Fire;return e.bullet=t.bullet.clone(this),null!==t.direction&&(e.direction=new bulletml.Direction(this._evalParam(t.direction.value)),e.direction.type=t.direction.type),null!==t.speed&&(e.speed=new bulletml.Speed(this._evalParam(t.speed.value)),e.speed.type=t.speed.type),e.option=new bulletml.FireOption,e.option.offsetX=this._evalParam(t.option.offsetX),e.option.offsetY=this._evalParam(t.option.offsetY),e.option.autonomy=t.option.autonomy,e}if(t instanceof bulletml.FireRef)return this._pushStack(),this._action=new bulletml.Action,this._action.commands=[this._root.findFireOrThrow(t.label)],this._localScope=this._newScope(t.params),this.next();if(t instanceof bulletml.ChangeDirection){var i=new bulletml.ChangeDirection;return i.direction.type=t.direction.type,i.direction.value=this._evalParam(t.direction.value),i.term=this._evalParam(t.term),i}if(t instanceof bulletml.ChangeSpeed){var n=new bulletml.ChangeSpeed;return n.speed.type=t.speed.type,n.speed.value=this._evalParam(t.speed.value),n.term=this._evalParam(t.term),n}if(t instanceof bulletml.Accel){var s=new bulletml.Accel;return s.horizontal.type=t.horizontal.type,s.horizontal.value=this._evalParam(t.horizontal.value),s.vertical.type=t.vertical.type,s.vertical.value=this._evalParam(t.vertical.value),s.term=this._evalParam(t.term),s}return t instanceof bulletml.Wait?new bulletml.Wait(this._evalParam(t.value)):t instanceof bulletml.Vanish?t:t instanceof bulletml.Bind?(this._localScope["$"+t.variable]=this._evalParam(t.expression),bulletml.DummyCommand):t instanceof bulletml.Notify?t:null}return this._popStack(),null===this._action?null:(t=this._action.commands[this._cursor],t&&"repeat"==t.commandName?(this._localScope.loopCounter++,this._localScope.loopCounter<this._localScope.loopEnd?(this._pushStack(),this._action=t.action.clone(),this._localScope=this._cloneScope(),this.next()):this.next()):this.next())}return null},bulletml.Walker.prototype._pushStack=function(){this._stack.push({action:this._action,cursor:this._cursor,scope:this._localScope}),this._cursor=-1},bulletml.Walker.prototype._popStack=function(){var t=this._stack.pop();t?(this._cursor=t.cursor,this._action=t.action,this._localScope=t.scope):(this._cursor=-1,this._action=null,this._localScope={})},bulletml.Walker.prototype._evalParam=function(t){var e;if("boolean"==typeof t)return t?1:0;if("number"==typeof t)return t;if(!isNaN(e=Number(t)))return e;if(e=this._localScope[t])return e;if(e=bulletml.Walker.globalScope[t])return e;if("$rand"===t)return Math.random();var i={};for(var n in bulletml.Walker.globalScope)bulletml.Walker.globalScope.hasOwnProperty(n)&&(i[n]=bulletml.Walker.globalScope[n]);for(var n in this._localScope)this._localScope.hasOwnProperty(n)&&(i[n]=this._localScope[n]);i.$rand=Math.random();var s=this._stack[this._stack.length-1];s&&(i.$loop={index:s.scope.loopCounter,count:s.scope.loopCounter+1,first:0===s.scope.loopCounter,last:s.scope.loopCounter+1>=s.scope.loopEnd});var o=new Function("return "+t.split("$").join("this.$")),a=o.apply(i);return a},bulletml.Walker.prototype._newScope=function(t){var e={};if(t)for(var i=0,n=t.length;n>i;i++)e["$"+(i+1)]=this._evalParam(t[i]);else for(var s in this._localScope)this._localScope.hasOwnProperty(s)&&(e[s]=this._localScope[s]);return e},bulletml.Walker.prototype._cloneScope=function(){var t={};for(var e in this._localScope)this._localScope.hasOwnProperty(e)&&(t[e]=this._localScope[e]);return t},bulletml.Root.prototype.getWalker=function(t){var e=new bulletml.Walker(this),i=this.findAction(t);return i&&(e._action=i),e},bulletml.Bullet.prototype.getWalker=function(){var t=new bulletml.Walker(this.root),e=new bulletml.Action;return e.root=this.root,e.commands=this.actions,t._action=e,t._localScope=this._localScope,t},bulletml.Walker.globalScope={}}(),function(){function t(t){var i=new bulletml.Root,s=t.getElementsByTagName("bulletml")[0];if(s){x(s,"type",function(t){i.type=t});var a=s.getElementsByTagName("action");if(a)for(var r=0,h=a.length;h>r;r++)if(a[r].parentNode===s){var l=e(i,a[r]);l&&(i.actions[i.actions.length]=l)}var c=s.getElementsByTagName("bullet");if(c)for(var r=0,h=c.length;h>r;r++)if(c[r].parentNode===s){var u=n(i,c[r]);u&&(i.bullets[i.bullets.length]=u)}var m=s.getElementsByTagName("fire");if(m)for(var r=0,h=m.length;h>r;r++)if(m[r].parentNode===s){var p=o(i,m[r]);p&&(i.fires[i.fires.length]=p)}return i}}function e(t,n){var s=new bulletml.Action;return x(n,"label",function(t){s.label=t}),b(n,".",function(n){switch(n.tagName.toLowerCase()){case"action":s.commands[s.commands.length]=e(t,n);break;case"actionref":s.commands[s.commands.length]=i(t,n);break;case"fire":s.commands[s.commands.length]=o(t,n);break;case"fireref":s.commands[s.commands.length]=a(t,n);break;case"changedirection":s.commands[s.commands.length]=r(t,n);break;case"changespeed":s.commands[s.commands.length]=h(t,n);break;case"accel":s.commands[s.commands.length]=l(t,n);break;case"wait":s.commands[s.commands.length]=c(t,n);break;case"vanish":s.commands[s.commands.length]=u(t,n);break;case"repeat":s.commands[s.commands.length]=m(t,n)}}),s.root=t,s}function i(t,e){var i=new bulletml.ActionRef(x(e,"label"));return b(e,/param$/,function(t){i.params[i.params.length]=w(t)}),i.root=t,i}function n(t,n){var s=new bulletml.Bullet;return x(n,"label",function(t){s.label=t}),v(n,"direction",function(t){s.direction=p(t)}),v(n,"speed",function(t){s.speed=d(t)}),b(n,/(action)|(actionRef)$/,function(n){"action"==n.tagName.toLowerCase()?s.actions[s.actions.length]=e(t,n):"actionref"==n.tagName.toLowerCase()&&(s.actions[s.actions.length]=i(t,n))}),s.root=t,s}function s(t,e){var i=new bulletml.BulletRef(x(e,"label"));return b(e,/param$/,function(t){i.params[i.params.length]=w(t)}),i.root=t,i}function o(t,e){var i=new bulletml.Fire;if(x(e,"label",function(t){i.label=t}),v(e,"direction",function(t){i.direction=p(t)}),v(e,"speed",function(t){i.speed=d(t)}),v(e,"bullet",function(e){i.bullet=n(t,e)}),v(e,"bulletref",function(e){i.bullet=s(t,e)}),!i.bullet)throw new Error("fire has no bullet or bulletRef.");return i.root=t,i}function a(t,e){var i=new bulletml.FireRef(x(e,"label"));return b(e,/param$/,function(t){i.params[i.params.length]=w(t)}),i.root=t,i}function r(t,e){var i=new bulletml.ChangeDirection;return i.root=t,v(e,"direction",function(t){i.direction=p(t)}),v(e,"term",function(t){i.term=w(t)}),i}function h(t,e){var i=new bulletml.ChangeSpeed;return i.root=t,v(e,"speed",function(t){i.speed=d(t)}),v(e,"term",function(t){i.term=w(t)}),i}function l(t,e){var i=new bulletml.Accel;return i.root=t,v(e,"horizontal",function(t){i.horizontal=f(t)}),v(e,"vertical",function(t){i.vertical=g(t)}),v(e,"term",function(t){i.term=w(t)}),i}function c(t,e){var i=new bulletml.Wait;return i.root=t,i.value=w(e),i}function u(t){var e=new bulletml.Vanish;return e.root=t,e}function m(t,n){var s=new bulletml.Repeat;return v(n,"action",function(i){s.action=e(t,i)}),v(n,"actionRef",function(e){s.action=i(t,e)}),v(n,"times",function(t){s.times=w(t)}),s.root=t,s}function p(t){return y(new bulletml.Direction,t)}function d(t){return y(new bulletml.Speed,t)}function f(t){return y(new bulletml.Horizontal,t)}function g(t){return y(new bulletml.Vertical,t)}function y(t,e){return x(e,"type",function(e){t.type=e}),w(e,function(e){t.value=e}),t}function v(t,e,i,n){e=e.toLowerCase();for(var s=t.childNodes,o=0,a=s.length;a>o;o++)if(s[o].tagName&&s[o].tagName.toLowerCase()==e)return i&&i(s[o]),s[o];return n&&n(),null}function b(t,e,i){for(var n=t.childNodes,s=0,o=n.length;o>s;s++)n[s].tagName&&n[s].tagName.toLowerCase().match(e)&&i(n[s])}function x(t,e,i,n){var s=t.attributes,o=s[e];return o?(i&&i(o.value),o.value):(n&&n(),"")}function w(t,e){var i=t.textContent.trim();return void 0!==i?(e&&e(i),i):""}bulletml.buildXML=function(e){var i;if("string"==typeof e){var n=new DOMParser;i=t(n.parseFromString(e,"application/xml"))}else{if(!e.getElementsByTagName("bulletml"))throw new Error("cannot build "+e);i=t(e)}return i}}(),function(){bulletml.dsl=function(t){t=t||"";for(var e in bulletml.dsl)bulletml.dsl.hasOwnProperty(e)&&(bulletml.GLOBAL[t+e]=bulletml.dsl[e])},bulletml.dsl.action=function(t){if(arguments.length>0)for(var e=0,i=arguments.length;i>e;e++)arguments[e]instanceof Function&&(arguments[e]=arguments[e]());if(t instanceof Array)for(var e=0,i=t.length;i>e;e++)t[e]instanceof Function&&(t[e]=t[e]());var n=new bulletml.Action;if(t instanceof Array){if(t.some(function(t){return!(t instanceof bulletml.Command)}))throw new Error("argument type error.");n.commands=t}else for(var e=0,i=arguments.length;i>e;e++){if(!(arguments[e]instanceof bulletml.Command))throw new Error("argument type error.");n.commands[e]=arguments[e]}return n},bulletml.dsl.actionRef=function(t,e){for(var i=0,n=arguments.length;n>i;i++)arguments[i]instanceof Function&&(arguments[i]=arguments[i]());if(void 0===t)throw new Error("label is required.");var s=new bulletml.ActionRef(t);if(e instanceof Array)s.params=e;else for(var i=1;i<arguments.length;i++)s.params.push(arguments[i]);return s},bulletml.dsl.bullet=function(){for(var t=0,e=arguments.length;e>t;t++)arguments[t]instanceof Function&&(arguments[t]=arguments[t]());for(var i=new bulletml.Bullet,t=0;t<arguments.length;t++)arguments[t]instanceof bulletml.Direction?i.direction=arguments[t]:arguments[t]instanceof bulletml.Speed?i.speed=arguments[t]:arguments[t]instanceof bulletml.Action?i.actions.push(arguments[t]):arguments[t]instanceof bulletml.ActionRef?i.actions.push(arguments[t]):arguments[t]instanceof Array?i.actions.push(bulletml.dsl.action(arguments[t])):arguments[t]instanceof Object?i.option=arguments[t]:"string"==typeof arguments[t]&&(i.label=arguments[t]);return i},bulletml.dsl.bulletRef=function(t,e){for(var i=0,n=arguments.length;n>i;i++)arguments[i]instanceof Function&&(arguments[i]=arguments[i]());if(void 0===t)throw new Error("label is required.");var s=new bulletml.BulletRef(t);if(e instanceof Array)s.params=e;else for(var i=1;i<arguments.length;i++)s.params.push(arguments[i]);return s},bulletml.dsl.fire=function(){for(var t=0,e=arguments.length;e>t;t++)arguments[t]instanceof Function&&(arguments[t]=arguments[t]());for(var i=new bulletml.Fire,t=0;t<arguments.length;t++)arguments[t]instanceof bulletml.Direction?i.direction=arguments[t]:arguments[t]instanceof bulletml.Speed?i.speed=arguments[t]:arguments[t]instanceof bulletml.Bullet?i.bullet=arguments[t]:arguments[t]instanceof bulletml.BulletRef?i.bullet=arguments[t]:arguments[t]instanceof bulletml.FireOption?i.option=arguments[t]:arguments[t]instanceof bulletml.OffsetX?i.option.offsetX=arguments[t].value:arguments[t]instanceof bulletml.OffsetY?i.option.offsetY=arguments[t].value:arguments[t]instanceof bulletml.Autonomy&&(i.option.autonomy=arguments[t].value);if(void 0===i.bullet)throw new Error("bullet (or bulletRef) is required.");return i},bulletml.dsl.fireRef=function(t,e){for(var i=0,n=arguments.length;n>i;i++)arguments[i]instanceof Function&&(arguments[i]=arguments[i]());if(void 0===t)throw new Error("label is required.");var s=new bulletml.FireRef(t);if(e instanceof Array)s.params=e;else for(var i=1;i<arguments.length;i++)s.params.push(arguments[i]);return s},bulletml.dsl.changeDirection=function(t,e){for(var i=0,n=arguments.length;n>i;i++)arguments[i]instanceof Function&&(arguments[i]=arguments[i]());if(void 0===t)throw new Error("direction is required.");if(void 0===e)throw new Error("term is required.");var s=new bulletml.ChangeDirection;return s.direction=t instanceof bulletml.Direction?t:new bulletml.Direction(t),s.term=e,s},bulletml.dsl.changeSpeed=function(t,e){for(var i=0,n=arguments.length;n>i;i++)arguments[i]instanceof Function&&(arguments[i]=arguments[i]());if(void 0===t)throw new Error("speed is required.");if(void 0===e)throw new Error("term is required.");var s=new bulletml.ChangeSpeed;return s.speed=t instanceof bulletml.Speed?t:new bulletml.Speed(t),s.term=e,s},bulletml.dsl.accel=function(t,e){for(var i=0,n=arguments.length;n>i;i++)arguments[i]instanceof Function&&(arguments[i]=arguments[i]());for(var s=new bulletml.Accel,i=0;i<arguments.length;i++)arguments[i]instanceof bulletml.Horizontal?s.horizontal=t:arguments[i]instanceof bulletml.Vertical?s.vertical=e:s.term=arguments[i];if(void 0===s.horizontal&&void 0===s.vertical)throw new Error("horizontal or vertical is required.");if(void 0===s.term)throw new Error("term is required.");return s},bulletml.dsl.wait=function(t){for(var e=0,i=arguments.length;i>e;e++)arguments[e]instanceof Function&&(arguments[e]=arguments[e]());if(void 0===t)throw new Error("value is required.");return new bulletml.Wait(t)},bulletml.dsl.vanish=function(){return new bulletml.Vanish},bulletml.dsl.repeat=function(t,e){for(var i=0,n=arguments.length;n>i;i++)arguments[i]instanceof Function&&(arguments[i]=arguments[i]());if(void 0===t)throw new Error("times is required.");if(void 0===e)throw new Error("action is required.");var s=new bulletml.Repeat;if(s.times=t,e instanceof bulletml.Action||e instanceof bulletml.ActionRef)s.action=e;else if(e instanceof Array)s.action=bulletml.dsl.action(e);else{for(var o=[],i=1;i<arguments.length;i++)o.push(arguments[i]);s.action=bulletml.dsl.action(o)}return s},bulletml.dsl.bindVar=function(t,e){return new bulletml.Bind(t,e)},bulletml.dsl.notify=function(t,e){return new bulletml.Notify(t,e)},bulletml.dsl.direction=function(t,e){for(var i=0,n=arguments.length;n>i;i++)arguments[i]instanceof Function&&(arguments[i]=arguments[i]());if(void 0===t)throw new Error("value is required.");var s=new bulletml.Direction(t);return void 0!==e&&(s.type=e),s},bulletml.dsl.speed=function(t,e){for(var i=0,n=arguments.length;n>i;i++)arguments[i]instanceof Function&&(arguments[i]=arguments[i]());if(void 0===t)throw new Error("value is required.");var s=new bulletml.Speed(t);return e&&(s.type=e),s},bulletml.dsl.horizontal=function(t,e){for(var i=0,n=arguments.length;n>i;i++)arguments[i]instanceof Function&&(arguments[i]=arguments[i]());if(void 0===t)throw new Error("value is required.");var s=new bulletml.Horizontal(t);return e&&(s.type=e),s},bulletml.dsl.vertical=function(t,e){for(var i=0,n=arguments.length;n>i;i++)arguments[i]instanceof Function&&(arguments[i]=arguments[i]());if(void 0===t)throw new Error("value is required.");var s=new bulletml.Vertical(t);return e&&(s.type=e),s},bulletml.dsl.fireOption=function(t){return new bulletml.FireOption(t)},bulletml.dsl.offsetX=function(t){return new bulletml.OffsetX(t)},bulletml.dsl.offsetY=function(t){return new bulletml.OffsetY(t)},bulletml.dsl.autonomy=function(t){return new bulletml.Autonomy(t)}}(),function(){bulletml.json=bulletml.json||{}}(),function(){bulletml.runner=bulletml.runner||{},bulletml.runner.RunnerFactory=function(t){this.root=t},bulletml.runner.RunnerFactory.prototype.create=function(t){for(var e in bulletml.runner.DEFAULT_CONFIG)bulletml.runner.DEFAULT_CONFIG.hasOwnProperty(e)&&void 0===t[e]&&(t[e]=bulletml.runner.DEFAULT_CONFIG[e]);var i=this.root.getTopActionLabels();if(1===i.length)return new bulletml.runner.SubRunner(t,this.root.getWalker(i[0]));for(var n=new bulletml.runner.ParentRunner,s=0,o=i.length;o>s;s++)n.addSubRunner(new bulletml.runner.SubRunner(t,this.root.getWalker(i[s])));return n},bulletml.Root.prototype.createRunner=function(t,e){var i=new bulletml.runner.RunnerFactory(this).create(t);return e&&e(i),i},bulletml.runner.DEFAULT_CONFIG={rank:0,target:null,createNewBullet:function(){}},bulletml.runner.Runner=function(){this.x=0,this.y=0},bulletml.runner.Runner.prototype={constructor:bulletml.runner.Runner,update:function(){},onVanish:function(){},onNotify:function(){}},bulletml.runner.ParentRunner=function(){bulletml.runner.Runner.call(this),this.completed=!1,this.completedChildCount=0,this.subRunners=[]},bulletml.runner.ParentRunner.prototype=Object.create(bulletml.runner.Runner.prototype),bulletml.runner.ParentRunner.prototype.addSubRunner=function(t){t.parentRunner=this,this.subRunners.push(t)},bulletml.runner.ParentRunner.prototype.update=function(){for(var t=this.subRunners.length;t--;)this.subRunners[t].x=this.x,this.subRunners[t].y=this.y,this.subRunners[t].update();this.completedChildCount===this.subRunners.length&&(this.completed=!0)},bulletml.runner.SimpleSubRunner=function(t){bulletml.runner.Runner.call(this),this.config=t,this.direction=0,this.speed=0,this.deltaX=null,this.deltaY=null},bulletml.runner.SimpleSubRunner.prototype=Object.create(bulletml.runner.Runner.prototype),bulletml.runner.SimpleSubRunner.prototype.update=function(){null===this.deltaX&&(this.deltaX=Math.cos(this.direction)*this.speed),null===this.deltaY&&(this.deltaY=Math.sin(this.direction)*this.speed),this.x+=this.deltaX,this.y+=this.deltaY},bulletml.runner.SubRunner=function(t,e){bulletml.runner.SimpleSubRunner.call(this,t),this.walker=e,this.waitTo=-1,this.lastDirection=0,this.lastSpeed=0,this.speedH=0,this.speedV=0,this.dirIncr=0,this.dirFin=0,this.chDirEnd=-1,this.spdIncr=0,this.spdFin=0,this.chSpdEnd=-1,this.aclIncrH=0,this.aclFinH=0,this.aclIncrV=0,this.aclFinV=0,this.aclEnd=-1,this.age=-1,this.stop=!1,this.parentRunner=null},bulletml.runner.SubRunner.prototype=Object.create(bulletml.runner.SimpleSubRunner.prototype),bulletml.runner.SubRunner.prototype.update=function(){if(!(this.stop||(this.age+=1,this.config,this.age<this.chDirEnd?this.direction+=this.dirIncr:this.age===this.chDirEnd&&(this.direction=this.dirFin),this.age<this.chSpdEnd?this.speed+=this.spdIncr:this.age===this.chSpdEnd&&(this.speed=this.spdFin),this.age<this.aclEnd?(this.speedH+=this.aclIncrH,this.speedV+=this.aclIncrV):this.age===this.aclEnd&&(this.speedH=this.aclFinH,this.speedV=this.aclFinV),this.x+=Math.cos(this.direction)*this.speed,this.y+=Math.sin(this.direction)*this.speed,this.x+=this.speedH,this.y+=this.speedV,this.age<this.waitTo||this.completed))){for(var t;t=this.walker.next();)switch(t.commandName){case"fire":this.fire(t);break;case"wait":return void(this.waitTo=this.age+t.value);case"changeDirection":this.changeDirection(t);break;case"changeSpeed":this.changeSpeed(t);break;case"accel":this.accel(t);break;case"vanish":this.onVanish();break;case"notify":this.notify(t)}this.completed=!0,null!==this.parentRunner&&(this.parentRunner.completedChildCount+=1)}},bulletml.runner.SubRunner.prototype.fire=function(t){var i;i=0===t.bullet.actions.length?new bulletml.runner.SimpleSubRunner(this.config):new bulletml.runner.SubRunner(this.config,t.bullet.getWalker());var n={x:this.x+t.option.offsetX,y:this.y+t.option.offsetY},s=t.direction||t.bullet.direction,o=s.value*Math.PI/180;switch(s.type){case"aim":var a=this.config.target;a?(a instanceof Function&&(a=a()),i.direction=t.option.autonomy?e(n,a)+o:e(this,a)+o):i.direction=o-Math.PI/2;break;case"absolute":i.direction=o-Math.PI/2;break;case"relative":i.direction=this.direction+o;break;case"sequence":default:i.direction=this.lastDirection+o}this.lastDirection=i.direction;var r=t.speed||t.bullet.speed,h=r.value;switch(r.type){case"relative":i.speed=this.speed+h;break;case"sequence":i.speed=this.lastSpeed+h;break;case"absolute":default:i.speed=h}this.lastSpeed=i.speed,i.x=n.x,i.y=n.y;var l={};for(var c in t.bullet.option)l[c]=t.bullet.option[c];l.label=t.bullet.label,this.config.createNewBullet(i,l)},bulletml.runner.SubRunner.prototype.changeDirection=function(i){var n=i.direction.value*Math.PI/180,s=i.term;switch(i.direction.type){case"aim":var o=this.config.target;o instanceof Function&&(o=o()),this.dirFin=e(this,o)+n,this.dirIncr=t(this.dirFin-this.direction)/s;break;case"absolute":this.dirFin=n-Math.PI/2,this.dirIncr=t(this.dirFin-this.direction)/s;break;case"relative":this.dirFin=this.direction+n,this.dirIncr=t(this.dirFin-this.direction)/s;break;case"sequence":this.dirIncr=n,this.dirFin=this.direction+this.dirIncr*(s-1)}this.chDirEnd=this.age+s},bulletml.runner.SubRunner.prototype.changeSpeed=function(t){var e=t.speed.value,i=t.term;switch(t.speed.type){case"absolute":this.spdFin=e,this.spdIncr=(this.spdFin-this.speed)/i;break;case"relative":this.spdFin=e+this.speed,this.spdIncr=(this.spdFin-this.speed)/i;break;case"sequence":this.spdIncr=e,this.spdFin=this.speed+this.spdIncr*i}this.chSpdEnd=this.age+i},bulletml.runner.SubRunner.prototype.accel=function(t){var e=t.term;if(this.aclEnd=this.age+e,t.horizontal){var i=t.horizontal.value;switch(t.horizontal.type){case"absolute":case"sequence":this.aclIncrH=(i-this.speedH)/e,this.aclFinH=i;break;case"relative":this.aclIncrH=i,this.aclFinH=(i-this.speedH)*e}}else this.aclIncrH=0,this.aclFinH=this.speedH;if(t.vertical){var n=t.vertical.value;switch(t.vertical.type){case"absolute":case"sequence":this.aclIncrV=(n-this.speedV)/e,this.aclFinV=n;break;case"relative":this.aclIncrV=n,this.aclFinV=(n-this.speedV)*e}}else this.aclIncrV=0,this.aclFinV=this.speedV},bulletml.runner.SubRunner.prototype.notify=function(t){this.onNotify(t.eventName,t.params)};var t=function(t){for(;t<=-Math.PI;)t+=2*Math.PI;for(;Math.PI<t;)t-=2*Math.PI;return t},e=function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)}}(),function(){bulletml.output=bulletml.output||{},bulletml.output.json=bulletml.output.json||{},bulletml.Root.prototype.toJSON=function(){return{className:"Root",actions:this.actions,bullets:this.bullets,fires:this.fires}},bulletml.Bullet.prototype.toJSON=function(){return{className:"Bullet",label:this.label,direction:this.direction,speed:this.speed,actions:this.actions,option:this.options}},bulletml.BulletRef.prototype.toJSON=function(){return{className:"BulletRef",label:this.label,params:this.params}},bulletml.Action.prototype.toJSON=function(){return{className:"Action",label:this.label,commands:this.commands}},bulletml.ActionRef.prototype.toJSON=function(){return{className:"ActionRef",label:this.label,params:this.params}},bulletml.Fire.prototype.toJSON=function(){return{className:"Fire",label:this.label,direction:this.direction,speed:this.speed,bullet:this.bullet,option:this.option}},bulletml.FireRef.prototype.toJSON=function(){return{className:"FireRef",label:this.label,params:this.params}},bulletml.ChangeDirection.prototype.toJSON=function(){return{className:"ChangeDirection",direction:this.direction,term:this.term}},bulletml.ChangeSpeed.prototype.toJSON=function(){return{className:"ChangeSpeed",speed:this.speed,term:this.term}},bulletml.Accel.prototype.toJSON=function(){return{className:"Accel",horizontal:this.horizontal,vertical:this.vertical,term:this.term}},bulletml.Wait.prototype.toJSON=function(){return{className:"Wait",value:this.value}},bulletml.Vanish.prototype.toJSON=function(){return{className:"Vanish"}},bulletml.Repeat.prototype.toJSON=function(){return{className:"Repeat",times:this.times,action:this.action}},bulletml.Bind.prototype.toJSON=function(){return{className:"Bind",variable:this.variable,expression:this.expression}},bulletml.Notify.prototype.toJSON=function(){return{className:"Notify",eventName:this.eventName,params:this.params}},bulletml.Direction.prototype.toJSON=function(){return{className:"Direction",type:this.type,value:this.value}},bulletml.Speed.prototype.toJSON=function(){return{className:"Speed",type:this.type,value:this.value}},bulletml.Horizontal.prototype.toJSON=function(){return{className:"Horizontal",type:this.type,value:this.value}},bulletml.Vertical.prototype.toJSON=function(){return{className:"Vertical",type:this.type,value:this.value}},bulletml.FireOption.prototype.toJSON=function(){return{className:"FireOption",offsetX:this.offsetX,offsetY:this.offsetY,autonomy:this.autonomy}},bulletml.OffsetX.prototype.toJSON=function(){return{className:"OffsetX",value:this.value}},bulletml.OffsetY.prototype.toJSON=function(){return{className:"OffsetY",value:this.value}},bulletml.Autonomy.prototype.toJSON=function(){return{className:"Autonomy",value:this.value}}}(),tm.bulletml=tm.bulletml||{},function(){tm.define("tm.bulletml.Bullet",{superClass:"tm.display.CanvasElement",init:function(t){this.superInit(),this.runner=t,this.setPosition(this.runner.x,this.runner.y),this.runner.onVanish=function(){this.parent&&this.remove()}.bind(this)},update:function(){this.runner.update(),this.setPosition(this.runner.x,this.runner.y)}}),tm.app.Object2D.prototype.startDanmaku=function(t,e){e=(e||{}).$safe(bulletml.runner.DEFAULT_CONFIG);var i=t.createRunner(e);i.x=this.x,i.y=this.y;var n=function(){i.x=this.x,i.y=this.y,i.update(),this.setPosition(i.x,i.y)};n.isDanmaku=!0,this.on("enterframe",n),i.onNotify=function(t,e){if(t){var i=tm.event.Event(t);i.parm=e||"",this.fire(i)}}.bind(this)},tm.app.Object2D.prototype.stopDanmaku=function(){if(this.hasEventListener("enterframe"))for(var t=this._listeners.enterframe.clone(),e=0;e<t.length;e++)t[e].isDanmaku&&this.off("enterframe",t[e])}}();var SCREEN_WIDTH=640,SCREEN_HEIGHT=960,GAME_FIELD_LEFT=16,GAME_FIELD_RIGHT=624,GAME_FIELD_TOP=32,GAME_FIELD_BOTTOM=720,GAME_FPS=60,game=game||{};
!function(){game.FONT="'Audiowide', 'HiraKakuProN-W3', 'monospace'",game.NUMBER_FONT="'Inconsolata', 'monospace'",game.param={ENEMY_DEFAULT_ATTR:{width:48,height:48,hp:2e3,frameIndex:0,boundingType:"circle",type:"enemy",danmaku:"",fieldOutCheck:!0,addedAnimation:"",isSyncRotation:!1,target:"player"},BULLET_DEFAULT_ATTR:{width:24,height:24,color:"red",frameIndex:0,isSyncRotation:!1},DEFAULT_TEXT_SHAPE:{fontSize:64,fontFamily:game.FONT,fillStyle:"hsl(240, 100%, 95%)",strokeStyle:"hsl(240, 100%, 75%)"}},game.DEFAULT_CONFIG={enableDoubleTap:!0,modeChangeButton:"right",enableBackGround:!0,moveRatio:1},game.DEFAULT_DATA={title:"delta-delta",version:"0.2",config:game.DEFAULT_CONFIG,highScore:[0,0,0,0,0]},game.data={},game.saveData=function(t){t=t||{},localStorage.setItem("gameData",JSON.stringify(t))},game.loadData=function(){return localStorage.getItem("gameData")||game.saveData(game.DEFAULT_DATA),JSON.parse(localStorage.getItem("gameData"))},game.GameFieldOut=function(t){return t.top>GAME_FIELD_BOTTOM||t.bottom<GAME_FIELD_TOP||t.left>GAME_FIELD_RIGHT||t.right<GAME_FIELD_LEFT?!0:!1},game.TweenAnimation=function(t,e,i,n){if(n=n.$safe({scaleX:1,scaleY:1,alpha:1,rotation:0}),!(1>i))switch(e){case"in":t.tweener.clear().to(n,i);break;case"out":t.update=function(){},t.tweener.clear().to(n,i).call(function(){this.parent&&this.remove()}.bind(t));break;case"draw_phase":t.tweener.clear().to({scaleX:1,scaleY:1},i).wait(5*i).to(n,i).call(function(){this.parent&&this.remove()}.bind(t))}},game.setDanmaku=function(t,e,i,n){var s={target:e,createNewBullet:function(t,e){switch(e.type){case"enemy":case"boss":{game.Enemy(t,e).addChildTo(i.enemyLayer)}break;case"invisible":{game.InvisibleEnemy(t,e).addChildTo(i.bulletLayer)}break;default:{game.EnemyBullet(t,e).addChildTo(i.bulletLayer)}}}};t.startDanmaku(game.danmakuPattern(t.danmaku,n),s)},game.danmakuList=function(t){var e=[["stage0_01","stage0_02","stage0_03"],["stage1_01","stage1_02","stage1_03"],["stage2_01","stage2_02","stage2_03"],["stage3_01","stage3_02","stage3_03"],["stage4_01","stage4_02","stage4_03","stage4_04"],["stage5_01","stage5_02","stage5_03","stage5_04","stage5_05"]];return e[t]}}(),game.ActionPattern={},game.FirePattern={},function(){var t=bulletml.dsl;game.ActionPattern.change_direction=function(e,i,n,s){return s||(s=n),i?t.action([t.changeDirection(t.direction(e,i),n),t.wait(s)]):void 0},game.ActionPattern.change_speed=function(e,i,n){return n||(n=i),t.action([t.changeSpeed(t.speed(e),i),t.wait(n)])},game.ActionPattern.yura_yura=function(e,i,n){return n||(n=99),t.action([t.changeSpeed(t.speed(e),1),t.repeat(n,[game.ActionPattern.change_direction(120,"absolute",1,i),game.ActionPattern.change_direction(60,"absolute",1,i),game.ActionPattern.change_direction(300,"absolute",1,i),game.ActionPattern.change_direction(240,"absolute",1,2*i),game.ActionPattern.change_direction(300,"absolute",1,i),game.ActionPattern.change_direction(60,"absolute",1,i),game.ActionPattern.change_direction(120,"absolute",1,i)]),t.changeSpeed(t.speed(0),1)])},game.ActionPattern.round_trip=function(e,i,n,s){return s=s||0,n||(n=999),t.action(s?[t.repeat(n,[game.ActionPattern.change_speed(0,1,s),game.ActionPattern.change_direction(180,"relative",1),game.ActionPattern.change_speed(e,1,i)])]:[t.repeat(n,[t.changeSpeed(t.speed(0),1),game.ActionPattern.change_direction(180,"relative",1),game.ActionPattern.change_speed(e,1,i)])])},game.ActionPattern.triangle_loop=function(e,i,n,s,o){return o=o||0,s||(s=999),t.action(o?[t.changeDirection(t.direction("left"===i?210:150,"absolute"),1),t.repeat(s,[t.repeat(3,[game.ActionPattern.change_speed(e,1,n),game.ActionPattern.change_direction("left"===i?-120:120,"relative",1),game.ActionPattern.change_speed(0,1,o)])])]:[t.changeDirection(t.direction("left"===i?210:150,"absolute"),1),game.ActionPattern.change_speed(e,1,n),t.repeat(s,[t.repeat(3,[game.ActionPattern.change_direction("left"===i?-120:120,"relative",1)])])])},game.ActionPattern.circle_loop=function(e,i,n,s){s||(s=99);var o=i*Math.PI/180,a=n*e;return t.action([game.ActionPattern.change_speed(e*o,1),t.repeat(~~(360/Math.abs(a))*s,[game.ActionPattern.change_direction(a,"relative",1)])])},game.FirePattern.normal=function(e,i,n,s,o){return s=s||{},o?t.fire(t.direction(e,i),t.speed(n),t.bullet(s,o)):t.fire(t.direction(e,i),t.speed(n),t.bullet(s))},game.FirePattern.offset=function(e,i,n,s,o,a,r){return a=a||{},r?t.fire(t.offsetX(e),t.offsetY(i),t.direction(n,s),t.speed(o),t.bullet(a,r)):t.fire(t.offsetX(e),t.offsetY(i),t.direction(n,s),t.speed(o),t.bullet(a))}}();var game=game||{};!function(){var t=bulletml.dsl,e=game.ActionPattern,i=game.FirePattern;game.danmakuPattern=function(n,s){s={rank:0}.$extend(s);var o={type:"enemy",frameIndex:5,hp:12,isSyncRotation:!0},a={type:"enemy",width:48,height:24,frameIndex:3,boundingType:"rect",hp:3,isSyncRotation:!0},r={type:"enemy",frameIndex:15,boundingType:"rect",hp:15},h={type:"enemy",frameIndex:17,boundingType:"rect",hp:100},l={type:"enemy",width:64,height:64,frameIndex:18,boundingType:"rect",hp:36},c={type:"enemy",width:64,height:96,frameIndex:7,boundingtype:"rect",hp:45},u={type:"enemy",frameIndex:7,hp:18,isSyncRotation:!0},m={type:"boss",width:96,height:96,frameIndex:10,hp:2e3},p={type:"enemy",width:96,height:96,frameIndex:10,hp:100},d={width:48,height:24,frameIndex:1,isSyncRotation:!0},f={width:32,height:32,frameIndex:18},g={width:64,height:64,frameIndex:9},y={type:"invisible",fieldOutCheck:!0},v={test1:function(){return m.hp=250,{top:t.action([i.offset(320,160,0,"absolute",0,m)])}},test6:function(){return{top:t.action([t.repeat(999,[t.fire(t.offsetX(320),t.offsetY(120),t.direction("$rand * 180 + 90","absolute"),t.speed(2),t.bullet(c)),t.repeat(99,[t.wait(15),i.offset(320,120,"$rand * 180 + 90","absolute",2,c,t.actionRef("test"))])])]),test:t.action([t.wait(60),e.change_speed(4,120)])}},stage0_01:function(){return m.hp=450,{top:t.action([t.wait(60),t.notify("cutin","画面をスライドして、自機を操作。弾は自動で発射します"),i.offset(320,0,180,"absolute",5,m,t.actionRef("boss")),t.wait(30),t.notify("cutin","コアが出現しました。破壊してください")]),boss:t.action([e.change_speed(0,90,120),t.repeat(3,t.action([t.changeSpeed(t.speed(2),1),t.repeat(360,[e.change_direction(1,"relative",1)]),t.repeat(360,[e.change_direction(-1,"relative",1)]),t.changeSpeed(t.speed(0),1),t.wait(120)]))])}},stage0_02:function(n){return m.hp=1400,{top:t.action([t.wait(60),i.offset(320,0,180,"absolute",6,m,t.actionRef("boss")),t.wait(105),t.notify("cutin","コアが攻撃して来ました。弾を避けてください"),t.wait(15),t.notify("cutin","エネルギーが50%以上あれば、バリアモードに切り替える事が出来ます"),t.wait(15),t.notify("cutin","バリアモード時は敵の弾を跳ね返して攻撃することが出来ます")]),boss:t.action([e.change_speed(0,90),t.repeat(99,[t.repeat(5,[t.repeat(11+n.rank,[i.normal(43,"sequence",3)]),t.wait(15)]),t.wait(60)])])}},stage0_03:function(){return m.hp=1e3,{top:t.action([t.wait(60),i.offset(320,0,180,"absolute",6,m,t.actionRef("boss")),t.wait(120),t.notify("cutin","コアがオブジェクトを発射しました。バリアで防ぐとエネルギーが大きく減少します"),t.wait(30),t.notify("cutin","オブジェクトを破壊すると、弾をばら撒きます。バリアで跳ね返して攻撃しましょう")]),boss:t.action([t.changeSpeed(t.speed(0),90),t.wait(105),t.repeat(99,[t.repeat(8,[i.normal(45,"sequence",3,o,t.actionRef("zako"))]),t.wait(90),t.repeat(8,[i.normal(45,"sequence",3,r,t.actionRef("zako"))]),t.wait(90),t.repeat(8,[i.normal(45,"sequence",3,u,t.actionRef("zako"))]),t.wait(240)])]),zako:t.action([t.wait(75),i.normal(120,"relative",2),t.repeat(2,[i.normal(60,"sequence",2)])])}},stage1_01:function(){return m.hp=1800,o.hp=9,{top:t.action([t.wait(60),i.offset(320,0,180,"absolute",4,m,t.actionRef("boss"))]),boss:t.action([e.change_speed(0,90),t.repeat(99,[t.repeat(5,[t.repeat(4,[i.normal("$rand * 180 + 90","aim",4,o,t.actionRef("zakomove")),t.wait(5)]),t.wait("30 - $loop.index * 5")]),t.repeat(2,[i.normal("$loop.index * 5","absolute",2),t.repeat(35,[i.normal(10,"sequence",2)]),t.wait(30)]),t.wait("85 - $loop.index * 5")])]),zakomove:t.action([e.change_speed(6,240,30),t.repeat(2,[e.change_direction(0,"aim",45)])])}},stage1_02:function(){return m.hp=600,{top:t.action([t.wait(60),i.offset(320,0,180,"absolute",4,m,t.actionRef("boss"))]),boss:t.action([e.change_speed(0,90),t.repeat(4,[i.normal(90,"sequence",8,h,t.actionRef("barrier"))]),t.repeat(99,[t.wait(30),t.changeDirection(t.direction(270,"absolute"),1),e.change_speed(2,1,30),i.normal(240,"absolute",12,u,t.actionRef("zako")),i.normal(300,"absolute",12,u,t.actionRef("zako")),e.change_direction(180,"relative",1,60),i.normal(120,"absolute",12,u,t.actionRef("zako")),i.normal(60,"absolute",12,u,t.actionRef("zako")),e.change_direction(180,"relative",1,30),e.change_speed(0,1,300)])]),barrier:t.action([t.wait(4),e.change_speed(0,1),i.normal(90,"relative",8,h,t.actionRef("barrier")),t.wait(30),t.vanish()]),zako:t.action([t.changeDirection(t.direction(180,"absolute"),30),e.change_speed(0,90),t.changeSpeed(t.speed(.01),1),t.repeat(10,[e.change_direction(0,"aim",1)]),t.wait(15),t.changeDirection(t.direction(180,"aim"),1),t.changeSpeed(t.speed(2),1),t.repeat(15,[i.normal("$rand * 120 + 120","relative",9,d,t.actionRef("change_speed",2,60)),i.normal("$rand * 120 + 120","relative",8,f,t.actionRef("change_speed",2,45)),i.normal("$rand * 120 + 120","relative",7,{},t.actionRef("change_speed",2,30)),t.wait(2)])]),change_speed:t.action([t.changeSpeed(t.speed("$1"),"$2"),t.wait("$2 * 3"),t.changeSpeed(t.speed("$1 * 2"),"$2")])}},stage1_03:function(){return m.danmaku="boss2",m.hp=1600,{top:t.action([t.wait(60),i.offset(320,0,180,"absolute",5,m,t.actionRef("bossmove"))]),top2:t.action([t.wait(90),t.repeat(999,[i.offset("$rand * 500 + 80",0,180,"absolute",0,c,t.action([e.change_speed(3,90,60),t.repeat(11,[i.normal("$loop.index * 7 + 5","relative",3,f),i.normal("-($loop.index * 7 + 5)","relative",3,f),t.wait(5)])])),t.wait("~~(Math.cos($loop.index) * 150) + 240")])]),bossmove:t.action([e.change_speed(0,90),e.change_direction(0,"absolute",1),t.repeat(99,[e.circle_loop(2,120,1,1),e.change_speed(0,1,60),e.circle_loop(2,120,-1,1),e.change_speed(0,1,60),e.change_direction(180,"relative",1,60)])])}},stage2_01:function(){return m.hp=2300,m.danmaku="boss4",{top:t.action([t.wait(60),i.offset(320,0,180,"absolute",5,m,t.actionRef("boss"))]),boss:t.action([e.change_speed(0,90,120),t.repeat(99,[t.repeat(5,[i.normal("$loop.index * 30 + 60","absolute",4,g,t.actionRef("wing",1,0)),i.normal("-$loop.index * 30 - 60","absolute",4,g,t.actionRef("wing",-1,0)),t.wait(30)]),t.wait("~~(Math.cos($loop.index) * 360) + 390")])]),wing:t.action([t.wait("15 + $2 * 15"),i.normal("$1 * 60","relative",2,g,t.actionRef("wing","$1","$2 + 1")),t.changeSpeed(t.speed(4),150)])}},stage2_02:function(){return u.danmaku="single02",{top:t.action([t.wait(60),i.offset(320,260,180,"absolute",0,m,t.actionRef("boss"))]),boss:t.action([t.repeat(99,[i.normal(210,"absolute",8,u,t.actionRef("inside_move")),t.repeat(8,[i.normal(36,"sequence",8,u,t.actionRef("inside_move"))]),i.normal(210,"absolute",8,u,t.actionRef("outside_move")),t.repeat(24,[i.normal(12,"sequence",8,u,t.actionRef("outside_move"))]),t.wait(480)])]),inside_move:t.action([t.wait(10),e.change_speed(0,1),t.changeDirection(t.direction(-90,"relative"),1),e.circle_loop(3,80,-1,3.5)]),outside_move:t.action([t.wait(30),e.change_speed(0,1),t.changeDirection(t.direction(90,"relative"),1),e.circle_loop(1,240,1,1)])}},stage2_03:function(){return r.addedAnimation="drop",m.hp=900,{top:t.action([t.wait(60),i.offset(640,96,270,"absolute",12,m,t.actionRef("boss"))]),boss:t.action([e.change_speed(0,100),t.repeat(99,[i.normal(180,"absolute",12,y,t.actionRef("bullet_point1",1)),t.actionRef("move",12),i.normal(180,"absolute",12,y,t.actionRef("bullet_point1",-1)),t.wait(15),t.actionRef("move",12),t.wait(1),t.actionRef("move",2),t.wait(1),t.actionRef("move",2),t.wait(180)])]),move:t.action([t.changeDirection(t.direction(180,"relative"),1),t.changeSpeed(t.speed("$1"),1),t.wait("552 / $1"),t.changeSpeed(t.speed(0),1)]),bullet_point1:t.action([t.wait("($1 > 0) ? 2 : 6"),t.repeat(3,[t.wait(8),i.normal("-90 * $1","relative",12,y,t.actionRef("bullet_point2"))]),t.vanish()]),bullet_point2:t.action([t.repeat(6,[i.normal(0,"relative",0,r,t.action([t.wait(240),i.normal("~~($rand * 4) * 90","absolute",3,f),t.repeat(3,[t.wait(120),i.normal(90,"sequence",3,f)]),t.changeSpeed(t.speed(4),1)])),t.wait(8)])])}},stage3_01:function(){return c.fieldOutCheck=u.fieldOutCheck=!1,u.isSyncRotation=!1,c.hp=u.hp=550,m.hp=1200,m.danmaku="boss3",u.danmaku="whip01",{top:t.action([t.wait(59),i.offset(639,128,270,"absolute",7,m,t.actionRef("bossmove",1))]),top1:t.action([t.wait(60),i.offset(597,160,270,"absolute",7,c,t.actionRef("bossmove",0)),i.offset(569,128,270,"absolute",7,c,t.actionRef("bossmove",0)),i.offset(540,102,270,"absolute",7,c,t.actionRef("bossmove",0)),i.offset(585,80,270,"absolute",7,u,t.actionRef("bossmove",0)),i.offset(681,160,270,"absolute",7,c,t.actionRef("bossmove",0)),i.offset(710,128,270,"absolute",7,c,t.actionRef("bossmove",0)),i.offset(739,102,270,"absolute",7,c,t.actionRef("bossmove",0)),i.offset(693,80,270,"absolute",7,u,t.actionRef("bossmove",0))]),bossmove:t.action([t.changeSpeed(t.speed(0),90),t.wait("$1 + 90"),e.change_speed(0,60),e.yura_yura(2.5,45)])}},stage3_02:function(){return m.danmaku="boss7",m.hp=2500,{top:t.action([t.wait(60),i.offset(320,0,180,"absolute",6,m,t.actionRef("boss"))]),boss:t.action([e.change_speed(0,60),e.change_direction(90,"absolute",1),e.change_speed(3,1,45),e.round_trip(3,90),t.changeSpeed(t.speed(0),1)])}},stage3_03:function(){return m.hp=1200,m.danmaku="boss1_01",l.hp=75,l.danmaku="single01",{top0:t.action([t.wait(60),i.offset(320,0,180,"absolute",4,m,t.actionRef("boss"))]),top1:t.action([t.wait(60),t.repeat(99,[t.repeat(4,[i.offset("$loop.index * 140 + 80",0,180,"absolute",6,l,t.actionRef("middle",-1))]),t.repeat(4,[i.offset("$loop.index * 140 + 150",0,180,"absolute",5,l,t.actionRef("middle",1))]),t.wait(720)])]),boss:t.action([e.change_speed(0,90),e.yura_yura(1,60)]),middle:t.action([t.wait(60),e.change_speed(0,1,20),t.changeDirection(t.direction("$1 * 90","relative"),1),t.repeat(99,[e.change_speed(1,1,70),e.change_speed(0,1,20),t.changeDirection(t.direction(180,"absolute"),1),e.change_speed(.5,1,70),e.change_speed(0,1,20),t.changeDirection(t.direction("$1 * 90","relative"),1)])])}},stage4_01:function(){return m.danmaku="boss8",m.hp=2200,{top:t.action([t.wait(60),i.offset(320,0,180,"absolute",6,m,t.action([e.change_speed(0,60,180),e.triangle_loop(4,"right",60,99,240)]))])}},stage4_02:function(){return r.hp=120,r.danmaku="single03",m.hp=1800,m.danmaku="boss5",{top:t.action([t.wait(60),i.offset(320,0,180,"absolute",6,m,t.actionRef("boss"))]),boss:t.action([e.change_speed(0,90),t.repeat(99,[i.normal(60,"absolute",4,r,t.actionRef("zako")),t.repeat(5,i.normal(60,"sequence",4,r,t.actionRef("zako"))),i.normal(30,"absolite",6,r,t.actionRef("zako")),t.repeat(11,i.normal(30,"sequence",6,r,t.actionRef("zako"))),t.wait(25),e.yura_yura(1.5,60,2),t.wait(180)])]),zako:t.action([e.change_speed(0,25),e.yura_yura(1.5,60,2),e.change_direction("(~~($rand * 4)) * 90","absolute",1),t.changeSpeed(t.speed(4),59)])}},stage4_03:function(){return r.hp=8,{top:t.action([t.wait(60),i.offset(320,0,180,"absolute",6,m,t.action([e.change_speed(0,90),t.repeat(99,[t.repeat(3,[i.normal(90,"sequence",4,r,t.actionRef("zako"))]),t.wait(10),t.repeat(20,[i.normal(27,"sequence","$loop.index * 0.25 + 2",f),t.wait(1)]),t.changeDirection(t.direction(90,"relative"),1),e.change_speed(4,30),e.change_speed(0,30,120)])]))]),top2:t.action([t.wait(120),t.repeat(99,[i.offset("Math.sin($loop.index) * 130 + 480",GAME_FIELD_TOP,180,"absolute",6,o,t.action([t.wait(10),t.repeat(4,[i.normal("$rand * 5 - 2","aim",2.5,d),t.wait(15)])])),t.wait("~~($rand * 210) + 30")])]),zako:t.action([t.wait(12),e.change_speed(0,1,3),t.bindVar("r","$rand * 9"),i.normal("($r < 1) ? -90 : ($r < 2) ? 90 : 0","relative",4,r,t.actionRef("zako")),t.wait(30),t.vanish()])}},stage4_04:function(){return m.hp=1500,m.danmaku="boss6",{top:t.action([t.wait(60),i.offset(320,0,180,"absolute",6,m,t.action([e.change_speed(0,60),e.yura_yura(1,60)]))]),top2:t.action([t.repeat(99,[t.wait(360),i.offset(17,32,135,"absolute",10,y,t.actionRef("bullet")),t.wait(240),i.offset(623,240,225,"absolute",10,y,t.actionRef("bullet")),t.wait(240),i.offset(623,32,225,"absolute",10,y,t.actionRef("bullet")),t.wait(240),i.offset(17,240,135,"absolute",10,y,t.actionRef("bullet"))])]),bullet:t.action([t.repeat(30,[t.wait(4),i.normal(0,"aim",0,f,t.action([t.changeSpeed(t.speed(4),240)]))])])}},stage5_01:function(){return u.danmaku="zako01",m.hp=1500,{top:t.action([t.wait(60),i.offset(320,0,180,"absolute",4,m,t.actionRef("boss"))]),top2:t.action([t.wait(210),t.repeat(99,[t.repeat(9,[i.offset("$loop.index * 72 + 32",32,180,"absolute",4,l)]),t.wait(210)])]),boss:t.action([e.change_speed(0,90),t.repeat(99,[t.changeDirection(t.direction(240,"absolute"),1),e.change_speed(8,60),e.change_speed(0,1),i.normal(120,"absolute",12,u,t.actionRef("zako")),t.repeat(3,[i.normal(40,"sequence",12,u,t.actionRef("zako"))]),t.actionRef("move"),e.change_direction(300,"absolute",1,15),e.change_speed(8,60),e.change_speed(0,1,60)])]),move:t.action([e.change_speed(0,8),e.change_direction(90,"absolute",1),e.change_speed(2,1,211),e.change_speed(0,1)]),zako:t.action([t.actionRef("move"),e.change_direction(180,"absolute",1),e.change_speed(4,1)])}},stage5_02:function(){return{top:t.action([t.wait(60),i.offset(320,0,180,"absolute",13,m,t.actionRef("boss"))]),boss:t.action([t.repeat(99,[e.change_speed(0,60),t.changeDirection(t.direction(0,"absolute"),1),t.changeSpeed(t.speed(4),1),t.actionRef("shot",2,120,120),t.wait(60),t.changeSpeed(t.speed(0),1),t.actionRef("shot",2,180,90),t.wait(120),t.repeat(4,[t.bindVar("dir","($loop.index & 1) ? 1 : -1"),t.repeat(10,[i.normal("$dir * ($loop.index * 12 + 90)","absolute",3.75,f),t.repeat(3,[i.normal("$dir * 15","sequence","3.5 - $loop.index * 0.25",f)]),t.wait(10)]),t.wait(45)]),t.wait(120),t.changeSpeed(t.speed(8),1),e.change_direction(180,"absolute",1)])]),shot:t.action([t.repeat("$1",[t.fire(t.direction("$loop.index * $2 + $3","absolute"),t.speed(8),t.bullet(o,t.action([e.change_speed(0,30),t.repeat(3,[i.normal("$loop.index * 120","absolute",8,o,t.actionRef("zako"))]),t.vanish()])))])]),zako:t.action([e.change_speed(0,30),t.changeDirection(t.direction(90,"relative"),1),e.change_speed(2*Math.PI/3,1),t.repeat(60,[i.normal(120,"relative",12,h,t.action([t.wait(13),t.vanish()])),e.change_direction(8,"relative",8)]),t.changeSpeed(t.speed(6),30)])}},stage5_03:function(){return p.danmaku="whip01",m.danmaku="boss9",{top:t.action([t.wait(60),i.offset(640,180,270,"absolute",8,m,t.actionRef("boss"))]),boss:t.action([e.change_speed(0,120),t.repeat(99,[t.repeat(3,[i.normal(180,"relative",8,p,t.action([t.wait(40),e.round_trip(4,80,3,80)])),t.wait(20),e.round_trip(4,80,1,80),e.change_speed(0,1,60)]),e.round_trip(10,32,5),e.change_speed(0,1,80)])])}},stage5_04:function(){return m.danmaku="boss10",{top:t.action([t.wait(60),i.offset(320,0,181,"absolute",6,m,t.actionRef("boss"))]),top2:t.action([t.wait(120),t.repeat(99,[t.repeat(3,[i.offset("$rand * 320 + 160",32,180,"absolute",16,u,t.action([e.change_speed(0,"$loop.index * 15 + 30"),t.repeat(10,[t.repeat(2,[i.normal(180,"sequence",28,h,t.actionRef("barrier"))]),t.wait(30)]),t.vanish()])),t.wait(60)]),t.wait(300)])]),boss:t.action([e.change_speed(0,60),e.yura_yura(1,120)]),barrier:t.action([t.wait(1),e.change_speed(0,1),i.normal(0,"relative",26,h,t.actionRef("barrier")),t.wait(27),t.vanish()])}},stage5_05:function(){return c.addedAnimation="zoom",c.hp=250,c.fieldOutCheck=u.fieldOutCheck=!1,u.hp=300,u.isSyncRotation=!1,u.danmaku="zako02",l.danmaku="boss3",l.hp=500,m.danmaku="boss11",m.hp=2400,{top:t.action([t.wait(60),i.offset(320,0,180,"absolute",4,m,t.actionRef("boss"))]),boss:t.action([e.change_speed(0,60),t.repeat(99,[t.repeat(2,[i.normal("$loop.index * 90 + 135","absolute",7,y,t.actionRef("set_largeR",1)),i.normal("$loop.index * 210 + 75","absolute",8,y,t.actionRef("set_largeR",2)),i.normal("$loop.index * 180 + 90","absolute",10,y,t.actionRef("set_largeR",2)),i.normal("$loop.index * 40 + 160","absolute",8,y,t.actionRef("set_largeR",1))]),i.normal(180,"absolute",11,y,t.actionRef("set_largeR")),t.repeat(2,[i.normal("$loop.index * 270 + 45","absolute",15,u,t.actionRef("zakoP")),i.normal("$loop.index * 140 + 110","absolute",15,u,t.actionRef("zakoP")),i.normal("$loop.index * 220 + 70","absolute",24,u,t.actionRef("zakoP"))]),t.actionRef("boss_move",16),t.wait(240),t.repeat(3,[i.normal("$loop.index * 120 + 60","absolute",8,y,t.actionRef("set_middleR")),i.normal("$loop.index * 120","absolute",8,u,t.actionRef("zakoP"))]),t.repeat(2,[i.normal("$loop.index * 240 + 60","absolute",12,y,t.actionRef("set_largeR"))]),t.actionRef("boss_move",16),t.wait(240)])]),boss_move:t.action([t.wait("$1"),e.triangle_loop(2,"right",240,1,60),e.triangle_loop(2,"left",240,1,60),t.wait(60)]),set_largeR:t.action([t.repeat("$1",[t.wait(8),i.normal(0,"relative",0,c,t.action([t.actionRef("boss_move","10 - $loop.index * 8"),e.change_direction("~~($rand * 4) *90","absolute",1),e.change_speed(6,90,240),t.vanish()]))])]),set_middleR:t.action([t.wait(8),i.normal(0,"relative",0,l,t.action([t.actionRef("boss_move",8),e.change_direction("~~($rand * 2) *90 + 90","absolute",1),e.change_speed(5,90,240),t.vanish()]))]),zakoP:t.action([e.change_speed(0,15),t.actionRef("boss_move",2),e.change_direction("~~($rand * 2) *90 + 135","absolute",1),e.change_speed(5,90,240),t.vanish()])}},explode:function(n){var s=n.rank<2?2:n.rank>6?n.rank-.5*~~(n.rank-4):n.rank;return{top:t.action([t.bindVar("r","$rand * 100 + 40"),i.normal("$rand * 300 + 30","aim",6,{},e.change_speed(2,8)),t.repeat(s-1,[i.normal("$r","sequence",6,{},e.change_speed(2,"$loop.index * 2 + 10"))]),t.notify("destroy")])}},single01:function(){return{top:t.action([t.bindVar("wait","$rand * 20"),t.wait(90),t.repeat(99,[t.wait("$wait * 15 + 45"),i.normal("$rand * 5 - 2","aim",2,f)])])}},single02:function(){return{top:t.action([t.wait(65),t.repeat(12,[i.normal(180,"absolute",0,{},t.action([t.changeSpeed(t.speed(4),180)])),t.wait("80 - $loop.index * 5")])])}},single03:function(){return{top:t.action([t.repeat(99,[t.wait("~~(Math.cos($loop.index) * 150) + 210"),i.normal(0,"aim",.5,f,t.action([t.changeSpeed(t.speed(4),240)]))])])}},whip01:function(){return{top:t.action([t.wait(90),t.repeat(99,[t.wait(120),t.repeat(3,[i.normal("$rand * 5 - 2","aim",3,f),t.repeat(4,[t.wait(1),i.normal(0,"sequence","3.5 + $loop.index * 0.5",f)]),t.wait(60)])])])}},boss1_01:function(){return{top:t.action([t.wait(90),t.repeat(99,[t.repeat(13,[t.repeat(7,[i.normal(11,"sequence",3.5,a,t.action([t.wait(10),t.changeDirection(t.direction(90,"relative"),30)]))]),t.wait(60)]),t.wait(180)])])}},boss2:function(){return{top:t.action([t.wait(60),t.repeat(99,[t.wait(150),t.repeat(3,[i.normal(-60,"aim",3,u),t.repeat(5,[i.normal(20,"sequence",3,u)]),t.wait(90)])])])}},boss3:function(){return{top:t.action([t.wait(90),t.repeat(99,[t.repeat(5,[i.normal("$rand * 165 - 90","aim",3),t.repeat(3,[i.normal(5,"sequence",3)]),t.wait(45)]),t.wait(90)])]),top2:t.action([t.wait(90),t.repeat(99,[t.wait(240),i.normal(-30,"aim",4,o),t.repeat(3,i.normal(20,"sequence",4,o)),t.wait(30),t.repeat(3,i.normal(-20,"sequence",4,o))])])}},boss4:function(){return{top:t.action([t.wait(90),t.repeat(99,[t.repeat(18,[i.normal(20,"sequence",5,f),t.wait(5)]),t.actionRef("way","($loop.index & 1) ? 1 : -1"),t.wait("~~(Math.sin($loop.index) * 59) + 60"),t.actionRef("way","($loop.index & 1) ? -1 : 1"),t.actionRef("way","($loop.index & 1) ? 1 : -1"),t.wait("~~(Math.sin($loop.index) * 60) + 120")])]),way:t.action([t.repeat(7,[i.normal("$1 * $loop.index * 20 + (($1 === 1) ? 90 : 270)","absolute",8,a),t.repeat(3,[i.normal("$1 * 20","sequence",8,a)]),t.wait(6)])])}},boss5:function(){return{top:t.action([t.wait(240),t.repeat(99,[i.normal("$rand * 360","absolute",8,u,t.actionRef("zako","~~($rand * 2)")),t.wait("$rand * 210 + 60")])]),zako:t.action([t.changeSpeed(t.speed(0),30),t.wait(60),t.repeat(3,[i.normal("(($1) ? 6 : -6)","aim",4),t.repeat(4,[t.wait(2),i.normal("(($1) ? -3 : 3)","sequence","$loop.index * 0.2 + 4.2")]),t.wait(5)]),t.wait(60),t.changeSpeed(t.speed(3),90)])}},boss6:function(){return{top:t.action([t.wait(60),t.repeat(99,[t.repeat(4,[t.repeat(3,[t.repeat(4,[i.normal(95,"sequence",4,u)]),t.wait(5)]),t.wait(30)]),t.wait(90)])])}},boss7:function(){return{top:t.action([t.wait(60),t.repeat(99,[t.actionRef("nway_bullet",1),t.wait(75),t.actionRef("nway_bullet",-1),t.wait(180)])]),top2:t.action([t.wait(90),t.repeat(99,[t.repeat(2,[t.bindVar("dir","$loop.index"),t.repeat(4,[t.repeat(8,[t.wait(10),i.normal("($dir === 0) ? 15 : -15","sequence",3.5,u)]),t.wait(30)]),t.wait(60)])])]),nway_bullet:t.action([i.normal("$1 * 60","aim",12,g,t.actionRef("burst","$1")),t.repeat(9,[t.wait(3),i.normal("-15 * $1","sequence","11 - $loop.index",g,t.actionRef("burst","$1"))])]),burst:t.action([e.change_speed(0,45,15),i.normal("$1","relative",3,d),t.repeat(4,[t.wait(9),i.normal("$1 * 4","sequence",3,d)]),t.vanish()])}},boss8:function(){return{top:t.action([t.wait(60),t.repeat(99,[t.repeat(5,[i.normal("$loop.index * 6","absolute",3,f,e.change_speed(2,45)),t.repeat(6,[i.normal(60,"sequence",3,f,e.change_speed(2,45))]),t.wait(5)]),t.wait(240)])]),top2:t.action([t.wait(60),t.repeat(99,[t.repeat(5,[i.normal("-$loop.index* 6","absolute",4,f,e.change_speed(2,45)),t.repeat(6,[i.normal(-60,"sequence",4,f,e.change_speed(2,45))]),t.wait(4)]),t.wait(180)])]),top3:t.action([t.wait(180),t.repeat(99,[i.normal(-60,"aim",4,a),t.repeat(8,[t.wait(2),i.normal(15,"sequence",4,a)]),t.wait(120)])])}},boss9:function(){return{top:t.action([t.wait(840),t.repeat(99,[t.repeat(50,[t.repeat(4,[i.normal(85,"sequence",5,d)]),t.wait(3)]),t.wait(820),t.repeat(34,[t.repeat(3,[i.normal(130,"sequence",6,a)]),t.wait(5)]),t.wait(800)])])}},boss10:function(){return{top:t.action([t.repeat(99,[t.wait(180),t.repeat("($loop.index & 1) ? 3 : 5",[t.repeat(4,[t.bindVar("dir","$rand * 220 + 70"),i.normal("$dir","sequence",4.5,d),t.repeat(3,[i.normal(0,"sequence","$loop.index * 0.5 + 5",d)])]),t.wait(15)])])]),top2:t.action([t.wait(60),t.repeat(99,[t.repeat(5,[i.normal("$loop.index * 3","absolute",3,f),t.repeat(19,[i.normal(18,"sequence",3,f)]),t.wait(20)]),t.wait(180)])])}},boss11:function(){return l.hp=200,l.danmaku="boss3",{top:t.action([t.wait(120),t.repeat(99,[i.normal(90,"sequence",2.5,g),t.repeat(2,[i.normal(30,"sequence",2.5,g)]),t.wait(30),t.repeat(5,[i.normal(30,"sequence",4,o),t.wait(5)]),t.wait("~~(Math.cos($loop.index) * 120) + 150")])])}},zako01:function(){return{top:t.action([t.wait(15),t.repeat(33,[i.normal(180,"absolute",16,f),t.wait(6)])])}},zako02:function(){return{top:t.action([t.wait(60),t.repeat(99,[t.repeat(6,[t.repeat(2,[i.normal(25,"sequence",4,d),t.repeat(2,[i.normal(120,"sequence",4,d)]),t.wait(15)]),t.wait(90)]),t.actionRef("whip",2),t.wait(120)])]),top2:t.action([t.wait(60),t.repeat(99,[t.repeat(4,[t.repeat(3,[i.normal(-20,"sequence",4,d),t.repeat(2,[i.normal(120,"sequence",4,d)]),t.wait(15)]),t.wait(135)]),t.wait(60),t.actionRef("whip",-2),t.wait(60)])]),whip:t.action([t.bindVar("r","$rand * 4 + 2"),t.wait("120 - $r * 2"),t.repeat("$r",[i.normal("$1","aim",4,f),t.repeat(2,[t.wait(1),i.normal(0,"sequence","$loop.index * 0.5 + 4.5",f)]),t.wait("600 / $r")])])}}};return new bulletml.Root(v[n](s))}}();var game=game||{};!function(){game.Enemy=tm.createClass({superClass:tm.bulletml.Bullet,init:function(t,e){this.superInit(t),e=e.$safe(game.param.ENEMY_DEFAULT_ATTR),this.fromJSON(e),this.type=e.type,this.maxHp=this._lastHp=this.hp,this.preHitTestArea=this.width>this.height?this.width:this.height,this.scene="";var i=tm.display.Sprite("image",this.width,this.height);i.setFrameIndex(this.frameIndex).addChildTo(this),"boss"===this.type&&(this.hpGauge=game.EnemyHpGauge(0,0,this.maxHp))},ondestroy:function(){if(this.parent){var t=this.scene;t.scoreLabel.score+=10*this.maxHp;var e=t.player;if(this.stopDanmaku(),"boss"===this.type)return void t.dispatchEvent(tm.event.Event("clearstage"));var i=tm.geom.Vector2(this.x,this.y).distanceSquared(e);if(i>1e4&&t.bulletLayer.children.length<130){var n=game.EnemyExplosion(this.x,this.y,~~((this.radius+this.maxHp)/10));n.addChildTo(this.scene.bulletLayer)}this.remove()}},onadded:function(){if(this.scene=this.getRoot().app.currentScene,"boss"===this.type&&(this.hpGauge.addChildTo(this.scene),this.scene.timeBonus+=this.maxHp),""!==this.danmaku&&game.setDanmaku(this,this.scene.player,this.scene),""!==this.addedAnimation)switch(this.addedAnimation){case"drop":this.setScale(2.5),game.TweenAnimation(this,"in",200,{});break;case"zoom":this.setScale(.1),game.TweenAnimation(this,"in",200,{})}},onremoved:function(){"boss"===this.type&&this.hpGauge.remove()},update:function(t){if(this.runner.update(),this.isSyncRotation){var e=tm.geom.Vector2(this.runner.x-this.x,this.runner.y-this.y).toAngle();this.rotation=Math.radToDeg(e)}if(this.setPosition(this.runner.x,this.runner.y),this.fieldOutCheck&&game.GameFieldOut(this)&&this.parent)return void this.remove();if(this.scene.app.frame%4===0&&this.children[0].setFrameIndex(this.frameIndex),this._lastHp>this.hp){if(this.children[0].setFrameIndex(this.frameIndex+1),this._lastHp-this.hp>5){var i=.7*(this._lastHp-this.hp-4);this.hp+=~~i}this._lastHp=this.hp}if("boss"===this.type&&this.hpGauge.setHp(this.hp),this.hp<1)return void this.fire(tm.event.Event("destroy"));var n=this.scene.player;if(n.hitFlag){if("refrection"===n.mode){var s=n.refrectionField.getBoundingCircle();if(tm.collision.testCircleCircle(this,s)){var o=Math.min(6,this.hp);n.power*=.5,this.hp-=o;var e=tm.geom.Vector2(n.x-this.x,n.y-this.y).normalize().mul(o);n.x=Math.clamp(n.x+e.x,GAME_FIELD_LEFT+n.radius,GAME_FIELD_RIGHT-n.radius),n.y=Math.clamp(n.y+e.y,GAME_FIELD_TOP+n.radius,GAME_FIELD_BOTTOM-n.radius);var t=tm.event.Event("quake");t.count=1,this.scene.gameField.dispatchEvent(t)}return}this.isHitPlayer(n)&&n.dispatchEvent(tm.event.Event("destroy"))}},preHitTest:function(t){if(this.width===this.heigth||0===this.rotation||180===this.rotation)return this.isHitElementRect(t);var e=tm.geom.Rect(this.x-.5*this.preHitTestArea,this.y-.5*this.preHitTestArea,this.preHitTestArea,this.preHitTestArea);return tm.collision.testRectRect(e,t.getBoundingRect())},isHitPlayer:function(t){return this.preHitTest(t)?"circle"===this.boundingType?this.isHitPointCircle(t.x,t.y):this.width!==this.height||0!==this.rotation&&180!==this.rotation?this.isHitPointRectHierarchy(t.x,t.y):this.isHitPointRect(t.x,t.y):!1}}),game.InvisibleEnemy=tm.createClass({superClass:tm.bulletml.Bullet,init:function(t,e){this.superInit(t),this.fieldOutCheck=e.fieldOutCheck},onadded:function(){this.scene=this.getRoot()},update:function(){return this.runner.update(),this.setPosition(this.runner.x,this.runner.y),this.fieldOutCheck&&this.parent&&(this.x<GAME_FIELD_LEFT||this.x>GAME_FIELD_RIGHT||this.y<GAME_FIELD_TOP||this.y>GAME_FIELD_BOTTOM)?void this.remove():void 0}}),game.EnemyBullet=tm.createClass({superClass:tm.bulletml.Bullet,init:function(t,e){this.superInit(t),e=e.$safe(game.param.BULLET_DEFAULT_ATTR),this.fromJSON(e);var i=tm.display.Sprite("image",this.width,this.height);i.setFrameIndex(e.frameIndex).setAlpha(.75),i.addChildTo(this)},fieldOutCheck:!0,onadded:function(){this.scene=this.getRoot(),"refrection"===this.scene.player.mode&&tm.collision.testCircleCircle(this.getBoundingCircle(),this.scene.player.refrectionField.getBoundingCircle())&&this.remove()},update:function(){if(this.runner.update(),this.isSyncRotation){var t=tm.geom.Vector2(this.runner.x-this.x,this.runner.y-this.y).toAngle();this.rotation=Math.radToDeg(t)}if(this.setPosition(this.runner.x,this.runner.y),this.fieldOutCheck&&game.GameFieldOut(this)&&this.parent)return void this.remove();var e=this.scene.gameField,i=this.scene.player,n=this.scene.scoreLabel;if(i.getParent()===e&&i.hitFlag&&this.parent)switch(i.mode){case"shot":if(this.preHitTest(i)&&(i.power++,n.score+=n.v,this.isHitPlayer(i)))return void i.dispatchEvent(tm.event.Event("destroy"));break;case"refrection":var s=i.refrectionField.getBoundingCircle();if(tm.collision.testCircleCircle(this,s)){var t=tm.geom.Vector2(this.x-s.x,this.y-s.y),o=t.length();
t.normalize();var a=this.radius+s.radius-o,r=tm.geom.Vector2.mul(t,a);t.mul(s.radius-this.radius);var h=game.RefrectionBullet(this.x+r.x,this.y+r.y,t.x,t.y,this);return h.addChildTo(e),this.remove(),void(n.score+=n.v*this.radius)}}},preHitTest:function(t){if(this.width===this.height)return this.isHitElementRect(t);var e=.5*(this.width>this.height?this.width:this.height),i=tm.geom.Rect(this.x-e,this.y-e,2*e,2*e);return tm.collision.testRectRect(i,t.getBoundingRect())},isHitPlayer:function(t){if(this.width===this.height)return this.isHitPointCircle(t.x,t.y);if(0===this.rotation||180===this.rotation)return this.isHitPointRect(t.x,t.y);var e=tm.geom.Vector2(t.x-this.x,t.y-this.y),i=tm.geom.Vector2().setRadian(e.toAngle()-Math.degToRad(this.rotation),e.length()),n=.5*this.width,s=.5*this.height;return i.x>-n&&i.x<n&&i.y>-s&&i.y<s?!0:!1}}),game.EnemyExplosion=tm.createClass({superClass:tm.display.CanvasElement,init:function(t,e,i){this.superInit(),this.setPosition(t,e),this.rank=i},danmaku:"explode",onadded:function(){var t=this.getRoot().app.currentScene;game.setDanmaku(this,t.player,t,{rank:this.rank})},ondestroy:function(){this.parent&&this.remove()}})}();var game=game||{};!function(){game.Player=tm.createClass({superClass:tm.display.Sprite,init:function(){this.superInit("image",64,64),this.setFrameIndex(22),this._isDestroy=!1,this._onShot=!1,this._shotInterval=0,this.powerGauge=game.PowerGauge(this.maxPower),this.refrectionField=game.RefrectionField(),this.refrectionField.addChildTo(this),this.powerGauge.addChildTo(this),this.initStatus()},maxSpeed:6,speed:0,keyX:0,keyY:0,vx:0,vy:0,shotInterval:[8,6,4],shotLevel:0,power:1,maxPower:1200,mode:"shot",hitFlag:!0,hitFlagCount:0,update:function(){this._isDestroy||("refrection"===this.mode&&(this.power-=4),this.power+=2-this.shotLevel,this.power=Math.clamp(this.power,1,this.maxPower),this.shotLevel=~~(this.power/this.maxPower*2),this.powerGauge.setPower(this.power),1===this.power&&"refrection"===this.mode&&this.fire(tm.event.Event("changemode")),"shot"===this.mode&&(this._onShot&&this._shotInterval<1&&(this.shotBullet(),this._shotInterval=this.shotInterval[this.shotLevel]),this._shotInterval--),!this.tweener.isPlaying&&this.hitFlagCount>0&&(this.hitFlagCount--,this.hitFlagCount%4===0&&(this.visible=!this.visible),this.hitFlagCount<1&&(this.hitFlag=this.visible=!0)),this.x=Math.clamp(this.x+this.keyX+this.vx,GAME_FIELD_LEFT+this.radius,GAME_FIELD_RIGHT-this.radius),this.y=Math.clamp(this.y+this.keyY+this.vy,GAME_FIELD_TOP+this.radius,GAME_FIELD_BOTTOM-this.radius))},ondestroy:function(){if(!this._isDestroy){this._isDestroy=!0,this.hitFlag=!1,this._onShot=!1;var t=this.getRoot();t.missCount++,t.missCount<10&&t.scoreLabel.score++;var e=tm.event.Event("quake");e.count=5,this.parent.dispatchEvent(e),this.tweener.clear().to({scaleX:10,scaleY:.01},250).call(function(){this.visible=!1}.bind(this)).wait(500).call(function(){this.power=1,this.initStatus()}.bind(this))}},initStatus:function(){this.visible=!0,this._isDestroy=!1,this.x=320,this.y=720-this.radius,this.setScale(10),game.TweenAnimation(this,"in",200,{scaleX:1,scaleY:1}),this.tweener.call(function(){this.hitFlagCount=GAME_FPS,this.mode="shot",this.refrectionField.setScale(.5),this.setOnShot(!0)}.bind(this))},setOnShot:function(t){this._onShot=t},onchangemode:function(){switch(this.mode){case"shot":if(this.power<this.maxPower/2)return;this.refrectionField.dispatchEvent(tm.event.Event("changemode")),this.setOnShot(!1),this.mode="refrection",this.timeline.clear().call(0,function(){this.setFrameIndex(21)}.bind(this),250).call(500,function(){this.setFrameIndex(20)}.bind(this),250);var t=tm.display.Sprite("image",64,64);t.setFrameIndex(10).setAlpha(.5).addChildTo(this),game.TweenAnimation(t,"out",200,{scaleX:12,scaleY:12,alpha:.1});break;case"refrection":this.refrectionField.dispatchEvent(tm.event.Event("changemode")),this.mode="shot",this.timeline.clear().call(0,function(){this.setFrameIndex(21)}.bind(this),250).call(500,function(){this.setFrameIndex(22),this.setOnShot(!0)}.bind(this),250)}},shotBullet:function(){for(var t=0;2>t;t++){var e=game.PlayerBullet(this.x+24*t-12,this.y-40,3);e.addChildTo(this.parent)}}}),game.RefrectionField=tm.createClass({superClass:tm.display.Sprite,init:function(){this.superInit("image",32,32),this.setFrameIndex(20),this.setAlpha(.5)},onchangemode:function(){this.scaleX=.5===this.scaleX?2.5:.5,this.scaleY=.5===this.scaleY?2.5:.5},getBoundingCircle:function(){return tm.geom.Circle(this.parent.x,this.parent.y,40)}}),game.PlayerBullet=tm.createClass({superClass:tm.display.Sprite,init:function(t,e,i){this.superInit("image",48,24),this.setFrameIndex(2),this.x=t,this.y=e,this.setRotation(90),this.vy=-this.speed,this.damage=i},speed:32,boundingtype:"rect",hitFlag:!1,update:function(t){if(this.hitFlag||game.GameFieldOut(this))return void this.remove();var e=t.currentScene.enemyLayer.children,i=e.length;if(i>0)for(var n=i;n>0;n--){var s=e[n-1];if(this.isHitEnemy(s))return s.hp-=this.damage,this.scaleX=.25,this.scaleY=1.4,void(this.hitFlag=!0)}this.y+=this.vy},getBoundingRect:function(){return tm.geom.Rect(this.x-this.height*this.originX,this.y-this.width*this.originY,this.height,this.width)},isHitEnemy:function(t){if(t.tweener.isPlaying||!t.parent)return!1;if(this.x-48>t.x||this.x+48<t.x||this.y+96<t.y)return!1;if(t.width===t.height||0===t.rotation||180===t.rotation)return this.isHitElementRect(t);var e=tm.geom.Rect(t.x-t.radius,t.y-t.radius,2*t.radius,2*t.radius);return tm.collision.testRectRect(e,this.getBoundingRect())}}),game.RefrectionBullet=tm.createClass({superClass:tm.display.Sprite,init:function(t,e,i,n,s){this.superInit("image",s.width,s.height),this.setFrameIndex(s.children[0].frameIndex+1),this.setPosition(t,e),this.vx=i,this.vy=n,this.damage=this.radius,this.count=(28-this.radius)/4,this.isSyncRotation=s.isSyncRotation,this.syncRotation()},boundingType:"rect",hitFlag:!1,update:function(t){if(game.GameFieldOut(this))return void this.remove();if(!this.hitFlag){var e=t.currentScene.enemyLayer.children,i=e.length;if(i>0)for(var n=i;n>0;n--){var s=e[n-1];if(!s.tweener.isPlaying&&s.parent&&this.isHitElementRect(s)){s.hp-=this.damage,this.update=this.explode,this.tweener.clear().to({scaleX:5,scaleY:5,alpha:.5},200).call(function(){this.remove()}.bind(this));break}}this.x+=this.vx,this.y+=this.vy,this.count>0&&(this.top<GAME_FIELD_TOP&&(this.y+=GAME_FIELD_TOP-this.top,this.vy*=-1,this.count--,this.syncRotation()),this.bottom>GAME_FIELD_BOTTOM&&(this.y+=GAME_FIELD_BOTTOM-this.bottom,this.vy*=-1,this.count--,this.syncRotation()),this.left<GAME_FIELD_LEFT&&(this.x+=GAME_FIELD_LEFT-this.left,this.vx*=-1,this.count--,this.syncRotation()),this.right>GAME_FIELD_RIGHT&&(this.x+=GAME_FIELD_RIGHT-this.right,this.vx*=-1,this.count--,this.syncRotation()))}},explode:function(t){var e=t.currentScene.enemyLayer.children,i=e.length,n=this.radius*this.scaleX,s=tm.geom.Rect(this.x-n,this.y-n,this.width*this.scaleX,this.height*this.scaleY);if(i>0)for(var o=i;o>0;o--){var a=e[o-1];!a.tweener.isPlaying&&a.parent&&tm.collision.testRectRect(s,a.getBoundingRect())&&(a.hp-=1)}},syncRotation:function(){this.isSyncRotation&&(this.rotation=Math.radToDeg(tm.geom.Vector2(this.vx,this.vy).toAngle()))}}),game.PowerGauge=tm.createClass({superClass:tm.ui.Gauge,init:function(t){this.superInit({width:80,height:80,animationFlag:!1}),this.color="blue",this.value=0,this.maxPower=t},power:0,setPower:function(t){this.power!==t&&(this.power=t,this.setValue(this.power/this.maxPower*100),this.color=this.power<this.maxPower/2?"blue":"orange")},draw:function(t){t.save(),t.lineWidth=4;var e=this.getRatio(),i=Math.degToRad(270);t.setStrokeStyle("blue"===this.color?"hsl(240, 100%, 75%)":"hsl(30, 100%, 75%)"),t.strokeArc(0,0,34,i,2*Math.PI*e+i,!1),t.restore()}})}();var game=game||{};!function(){game.ShootingScene=tm.createClass({superClass:tm.app.Scene,init:function(t){this.superInit(),this.stage=t||0,this.background=game.BackGround().setPosition(320,480).addChildTo(this),this.gameField=tm.display.CanvasElement().addChildTo(this),this.gameField.onquake=function(t){var e=2*Math.random()<1?8:-8,i=2*Math.random()<1?8:-8;this.tweener.clear().moveBy(e,i,~~(1e3/GAME_FPS)).moveBy(-2*e,-2*i,~~(2e3/GAME_FPS)).move(0,0,~~(1e3/GAME_FPS)).call(function(){t.count>0&&(t.count-=1,this.tweener.rewind())}.bind(this),~~(1e3/GAME_FPS))},this.player=game.Player(),this.player.addChildTo(this.gameField),this.enemyLayer=tm.display.CanvasElement().addChildTo(this.gameField),this.bulletLayer=tm.display.CanvasElement().addChildTo(this.gameField);var e=(game.GameFieldFrame().setPosition(320,480).addChildTo(this),tm.display.Sprite("title",300,120).setPosition(320,840).addChildTo(this),tm.display.TextShape({fontSize:24,text:"delta-delta Ver."+game.data.version}.$safe(game.param.DEFAULT_TEXT_SHAPE)));e.autoRender=!1,e.setPosition(480,930).addChildTo(this);game.EnemyInfomation().setPosition(542,776).addChildTo(this);this.scoreLabel=game.ScoreLabel().setPosition(616,104),this.highScore=game.HighScoreLabel(game.data.highScore[this.stage-1]).setPosition(616,56);var i=game.Score().setPosition(24,104),n=game.HighScore().setPosition(24,56);if(t>0&&(i.addChildTo(this),n.addChildTo(this),this.scoreLabel.addChildTo(this),this.highScore.addChildTo(this)),"none"!==game.config.modeChangeButton){this.button=game.ModeChangeButton().setPosition("left"===game.config.modeChangeButton?64:576,654).setAlpha(.3).addChildTo(this);{game.PauseButton().setPosition("left"===game.config.modeChangeButton?64:576,168).setAlpha(.3).addChildTo(this)}}this.danmakuList=game.danmakuList(this.stage),this.stepTick()},pointingCheck:{count:0,time:0,durationTime:GAME_FPS/4},age:0,timeBonus:0,missCount:0,danmaku:"",phase:0,stepTick:function(){return this.danmaku=this.danmakuList[this.phase],this.danmakuList.length<=this.phase?void this.result():void(""!==this.danmaku&&(this.stopDanmaku(),game.setDanmaku(this,this.player,this),this.timeBonus+=60*GAME_FPS,this.phase++,game.EffectiveText("PHASE "+("00"+this.phase+"/").substr(-3)+("00"+this.danmakuList.length).substr(-2)).setPosition(320,240).addChildTo(this)))},update:function(){this.age++,this.pointingCheck.count>0&&game.config.enableDoubleTap&&(this.pointingCheck.time++,this.pointingCheck.time>this.pointingCheck.durationTime&&(this.pointingCheck.time=this.pointingCheck.count=0))},onpointingstart:function(){if(!game.config.enableDoubleTap)return void(this.onpointingstart=function(){});if(this.pointingCheck.time=0,0===this.pointingCheck.count&&(this.pointingCheck.count=1),2===this.pointingCheck.count){this.pointingCheck.count=0;var t=this.player;t.getParent()===this.gameField&&t.dispatchEvent(tm.event.Event("changemode"))}},onpointingend:function(){game.config.enableDoubleTap&&(this.pointingCheck.time=0,1===this.pointingCheck.count&&(this.pointingCheck.count=2));var t=this.player;t.getParent()===this.gameField&&(t.vx=t.vy=0)},onpointingmove:function(t){var e=t.pointing,i=this.player;return i.tweener.isPlaying?void(i.vx=i.vy=0):void(i.getParent()===this.gameField&&(i.vx=Math.min(Math.max(-i.radius,e.dx*game.config.moveRatio),i.radius),i.vy=Math.min(Math.max(-i.radius,e.dy*game.config.moveRatio),i.radius)))},onclearstage:function(){this.stopDanmaku();for(var t=this.enemyLayer.children,e=0,i=t.length;i>e;e++)t[e]._isHitTestEnable=!1,t[e].stopDanmaku(),game.TweenAnimation(t[e],"out",250,{scaleX:8,scaleY:0});this.bulletLayer.removeChildren(),this.stepTick()},oncutin:function(t){t.parm;alert(t.parm)},result:function(){if(0!==this.stage){{var t=Math.max(0,250*~~((this.timeBonus-this.age)/(this.missCount+1)));game.Result(this.stage,this.age,this.missCount,t).addChildTo(this)}this.scoreLabel.score+=t,this.highScore.score<this.scoreLabel.score&&(this.highScore.score=this.scoreLabel.score),game.data.highScore[this.stage-1]=this.highScore.score,game.saveData(game.data)}var e=tm.display.TextShape({text:"Touch to Title",fillStyle:"hsl(240, 100%, 95%)",strokeStyle:"hsl(240, 100%, 75%)",fontSize:32,fontFamily:game.FONT});e.setPosition(320,680),e.tweener.wait(1e3).fadeOut(1).wait(500).fadeIn(1).setLoop(!0),this.tweener.clear().wait(1500).call(function(){this.player.remove(),e.addChildTo(this),this.ontouchstart=function(){},this.ontouchmove=function(){},this.ontouchend=function(){this.removeChildren(),this.app.replaceScene(game.TitleScene())}}.bind(this))}}),game.TitleScene=tm.createClass({superClass:tm.app.Scene,init:function(){this.superInit(),game.data=game.data.$extend(game.loadData()),game.data.version<game.DEFAULT_DATA.version&&(game.data.version=game.DEFAULT_DATA.version),game.config=game.data.config,this.setInteractive(!1),game.BackGround().setPosition(320,480).addChildTo(this);var t=tm.display.Sprite("title",300,120);t.setAlpha(0).setPosition(320,280).setScale(2).addChildTo(this),t.tweener.clear().fadeIn(1500).call(function(){this.touchEnable()}.bind(this))},onpointingend:function(){this.children[this.children.length-1].remove();var t=(game.param.DEFAULT_TEXT_SHAPE,game.TextButton({fontSize:64,text:"Tutrial"}).setPosition(320,460).addChildTo(this));t.onpointingend=function(){this.parent.app.replaceScene(game.ShootingScene(0))};var e=game.TextButton({fontSize:64,text:"Normal Mode"}).setPosition(320,560).addChildTo(this);e.onpointingend=function(){this.parent.app.replaceScene(game.SelectScene())};var i=game.TextButton({fontSize:64,text:"Config"}).setPosition(320,760).addChildTo(this);i.onpointingend=function(){this.setScale(1),this.parent.app.pushScene(game.ConfigScene())};var n=game.TextButton({fontSize:64,text:"Manual"}).setPosition(320,860).addChildTo(this);n.onpointingend=function(){this.setScale(1),window.location.href="./manual.html"},this.onpointingend=function(){}},touchEnable:function(){this.setInteractive(!0);var t=game.param.DEFAULT_TEXT_SHAPE,e=(tm.display.TextShape({fontSize:24,text:"delta-delta Ver."+game.data.version}.$safe(t)).setPosition(480,380).addChildTo(this),tm.display.TextShape({text:"Touch Screen"}.$safe(t)).setPosition(320,640).addChildTo(this));e.tweener.clear().fadeIn(1).wait(1e3).fadeOut(1).wait(500).setLoop(!0)}}),game.SelectScene=tm.createClass({superClass:tm.app.Scene,init:function(){this.superInit();var t=game.param.DEFAULT_TEXT_SHAPE,e=(game.BackGround().setPosition(320,480).addChildTo(this),game.TextButton({text:"<",fontSize:80}).setPosition(48,48).addChildTo(this));e.onpointingend=function(){this.parent.app.replaceScene(game.TitleScene())};for(var i=(tm.display.TextShape({fontSize:80,text:"Stage Select"}.$safe(t)).setPosition(320,140).addChildTo(this),["Stage1","Stage2","Stage3","Stage4","Stage5"]),n=0,s=i.length;s>n;n++){var o=game.TextButton({text:i[n]}).setPosition(320,100*n+280).addChildTo(this);o.num=n+1,o.setInteractive(!0),o.onpointingend=function(){this.parent&&this.parent.app.replaceScene(game.ShootingScene(this.num))}}}}),game.ConfigScene=tm.createClass({superClass:tm.app.Scene,init:function(){this.superInit(),tm.display.RectangleShape({width:640,height:960,fillStyle:"rgba(0, 0, 0, 0.8)",strokeStyle:"rgb(0, 0, 0)"}).setPosition(320,480).addChildTo(this);var t=game.config,e=game.param.DEFAULT_TEXT_SHAPE,i="hsl(240, 100%, 95%)",n="rgb(50%, 50%, 50%)",s=game.TextButton({fontSize:80,text:"<"}).setPosition(48,48).addChildTo(this);s.onpointingend=function(){game.saveData(game.data),this.parent.app.popScene()};var o=(tm.display.TextShape({text:"Config"}.$safe(e)).setPosition(320,100).addChildTo(this),tm.display.TextShape({fontSize:32,text:"DoubleTap ModeChange"}.$safe(e)).setPosition(320,200).addChildTo(this),game.TextButton({text:"O N",fillStyle:n}).setPosition(440,260).addChildTo(this));o.update=function(){this.setFillStyle(t.enableDoubleTap?i:n)},o.onpointingend=function(){this.setScale(1),t.enableDoubleTap=!0};var a=game.TextButton({text:"OFF",fillStyle:n}).setPosition(200,260).addChildTo(this);a.update=function(){this.setFillStyle(t.enableDoubleTap?n:i)},a.onpointingend=function(){this.setScale(1),t.enableDoubleTap=!1};var r=(tm.display.TextShape({fontSize:32,text:"Button Position"}.$safe(e)).setPosition(320,340).addChildTo(this),game.TextButton({text:"Left",fillStyle:n}).setPosition(320,400).addChildTo(this));r.update=function(){this.setFillStyle("left"===t.modeChangeButton?i:n)},r.onpointingend=function(){this.setScale(1),t.modeChangeButton="left"};var h=game.TextButton({text:"Right",fillStyle:n}).setPosition(520,400).addChildTo(this);h.update=function(){this.setFillStyle("right"===t.modeChangeButton?i:n)},h.onpointingend=function(){this.setScale(1),t.modeChangeButton="right"};var l=game.TextButton({text:"None",fillStyle:n}).setPosition(120,400).addChildTo(this);l.update=function(){this.setFillStyle("none"===t.modeChangeButton?i:n)},l.onpointingend=function(){this.setScale(1),t.modeChangeButton="none"};var c=(tm.display.TextShape({fontSize:32,text:"Move Ratio"}.$safe(e)).setPosition(320,480).addChildTo(this),tm.display.Label(t.moveRatio).setPosition(320,520).addChildTo(this));c.fontColor=n,c.fontFamily=game.FONT,c.update=function(){this.text=~~(100*t.moveRatio)+"%"};for(var u=0;20>u;u++){var m=[];m[u]=tm.display.RectangleShape({width:24,height:64,fillStyle:n,strokeStyle:"hsl(240, 100%, 75%)",lineWidth:1}).setInteractive(!0).setPosition(30*u+40,580).addChildTo(this),m[u].id=u,m[u].onpointingstart=function(){t.moveRatio=.05*this.id+.55},m[u].update=function(){this.setFillStyle(t.moveRatio<.05*this.id+.55?n:i)}}var p=game.TextButton({text:"Record"}).setPosition(320,740).addChildTo(this);p.onpointingend=function(){this.setScale(1),this.parent.app.pushScene(game.RecordScene())};var d=game.TextButton({text:"Reset Config"}).setPosition(320,840).addChildTo(this);d.onpointingend=function(){this.setScale(1);var e=game.YesNoDialog("Reset Config?");e.onyes=function(){t=game.data.config={}.$extend(game.DEFAULT_CONFIG),game.saveData(game.data),this.app.popScene()},this.parent.app.pushScene(e)}}}),game.RecordScene=tm.createClass({superClass:tm.app.Scene,init:function(){this.superInit(),tm.display.RectangleShape({width:640,height:960,fillStyle:"rgba(0, 0, 0, 0.8)",strokeStyle:"rgb(0, 0, 0)"}).setPosition(320,480).addChildTo(this);var t=game.data.highScore,e=game.param.DEFAULT_TEXT_SHAPE,i=game.TextButton({fontSize:80,text:"<"}).setPosition(48,48).addChildTo(this);i.onpointingend=function(){this.parent.app.popScene()},tm.display.TextShape({text:"High-Score Record",fontSize:48}.$safe(e)).setPosition(320,140).addChildTo(this);for(var n=0;n<t.length;n++){tm.display.TextShape({text:"Stage"+(n+1),fontSize:48}.$safe(e)).setPosition(160,80*n+280).addChildTo(this);var s=tm.display.Label(t[n]?t[n]:"0").setFontFamily(game.NUMBER_FONT).setFontSize(64).setAlign("right").setPosition(580,80*n+280).setAlpha(.5).addChildTo(this);s.id=n,s.update=function(){this.text=game.data.highScore[this.id]?game.data.highScore[this.id]:"0"}}var o=game.TextButton({fontSize:48,text:"Reset High-Score"}).setPosition(320,840).addChildTo(this);o.onpointingend=function(){this.setScale(1);var t=game.YesNoDialog("Reset High-score?");t.onyes=function(){game.data.highScore=game.DEFAULT_DATA.highScore.clone(),game.saveData(game.data),this.app.popScene()},this.parent.app.pushScene(t)}}}),game.YesNoDialog=tm.createClass({superClass:tm.app.Scene,init:function(t){this.superInit(),tm.display.RectangleShape({width:640,height:960,fillStyle:"rgba(0, 0, 0, 0.8)",strokeStyle:"rgb(0, 0, 0)"}).setPosition(320,480).addChildTo(this),tm.display.TextShape({fontSize:32,text:t}.$safe(game.param.DEFAULT_TEXT_SHAPE)).setPosition(320,300).addChildTo(this);var e=game.TextButton({text:"N o"}).setPosition(200,380).addChildTo(this);e.onpointingend=function(){this.parent.dispatchEvent(tm.event.Event("no"))};var i=game.TextButton({text:"Yes"}).setPosition(420,380).addChildTo(this);i.onpointingend=function(){this.parent.dispatchEvent(tm.event.Event("yes"))}},onyes:function(){},onno:function(){this.app.popScene()}}),game.PauseScene=tm.createClass({superClass:tm.app.Scene,init:function(){this.superInit(),tm.display.RectangleShape({width:640,height:960,fillStyle:"rgba(0, 0, 0, 0.8)",strokeStyle:"rgb(0, 0, 0)"}).setPosition(320,480).addChildTo(this),tm.display.TextShape({text:"Pause"}.$safe(game.param.DEFAULT_TEXT_SHAPE)).setPosition(320,300).addChildTo(this);var t=game.TextButton({fontSize:48,text:"GiveUp"}).setPosition(180,420).addChildTo(this);t.onpointingend=function(){this.setScale(1);var t=this.parent.app;t.popScene(),t.replaceScene(game.TitleScene())};var e=game.TextButton({fontSize:48,text:"Continue"}).setPosition(460,420).addChildTo(this);e.onpointingend=function(){this.setScale(1),this.parent.app.popScene()}}})}();var game=game||{};!function(){game.Score=tm.createClass({superClass:tm.display.Label,init:function(){this.superInit("Score"),this.setAlign("left"),this.setFontSize(48),this.setFontFamily(game.FONT),this.setAlpha(.5)}}),game.HighScore=tm.createClass({superClass:tm.display.Label,init:function(){this.superInit("High-Score"),this.setAlign("left"),this.setFontSize(48),this.setFontFamily(game.FONT),this.setAlpha(.5)}}),game.ScoreLabel=tm.createClass({superClass:tm.display.Label,init:function(){this.superInit("0"),this.setAlign("right"),this.setFontSize(64),this.setFontFamily(game.NUMBER_FONT),this.setAlpha(.5),this.score=0,this.v=600/GAME_FPS},update:function(){this.text=""+~~this.score}}),game.HighScoreLabel=tm.createClass({superClass:tm.display.Label,init:function(t){this.superInit(t),this.setAlign("right"),this.setFontSize(64),this.setFontFamily(game.NUMBER_FONT),this.setAlpha(.5),this.score=parseInt(t),this.v=600/GAME_FPS},update:function(){if(this.parent){var t=this.parent.scoreLabel.score;t>this.score&&(this.score=t)}this.text=""+~~this.score}}),game.EnemyHpGauge=tm.createClass({superClass:tm.ui.Gauge,init:function(t,e,i){this.superInit({width:632,height:24,x:t||4,y:e||4,bgColor:"red",color:"lime",animationFlag:!1,borderWidth:2}),this.maxHp=this.value=this.hp=i},setHp:function(t){this.hp!==t&&(this.hp=t,this.setValue(this.hp/this.maxHp*100))}}),game.EffectiveText=tm.createClass({superClass:tm.display.CanvasElement,init:function(t){this.superInit(),t&&(this.text=t,this.count=0,this.age=0)},tick:function(){var t=this.children.length;if(t>=this.text.length)return void(this.update=function(){1>t&&this.remove()});var e=tm.display.TextShape({fontSize:32,fontFamily:game.FONT,fillStyle:"hsl(240, 100%, 95%)",strokeStyle:"hsl(240, 100%, 75%)",text:this.text[t]}).setPosition(32*t-16*this.text.length,0).addChildTo(this),i=e.scaleX=.2,n=e.scaleY=10;game.TweenAnimation(e,"draw_phase",240,{scaleX:i,scaleY:n})},update:function(){this.age>6&&(this.tick(),this.age=0),this.age++}}),game.ModeChangeButton=tm.createClass({superClass:tm.display.Sprite,init:function(){this.superInit("image",96,96),this.setFrameIndex(11),this.setInteractive(!0),this.boundingType="circle";tm.display.TextShape({text:"C",fontSize:48,fontFamily:game.NUMBER_FONT}).addChildTo(this)},onpointingstart:function(){this.setScale(.9)},onpointingend:function(){this.setScale(1);var t=this.parent;t.pointingCheck.count=0,t.player.dispatchEvent(tm.event.Event("changemode"))}}),game.PauseButton=tm.createClass({superClass:tm.display.Shape,init:function(){this.superInit({width:64,height:64,fillStyle:"white"}),this.autoRender=!1,this.render(),this.setInteractive(!0)},_render:function(){this.canvas.fillRect(5,2,24,60),this.canvas.fillRect(35,2,24,60)},onpointingstart:function(){this.setScale(.9)},onpointingend:function(){this.setScale(1),this.parent.app.pushScene(game.PauseScene())}}),game.TextButton=tm.createClass({superClass:tm.display.TextShape,init:function(t){t=t.$safe(game.param.DEFAULT_TEXT_SHAPE),this.superInit(t),this.boundingType="rect",this.setInteractive(!0)},onpointingstart:function(){this.setScale(.9)}}),game.GameFieldFrame=tm.createClass({superClass:tm.display.Shape,init:function(){this.superInit({width:640,height:960,fillStyle:"rgb(127, 127, 196)"}),this.autoRender=!1},_render:function(){this.canvas.fillRect(0,0,this.width,this.height),this.canvas.clear(GAME_FIELD_LEFT,GAME_FIELD_TOP,608,688)}}),game.EnemyInfomation=tm.createClass({superClass:tm.display.RectangleShape,init:function(){this.superInit({width:160,height:80,fillStyle:"rgba( 0, 0, 0, 0.4)"});game.EnemyCounter().setPosition(-72,-24).addChildTo(this),game.BulletCounter().setPosition(-72,-8).addChildTo(this);this.scene=null}}),game.EnemyCounter=tm.createClass({superClass:tm.display.Label,init:function(){this.superInit("enemy :0000/0000"),this.setAlign("left"),this.setFontSize(14),this.setFontFamily(game.NUMBER_FONT),this.maxValue=0,this.autoRender=!1},update:function(t){var e=t.currentScene.enemyLayer.children.length;this.maxValue<e&&(this.maxValue=e),this.text="enemy :"+("0000"+e).substr(-4)+"/"+("0000"+this.maxValue).substr(-4)}}),game.BulletCounter=tm.createClass({superClass:tm.display.Label,init:function(){this.superInit("bullet:0000/0000"),this.setAlign("left"),this.setFontSize(14),this.setFontFamily(game.NUMBER_FONT),this.maxValue=0,this.autoRender=!1},update:function(t){var e=t.currentScene.bulletLayer.children.length;this.maxValue<e&&(this.maxValue=e),this.text="bullet:"+("0000"+e).substr(-4)+"/"+("0000"+this.maxValue).substr(-4)}}),game.BackGround=tm.createClass({superClass:tm.display.CanvasElement,init:function(){return this.superInit(),game.config.enableBackGround?(this.back=game.BackGroundImage().setScale(2).setAlpha(.5).addChildTo(this),this.back.tweener.clear().move(0,47,4e3).move(0,0,1).setLoop(!0),this.front=game.BackGroundImage().setScale(3).setAlpha(.4).addChildTo(this),void this.front.tweener.clear().move(0,71,4e3).move(0,0,1).setLoop(!0)):void this.tweener.wait(1).call(function(){this.remove()}.bind(this))}}),game.BackGroundImage=tm.createClass({superClass:tm.display.Shape,init:function(){this.superInit({width:320,height:480,lineWidth:1,strokeStyle:"rgb( 40%, 70%, 70%)"}),this.autoRender=!1,this.render()},_render:function(){for(var t=0;480>t;t+=24)this.canvas.line(0,t,320,t).stroke()}}),game.Result=tm.createClass({superClass:tm.display.CanvasElement,init:function(t,e,i,n){this.superInit();var s=e/GAME_FPS,o=~~(100*(s-~~s)),a=Math.floor(s/60),r=Math.floor(s)-60*a;this.addLabel("Stage "+t+" Clear","center",game.FONT,48,320,190),this.addLabel("Result","center",game.FONT,48,320,280),this.addLabel("Time","left",game.FONT,48,120,360),this.addLabel(("00"+a).substr(-2)+":"+("00"+r).substr(-2)+"."+("00"+o).substr(-2),"right",game.NUMBER_FONT,48,520,360),this.addLabel("Miss","left",game.FONT,48,120,440),this.addLabel(i+"","right",game.NUMBER_FONT,48,520,440),this.addLabel("Bonus","left",game.FONT,48,120,540),this.addLabel(n+"","right",game.NUMBER_FONT,48,520,540)},addLabel:function(t,e,i,n,s,o){var a=tm.display.Label(t);a.setAlign(e).setFontSize(n).setAlpha(.7).setFontFamily(i).setPosition(s,o).addChildTo(this)}})}(),tm.main(function(){var t=tm.app.CanvasApp("#world");t.resize(SCREEN_WIDTH,SCREEN_HEIGHT),t.fitWindow(),t.fps=GAME_FPS,t.background="rgb( 10%, 10%, 10%)";var e=tm.ui.LoadingScene({width:SCREEN_WIDTH,height:SCREEN_HEIGHT,assets:{title:"./src/images/title.png",image:"./src/images/spritesheet.png"},nextScene:game.TitleScene});t.replaceScene(e),t.update=function(){var t=this.currentScene,e=t.player,i=this.keyboard;if(1==i.getKeyDown("space")&&(1==t.isUpdate?t.sleep():t.wakeUp()),e){(i.getKeyDown("z")===!0||i.getKeyDown("Z")===!0)&&e.fire(tm.event.Event("changemode"));var n=i.getKeyAngle();if(null===n)return void(e.keyX=e.keyY=e.speed=0);e.speed=i.getKey("x")===!0||i.getKey("X")===!0?2:e.maxSpeed,e.keyX=e.speed*game.config.moveRatio*Math.cos(n*Math.DEG_TO_RAD),e.keyY=-e.speed*game.config.moveRatio*Math.sin(n*Math.DEG_TO_RAD)}},t.run()});